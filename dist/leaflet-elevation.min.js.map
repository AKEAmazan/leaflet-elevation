{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/chart.js","../src/marker.js","../src/options.js","../src/summary.js","../src/control.js","../src/slope.js","../src/index.js"],"sourcesContent":["/**\r\n * Recursive deep merge objects.\r\n * Alternative to L.Util.setOptions(this, options).\r\n */\r\nexport function deepMerge(target, ...sources) {\r\n\tif (!sources.length) return target;\r\n\tconst source = sources.shift();\r\n\tif (isObject(target) && isObject(source)) {\r\n\t\tfor (const key in source) {\r\n\t\t\tif (isObject(source[key])) {\r\n\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t[key]: {}\r\n\t\t\t\t});\r\n\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn deepMerge(target, ...sources);\r\n}\r\n\r\n/**\r\n * Wait for document load before execute function.\r\n */\r\nexport function deferFunc(f) {\r\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\r\n\telse f();\r\n}\r\n\r\n/*\r\n * Formatting funciton using the given decimals and seperator.\r\n */\r\nexport function formatter(num, dec, sep) {\r\n\tlet res = L.Util.formatNum(num, dec).toString();\r\n\tlet numbers = res.split(\".\");\r\n\tif (numbers[1]) {\r\n\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\r\n\t\t\tnumbers[1] += \"0\";\r\n\t\t}\r\n\t\tres = numbers.join(sep || \".\");\r\n\t}\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * Simple GeoJSON data loader.\r\n */\r\nexport function GeoJSONLoader(data, control) {\r\n\tif (typeof data === \"string\") {\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tcontrol = control || this;\r\n\r\n\tlet layer = L.geoJson(data, {\r\n\t\tstyle: (feature) => {\r\n\t\t\tlet style = L.extend({}, control.options.polyline);\r\n\t\t\tif (control.options.theme) {\r\n\t\t\t\tstyle.className += ' ' + control.options.theme;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\tif (name || desc) {\r\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t}\r\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\treturn marker;\r\n\t\t},\r\n\t\tonEachFeature: (feature, layer) => {\r\n\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\tcontrol.addData(feature, layer);\r\n\r\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\r\n\t\t},\r\n\t});\r\n\r\n\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info }, true);\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Simple GPX data loader.\r\n */\r\nexport function GPXLoader(data, control) {\r\n\tcontrol = control || this;\r\n\r\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\r\n\r\n\tif (control.options.theme) {\r\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\r\n\t}\r\n\r\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\r\n\r\n\t// similar to L.GeoJSON.pointToLayer\r\n\tlayer.on('addpoint', (e) => {\r\n\t\tcontrol.fire(\"waypoint_added\", e, true);\r\n\t});\r\n\r\n\t// similar to L.GeoJSON.onEachFeature\r\n\tlayer.once(\"addline\", (e) => {\r\n\t\tcontrol.addData(e.line /*, layer*/ );\r\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\r\n\t});\r\n\r\n\t// unlike the L.GeoJSON, L.GPX parsing is async\r\n\tlayer.once('loaded', (e) => {\r\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info }, true);\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Check DOM element visibility.\r\n */\r\nexport function isDomVisible(elem) {\r\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n}\r\n\r\n/**\r\n * Check object type.\r\n */\r\nexport function isObject(item) {\r\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n/**\r\n * Check DOM element viewport visibility.\r\n */\r\nexport function isVisible(elem) {\r\n\tif (!elem) return false;\r\n\r\n\tlet styles = window.getComputedStyle(elem);\r\n\r\n\tfunction isVisibleByStyles(elem, styles) {\r\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t}\r\n\r\n\tfunction isAboveOtherElements(elem, styles) {\r\n\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\tlet left = boundingRect.left + 1;\r\n\t\tlet right = boundingRect.right - 1;\r\n\t\tlet top = boundingRect.top + 1;\r\n\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\tlet above = true;\r\n\r\n\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t// Only for completely visible elements\r\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\treturn above;\r\n\t}\r\n\r\n\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Check JSON object type.\r\n */\r\nexport function isJSONDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tJSON.parse(doc.toString());\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Check XML object type.\r\n */\r\nexport function isXMLDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"<\") == 0;\r\n\t} else {\r\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Async JS script download.\r\n */\r\nexport function lazyLoader(url, skip, loader) {\r\n\tif (skip === false) {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\tif (loader instanceof Promise) {\r\n\t\treturn loader;\r\n\t}\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\n/**\r\n * Download data from a remote url.\r\n */\r\nexport function loadFile(url, success) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = \"text\";\r\n\t\txhr.open('GET', url);\r\n\t\txhr.onload = () => resolve(xhr.response);\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\n/**\r\n * Generate download data event.\r\n */\r\nexport function saveFile(dataURI, fileName) {\r\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\r\n\tlet b = document.body;\r\n\tb.appendChild(a);\r\n\ta.click();\r\n\tb.removeChild(a);\r\n}\r\n\r\n/**\r\n * Wait for element visible before execute function.\r\n */\r\nexport function waitHolder(elem) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = () => {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(() => {\r\n\t\t\t\t\tif (isVisible(elem)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t});\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t});\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.addClass\r\n */\r\nexport function addClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.addClass(targetNode, s); });\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.removeClass()\r\n */\r\nexport function removeClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.removeClass(targetNode, s); });\r\n}\r\n\r\nexport function style(targetNode, name, value) {\r\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\r\n\telse return targetNode.style.setProperty(name, value);\r\n}\r\n\r\n/**\r\n * A little bit shorter than L.DomUtil.create()\r\n */\r\nexport function create(tagName, className, attributes, parent) {\r\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\r\n\tif (attributes) setAttributes(elem, attributes);\r\n\tif (parent) append(parent, elem);\r\n\treturn elem;\r\n}\r\n\r\n/**\r\n * Same as node.appendChild()\r\n */\r\nexport function append(parent, child) {\r\n\treturn parent.appendChild(child);\r\n}\r\n\r\n/**\r\n * Same as node.insertAdjacentElement()\r\n */\r\nexport function insert(parent, child, position) {\r\n\treturn parent.insertAdjacentElement(position, child);\r\n}\r\n\r\n/**\r\n * Loop for node.setAttribute()\r\n */\r\nexport function setAttributes(elem, attrs) {\r\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\r\n}\r\n\r\n/**\r\n * Same as node.querySelector().\r\n */\r\nexport function select(selector, context) {\r\n\treturn (context || document).querySelector(selector);\r\n}\r\n\r\n/**\r\n * Alias for L.DomEvent.on.\r\n */\r\nexport const on = L.DomEvent.on;\r\n\r\n/**\r\n * Alias for L.DomEvent.off.\r\n */\r\nexport const off = L.DomEvent.off;\r\n\r\n/**\r\n * Alias for L.DomUtil.hasClass.\r\n */\r\nexport const hasClass = L.DomUtil.hasClass;\r\n\r\n\r\nexport function randomId() {\r\n\treturn Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nexport function each(obj, fn) {\r\n\tfor (let i in obj) fn(obj[i]);\r\n}\r\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Area = ({\r\n\tdata,\r\n\tname,\r\n\txAttr,\r\n\tyAttr,\r\n\tscaleX,\r\n\tscaleY,\r\n\theight,\r\n\tinterpolation = \"curveLinear\",\r\n}) => {\r\n\treturn path => {\r\n\t\tif (typeof interpolation === 'string') interpolation = d3[interpolation];\r\n\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\r\n\t\t\t.y0(height)\r\n\t\t\t.y1(d => scaleY(d[yAttr]));\r\n\r\n\t\tif (data) path.datum(data).attr(\"d\", area);\r\n\t\tif (name) path.attr('data-name', name);\r\n\r\n\t\treturn area;\r\n\t};\r\n};\r\n\r\nexport const AreaPath = (props) => {\r\n\treturn d3.create('svg:path')\r\n\t\t.attr(\"class\", \"area\")\r\n\t\t.call(Area(props));\r\n};\r\n\r\nexport const Axis = ({\r\n\ttype = \"axis\",\r\n\ttickSize = 6,\r\n\ttickPadding = 3,\r\n\tposition,\r\n\theight,\r\n\twidth,\r\n\taxis,\r\n\tscale,\r\n\tticks,\r\n\ttickFormat,\r\n\tlabel,\r\n\tlabelX,\r\n\tlabelY\r\n}) => {\r\n\treturn g => {\r\n\t\tlet [w, h] = [0, 0];\r\n\t\tif (position == \"bottom\") h = height;\r\n\t\tif (position == \"right\") w = width;\r\n\r\n\t\tif (axis == \"x\" && type == \"grid\") {\r\n\t\t\ttickSize = -height;\r\n\t\t} else if (axis == \"y\" && type == \"grid\") {\r\n\t\t\ttickSize = -width;\r\n\t\t}\r\n\r\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\r\n\t\t\t.scale(scale)\r\n\t\t\t.ticks(ticks)\r\n\t\t\t.tickPadding(tickPadding)\r\n\t\t\t.tickSize(tickSize)\r\n\t\t\t.tickFormat(tickFormat);\r\n\r\n\t\tlet axisGroup = g.append(\"g\")\r\n\t\t\t.attr(\"class\", [axis, type, position].join(\" \"))\r\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\r\n\t\t\t.call(axisScale);\r\n\r\n\t\tif (label) {\r\n\t\t\taxisGroup.append(\"text\")\r\n\t\t\t\t.attr(\"x\", labelX)\r\n\t\t\t\t.attr(\"y\", labelY)\r\n\t\t\t\t.text(label);\r\n\t\t}\r\n\r\n\t\treturn axisGroup;\r\n\t};\r\n};\r\n\r\nexport const DragRectangle = ({\r\n\tdragStartCoords,\r\n\tdragEndCoords,\r\n\theight,\r\n}) => {\r\n\treturn rect => {\r\n\t\tlet x1 = Math.min(dragStartCoords[0], dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\treturn rect\r\n\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.attr(\"x\", x1);\r\n\t};\r\n};\r\n\r\nexport const FocusRect = ({\r\n\twidth,\r\n\theight,\r\n}) => {\r\n\treturn rect => rect\r\n\t\t.attr(\"width\", width)\r\n\t\t.attr(\"height\", height)\r\n\t\t.style(\"fill\", \"none\")\r\n\t\t.style(\"stroke\", \"none\")\r\n\t\t.style(\"pointer-events\", \"all\");\r\n};\r\n\r\nexport const Grid = (props) => {\r\n\tprops.type = \"grid\";\r\n\treturn Axis(props);\r\n};\r\n\r\nexport const HeightFocusLine = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlength = 0,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t.attr(\"x1\", xCoord)\r\n\t\t.attr(\"x2\", xCoord)\r\n\t\t.attr(\"y1\", yCoord)\r\n\t\t.attr(\"y2\", length);\r\n};\r\n\r\nexport const HeightFocusLabel = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlabel,\r\n}) => {\r\n\treturn text => {\r\n\t\ttext\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t.attr(\"x\", xCoord + 5)\r\n\t\t\t.attr(\"y\", yCoord);\r\n\r\n\t\tlet y = text.select(\".height-focus-y\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"height-focus-y\")\r\n\t\t\t.text(label);\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\r\n\r\n\t\treturn text;\r\n\t};\r\n};\r\n\r\nexport const HeightFocusPoint = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n}) => {\r\n\treturn circle => circle\r\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\r\n\t\t.attr(\"r\", 6)\r\n\t\t.attr(\"cx\", 0)\r\n\t\t.attr(\"cy\", 0);\r\n};\r\n\r\n\r\nexport const LegendItem = ({\r\n\tname,\r\n\twidth,\r\n\theight,\r\n\tmargins = {},\r\n}) => {\r\n\treturn g => {\r\n\t\tg\r\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\r\n\t\t\t.attr(\"data-name\", name);\r\n\r\n\t\tg.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (width / 2) - 50)\r\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 10)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\tg.append('text')\r\n\t\t\t.text(L._(name))\r\n\t\t\t.attr(\"x\", (width / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', height + margins.bottom / 2)\r\n\t\t\t.attr('dy', \"0.75em\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const MouseFocusLine = ({\r\n\txCoord = 0,\r\n\theight,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr('class', 'mouse-focus-line')\r\n\t\t.attr('x2', xCoord)\r\n\t\t.attr('y2', 0)\r\n\t\t.attr('x1', xCoord)\r\n\t\t.attr('y1', height);\r\n};\r\n\r\nexport const MouseFocusLabel = ({\r\n\txCoord,\r\n\tyCoord,\r\n\tlabelX = \"\",\r\n\tlabelY = \"\",\r\n\twidth,\r\n}) => {\r\n\treturn g => {\r\n\r\n\t\tg.attr('class', 'mouse-focus-label');\r\n\r\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\r\n\t\tlet text = g.select(\".mouse-focus-label-text\");\r\n\t\tlet y = text.select(\".mouse-focus-label-y\");\r\n\t\tlet x = text.select(\".mouse-focus-label-x\");\r\n\r\n\t\tif (!rect.node()) rect = g.append(\"rect\");\r\n\t\tif (!text.node()) text = g.append(\"svg:text\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\r\n\r\n\t\ty.text(labelY);\r\n\t\tx.text(labelX);\r\n\r\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\r\n\t\tlet xAlign = 0;\r\n\t\tlet yAlign = 0;\r\n\t\tlet bbox = { width: 0, height: 0 };\r\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\r\n\r\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\r\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\r\n\r\n\t\trect\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\r\n\t\t\t.attr(\"x\", xAlign - 5)\r\n\t\t\t.attr(\"y\", yAlign - 5)\r\n\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t.attr(\"height\", bbox.height + 10)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\t\ttext\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr(\"y\", yAlign);\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"1em\");\r\n\t\tx\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\r\n\r\n\t\treturn g;\r\n\t};\r\n};\r\n\r\nexport const Scale = ({\r\n\tdata,\r\n\tattr,\r\n\tmin,\r\n\tforceBounds,\r\n\trange,\r\n}) => {\r\n\tlet domain = data ? d3.extent(data, d => d[attr]) : [0, 1];\r\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\r\n\t\tdomain[0] = min;\r\n\t}\r\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\r\n\t\tdomain[1] = max;\r\n\t}\r\n\treturn d3.scaleLinear()\r\n\t\t.range(range)\r\n\t\t.domain(domain);\r\n};\r\n\r\nexport const Bisect = ({\r\n\tdata = [0, 1],\r\n\tscale,\r\n\tx,\r\n\tattr\r\n}) => {\r\n\treturn d3\r\n\t\t.bisector(d => d[attr])\r\n\t\t.left(data, scale.invert(x));\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Chart = L.Class.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\tinitialize: function(options) {\r\n\t\tlet opts = this.options = options;\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._draggingEnabled = opts.dragging;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._xTicks = opts.xTicks;\r\n\t\tthis._yTicks = opts.yTicks;\r\n\r\n\t\tlet scale = this._updateScale();\r\n\r\n\t\tlet svg = this._svg = d3.create(\"svg\")\r\n\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\tlet g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\r\n\t\t\t.call(this._appendGrid())\r\n\t\t\t.call(this._appendAxis())\r\n\t\t\t.call(this._appendAreaPath())\r\n\t\t\t.call(this._appendFocusable())\r\n\t\t\t.call(this._appendLegend());\r\n\r\n\t\tthis._grid = svg.select('.grid');\r\n\t\tthis._area = svg.select('.area');\r\n\t\tthis._path = svg.select('.area path');\r\n\t\tthis._axis = svg.select('.axis');\r\n\t\tthis._focus = svg.select('.focus');\r\n\t\tthis._focusRect = this._focus.select('rect');\r\n\t\tthis._legend = svg.select('.legend');\r\n\t\tthis._x = scale.x;\r\n\t\tthis._y = scale.y;\r\n\r\n\t},\r\n\r\n\tupdate: function(props) {\r\n\t\tif (props.data) this._data = props.data;\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tthis._updateScale();\r\n\t\tthis._updateAxis();\r\n\t\tthis._updateAreaPath();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._svg.node());\r\n\t},\r\n\r\n\t_updateScale: function() {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._x = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [0, this._width()],\r\n\t\t\tattr: opts.xAttr,\r\n\t\t\tmin: opts.xAxisMin,\r\n\t\t\tmax: opts.xAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tthis._y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: opts.yAttr,\r\n\t\t\tmin: opts.yAxisMin,\r\n\t\t\tmax: opts.yAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\treturn { x: this._x, y: this._y };\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll('g').remove();\r\n\t\tthis._axis.selectAll('g').remove();\r\n\t\tthis._grid\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t\tthis._axis\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\r\n\t\t// this.fire('axis_updated');\r\n\t},\r\n\r\n\t_updateAreaPath: function() {\r\n\t\tlet opts = this.options;\r\n\t\tthis._path\r\n\t\t\t.call(\r\n\t\t\t\tD3.Area({\r\n\t\t\t\t\tinterpolation: opts.interpolation,\r\n\t\t\t\t\tdata: this._data,\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\t\tyAttr: opts.yAttr,\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tscaleX: this._x,\r\n\t\t\t\t\tscaleY: this._y,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-axis\".\r\n\t */\r\n\t_appendXaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\tlabel: this._xLabel,\r\n\t\t\tlabelY: 25,\r\n\t\t\tlabelX: this._width() + 6,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\tlabel: this._yLabel,\r\n\t\t\tlabelX: -25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendAreaPath: function() {\r\n\t\treturn g => g.append('g')\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.append('path');\r\n\t},\r\n\r\n\t_appendFocusable: function() {\r\n\t\treturn g => {\r\n\t\t\treturn g.append('g')\r\n\t\t\t\t.attr(\"class\", 'focus')\r\n\t\t\t\t.call(this._appendFocusRect())\r\n\t\t\t\t.call(this._appendMouseFocusG());\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusRect = g.append(\"rect\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.FocusRect({\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tif (L.Browser.mobile) {\r\n\t\t\t\tfocusRect\r\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\t\tL.DomEvent.on(this._svg.node(), 'touchend', this._dragEndHandler, this);\r\n\t\t\t}\r\n\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._svg.node(), 'mouseup', this._dragEndHandler, this);\r\n\r\n\t\t\treturn focusRect;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\r\n\r\n\t\t\tthis._focusline = focusG.append('svg:line')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLine({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);;\r\n\t\t\tthis._focuslabel = focusG.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\tyCoord: 0,\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\tlabelX: \"\",\r\n\t\t\t\t\t\tlabelY: \"\",\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\treturn focusG;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function() {\r\n\t\treturn g => {\r\n\t\t\t// if (!this.options.legend) return;\r\n\r\n\t\t\tlet legend = g.append('g')\r\n\t\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\t\t// this.fire(\"legend\");\r\n\r\n\t\t\t// let items = legend.selectAll('.legend-item')\r\n\t\t\t// \t.on('click', (d, i) => {\r\n\t\t\t// \t\tlet target = items.nodes()[i];\r\n\t\t\t// \t\tlet name = target.getAttribute('data-name');\r\n\t\t\t// \t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t// \t\t// this._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t// \t});\r\n\r\n\t\t\treturn legend;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\r\n\t\tif (!this._dragRectangle) {\r\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t}\r\n\t\tthis._dragRectangle.call(\r\n\t\t\tD3.DragRectangle({\r\n\t\t\t\tdragStartCoords: this._dragStartCoords,\r\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet start = this._findItemForX(this._dragStartCoords[0]);\r\n\t\tlet end = this._findItemForX(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (start == end) return;\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis.fire(\"mouse_enter\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tthis.fire(\"mouse_out\");\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d[this.options.xAttr])\r\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangle) {\r\n\t\t\tthis._dragRectangle.remove();\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hideDiagramIndicator();\r\n\t\t\tthis.fire('reset_drag');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\t// if (!this._chartEnabled) return;\r\n\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\r\n\t\tlet opts = this.options;\r\n\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\tlet [fx, fy] = [opts.hoverNumber.decimalsX, opts.hoverNumber.decimalsY];\r\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\r\n\r\n\t\tthis._focusline.call(\r\n\t\t\tD3.MouseFocusLine({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\theight: this._height()\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis._focuslabel.call(\r\n\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\tyCoord: yCoordinate,\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\tlabelX: formatter(item[opts.xAttr], fx) + \" \" + this._xLabel,\r\n\t\t\t\tlabelY: formatter(item[opts.yAttr], fy) + \" \" + this._yLabel,\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t_hideDiagramIndicator: function() {\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\t},\r\n});\r\n\r\nChart.addInitHook(function() {\r\n\tthis.on('mouse_move', function(e) {\r\n\t\tif (e.item) this._showDiagramIndicator(e.item, e.xCoord);\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Marker = L.Class.extend({\r\n\r\n\tinitialize: function(options) {\r\n\t\tthis.options = options;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tlet g = this._heightG = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tthis._mouseHeightFocus = d3.create('svg:line');\r\n\t\t\tthis._pointG = d3.create(\"svg:circle\");\r\n\t\t\tthis._mouseHeightFocusLabel = d3.create(\"svg:text\");\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000 });\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function(map) {\r\n\t\tthis._map = map;\r\n\t\tlet pane, renderer;\r\n\t\tif (!map.getPane('elevationPane')) {\r\n\t\t\tpane = this._pane = map.createPane('elevationPane');\r\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tpane.style.pointerEvents = 'none';\r\n\t\t}\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\trenderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\t\t\tlet g = this._heightG = d3.select(renderer.getPane()).select(\"svg > g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tg.append(() => this._mouseHeightFocus.node());\r\n\t\t\tg.append(() => this._pointG.node());\r\n\t\t\tg.append(() => this._mouseHeightFocusLabel.node());\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker.addTo(map, { pane: 'elevationPane' });\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\tupdate: function(props) {\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tlet opts = this.options;\r\n\r\n\t\tif (!this._map) this.addTo(props.map);\r\n\r\n\t\tthis._latlng = props.item.latlng;\r\n\r\n\t\tlet point = L.extend({}, props.item, this._map.latLngToLayerPoint(this._latlng));\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\r\n\t\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\t\tlet fy = opts.hoverNumber.decimalsY;\r\n\r\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\r\n\t\t\tlet normalizedY = point.y - normalizedAlt;\r\n\r\n\t\t\tthis._heightG.classed(\"hidden\", false);\r\n\t\t\tthis._pointG.classed(\"hidden\", false);\r\n\r\n\t\t\tthis._pointG\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusPoint({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\tthis._mouseHeightFocus\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLine({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t\tlength: normalizedY\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._mouseHeightFocusLabel\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLabel({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: normalizedY,\r\n\t\t\t\t\t\tlabel: formatter(point[opts.yAttr], fy) + \" \" + this._yLabel\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.removeClass(this._marker.getElement(), 'hidden');\r\n\t\t\tthis._marker.setLatLng(this._latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\tremove: function() {\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tif (this._heightG) this._heightG.classed(\"hidden\", true);\r\n\t\t\tif (this._pointG) this._pointG.classed(\"hidden\", true);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.addClass(this._marker.getElement(), 'hidden');\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function() {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n});\r\n","import * as _ from './utils';\r\n\r\nexport var Options = {\r\n\tautohide: !L.Browser.mobile,\r\n\tautohideMarker: true,\r\n\tcollapsed: false,\r\n\tdetached: true,\r\n\tdistanceFactor: 1,\r\n\tdragging: !L.Browser.mobile,\r\n\tdownloadLink: 'link',\r\n\televationDiv: \"#elevation-div\",\r\n\tfollowMarker: true,\r\n\tforceAxisBounds: false,\r\n\tgpxOptions: {\r\n\t\tasync: true,\r\n\t\tmarker_options: {\r\n\t\t\tstartIconUrl: null,\r\n\t\t\tendIconUrl: null,\r\n\t\t\tshadowUrl: null,\r\n\t\t\twptIcons: {\r\n\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\theight: 200,\r\n\theightFactor: 1,\r\n\thoverNumber: {\r\n\t\tdecimalsX: 2,\r\n\t\tdecimalsY: 0,\r\n\t\tformatter: _.formatter,\r\n\t},\r\n\timperial: false,\r\n\tinterpolation: \"curveLinear\",\r\n\tlazyLoadJS: true,\r\n\tlegend: true,\r\n\tloadData: {\r\n\t\tdefer: false,\r\n\t\tlazy: false,\r\n\t},\r\n\tmarker: 'elevation-line',\r\n\tmarkerIcon: L.divIcon({\r\n\t\tclassName: 'elevation-position-marker',\r\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\ticonSize: [32, 32],\r\n\t\ticonAnchor: [16, 16],\r\n\t}),\r\n\tplaceholder: false,\r\n\tposition: \"topright\",\r\n\tpolyline: {\r\n\t\tclassName: 'elevation-polyline',\r\n\t\tcolor: '#000',\r\n\t\topacity: 0.75,\r\n\t\tweight: 5,\r\n\t\tlineCap: 'round'\r\n\t},\r\n\treverseCoords: false,\r\n\tskipNullZCoords: false,\r\n\ttheme: \"lightblue-theme\",\r\n\tmargins: {\r\n\t\ttop: 10,\r\n\t\tright: 20,\r\n\t\tbottom: 30,\r\n\t\tleft: 50\r\n\t},\r\n\tresponsive: true,\r\n\tsummary: 'inline',\r\n\tslope: false,\r\n\twidth: 600,\r\n\txAttr: \"dist\",\r\n\txLabel: \"km\",\r\n\txTicks: undefined,\r\n\tyAttr: \"z\",\r\n\tyAxisMax: undefined,\r\n\tyAxisMin: undefined,\r\n\tyLabel: \"m\",\r\n\tyTicks: undefined,\r\n\tzFollow: 13,\r\n};\r\n","export var Summary = L.Class.extend({\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Marker } from './marker';\r\nimport { Summary } from './summary';\r\nimport { Options } from './options';\r\n\r\nexport const Elevation = L.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: Options,\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\t__D3: 'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t__LGPX: 'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._addData(d);\r\n\t\t\tthis._addLayer(layer);\r\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tlet eleDiv = this._initElevationDiv();\r\n\t\t\tif (!eleDiv.isConnected) _.insert(map._container, eleDiv, 'afterend');\r\n\t\t\t_.append(eleDiv, this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tthis._clearPath();\r\n\t\tthis._clearChart();\r\n\t\tthis._clearData();\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this.getBounds();\r\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\tgetBounds: function(data) {\r\n\t\tdata = data || this._data;\r\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\t_.style(this._container, \"display\", \"none\");\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options = _.deepMerge({}, this.options, options);\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._chartEnabled = true;\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (_.isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (_.isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\t_.loadFile(url)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.warn(err));\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\t_.GeoJSONLoader(data, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\r\n\t\t\tthis.__LGPX,\r\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._gpxLazyLoader\r\n\t\t).then(() => _.GPXLoader(data, this));\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\r\n\t\t_.waitHolder(opts.lazy)\r\n\t\t\t.then(() => {\r\n\t\t\t\topts.lazy = false;\r\n\t\t\t\tthis.loadData(data, opts)\r\n\t\t\t\tthis.once('eledata_loaded', () => opts.lazy.parentNode.removeChild(elem));\r\n\t\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\t_.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data) {\r\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\r\n\t\t\t_.insert(container, this.placeholder, 'beforebegin');\r\n\t\t}\r\n\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._initToggle(container);\r\n\t\t\tthis._initChart(container);\r\n\t\t\tthis._initMarker(container);\r\n\r\n\t\t\tthis._map.on('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\t\tthis._map.on('resize', this._resetView, this);\r\n\t\t\tthis._map.on('resize', this._resizeChart, this);\r\n\t\t\tthis._map.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\t_.on(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t\t_.on(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\tthis.on('eledata_added', this._updateChart, this);\r\n\t\t\tthis.on('eledata_added', this._updateSummary, this);\r\n\r\n\t\t\tthis._updateChart();\r\n\t\t\tthis._updateSummary();\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\r\n\t\tthis._map.off('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\tthis._map.off('resize', this._resetView, this);\r\n\t\tthis._map.off('resize', this._resizeChart, this);\r\n\t\tthis._map.off('mousedown', this._resetDrag, this);\r\n\r\n\t\t_.off(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t_.off(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\tthis.off('eledata_added', this._updateChart, this);\r\n\t\tthis.off('eledata_added', this._updateSummary, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\t_.style(this._container, \"display\", \"block\");\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\t_.each(d.features, feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXData(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point[1], point[0], point[2]));\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tlet data = this._data || [];\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = new L.LatLng(x, y);\r\n\t\tlet prev = data.length ? data[data.length - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && data.length > 0) {\r\n\t\t\tlet prevZ = data[data.length - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[data.length - 1].z = prevZ;\r\n\t\t\t\telse data.splice(data.length - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance = dist;\r\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\r\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\r\n\r\n\t\tthis._fireEvt(\"eledata_updated\", { index: data.length - 1 });\r\n\t},\r\n\r\n\t_addLayer: function(layer) {\r\n\t\tif (layer) {\r\n\t\t\t_.addClass(layer._path, this.options.polyline.className + ' ' + this.options.theme);\r\n\r\n\t\t\tlayer\r\n\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\r\n\r\n\t\t\tthis._layers = this._layers || {};\r\n\t\t\tthis._layers[L.Util.stamp(layer)] = layer;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_initElevationDiv: function() {\r\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\r\n\t\t\teleDiv = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\t_.addClass(eleDiv, 'elevation-detached');\r\n\t\t\t_.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"div\" summary container.\r\n\t */\r\n\t_appendSummary: function() {\r\n\t\treturn container => {\r\n\t\t\tlet summary = this.summaryDiv = container.append(\"div\")\r\n\t\t\t\t.attr(\"class\", \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : '')).node();\r\n\t\t\t// let summary = this.summaryDiv = _.create('div', \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : ''), container);\r\n\r\n\t\t\tthis._updateSummary();\r\n\t\t\treturn summary;\r\n\t\t};\r\n\t},\r\n\r\n\t/*\r\n\t * Reset chart.\r\n\t */\r\n\t_clearChart: function() {\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data.\r\n\t */\r\n\t_clearData: function() {\r\n\t\tthis._data = null;\r\n\t\tthis._distance = null;\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t\tthis.track_info = null;\r\n\t\tthis._layers = null;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset path.\r\n\t */\r\n\t_clearPath: function() {\r\n\t\tthis._hidePositionMarker();\r\n\t\t_.each(this._layers, l => _.removeClass(l._path, this.options.polyline.className + ' ' + this.options.theme));\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\t_.removeClass(this._container, 'elevation-expanded');\r\n\t\t_.addClass(this._container, 'elevation-collapsed');\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\t_.removeClass(this._container, 'elevation-collapsed');\r\n\t\t_.addClass(this._container, 'elevation-expanded');\r\n\t},\r\n\r\n\t/*\r\n\t * Finds an item with the smallest delta in distance to the given latlng coords\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\tlet result = null;\r\n\t\tlet d = Infinity;\r\n\t\t_.each(this._data,\r\n\t\t\titem => {\r\n\t\t\t\tlet dist = latlng.distanceTo(item.latlng);\r\n\t\t\t\tif (dist < d) {\r\n\t\t\t\t\td = dist;\r\n\t\t\t\t\tresult = item;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn this._chart._findItemForX(x);\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) this.fire(type, data, propagate);\r\n\t\tif (this._map) this._map.fire(type, data, propagate);\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hidePositionMarker: function() {\r\n\t\tif (this.options.autohideMarker) {\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function() {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet chart = this._chart = new Chart(opts);\r\n\r\n\t\tlet container = d3.select(this._container)\r\n\t\t\t.call(this._chart.render())\r\n\t\t\t.call(this._appendSummary());\r\n\r\n\t\tthis._svg = chart._svg;\r\n\t\tthis._grid = chart._grid;\r\n\t\tthis._area = chart._area;\r\n\t\tthis._path = chart._path;\r\n\t\tthis._axis = chart._axis;\r\n\t\tthis._focus = chart._focus;\r\n\t\tthis._focusRect = chart._focusRect;\r\n\t\tthis._x = chart._x;\r\n\t\tthis._y = chart._y;\r\n\t\tthis._legend = chart._legend;\r\n\t\tthis._focuslabel = this._chart._focuslabel;\r\n\t\tthis._focusline = this._chart._focusline;\r\n\r\n\t\tchart.on('reset_drag', this._hidePositionMarker, this);\r\n\t\tchart.on('mouse_enter', this._fireEvt.bind('elechart_enter'), this);\r\n\t\tchart.on('dragged', this._fireEvt.bind(\"elechart_dragged\"), this);\r\n\t\tchart.on('mouse_move', this._mousemoveHandler, this);\r\n\t\tchart.on('mouse_out', this._mouseoutHandler, this);\r\n\t\t// chart.on('legend', this._fireEvt.bind('elechart_legend'), this);\r\n\r\n\t\tthis._fireEvt(\"elechart_init\");\r\n\t},\r\n\r\n\t_initMarker: function(container) {\r\n\t\tthis._marker = new Marker(this.options);\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initToggle: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\t_.on(container, 'mouseover', this._expand, this);\r\n\t\t\t\t\t_.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\r\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet xCoord = e.xCoord;\r\n\t\tlet item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis._showPositionMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.addClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item = this._findItemForLatLng(e.latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\t\tthis._showPositionMarker(item);\r\n\r\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.removeClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\r\n\t\tlet z = this._map.getZoom() + Math.sign(e.deltaY);\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tthis._chart._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds();\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\t// prevent displaying chart on resize if hidden\r\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\r\n\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\t\t\t\tif (newWidth) {\r\n\t\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\t\t_.append(this.eleDiv, this.onAdd(this._map));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t/*\r\n\t * Shows the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_showPositionMarker: function(item) {\r\n\t\tif (this.options.marker) {\r\n\t\t\tthis._marker.update({ item: item, map: this._map, maxElevation: this._maxElevation, options: this.options });\r\n\t\t\tthis._mouseHeightFocusLabel = this._marker._mouseHeightFocusLabel;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_updateChart: function() {\r\n\t\tif (!this._data || !this._container) return;\r\n\r\n\t\tthis._chart = this._chart.update({ data: this._data });\r\n\r\n\t\tthis._x = this._chart._x;\r\n\t\tthis._y = this._chart._y;\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\t\tthis._fireEvt(\"elechart_legend\");\r\n\r\n\t\tthis._fireEvt('elechart_updated');\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tthis.summaryDiv.innerHTML = '';\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance || 0;\r\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\r\n\t\tif (this.options.summary) {\r\n\t\t\tthis._fireEvt(\"elechart_summary\");\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\r\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\r\n\t\t\t};\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Attach here some useful elevation hooks.\r\n */\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on('waypoint_added', function(e) {\r\n\t\tlet p = e.point,\r\n\t\t\tpop = p._popup;\r\n\t\tif (pop) {\r\n\t\t\tpop.options.className = 'elevation-popup';\r\n\t\t}\r\n\t\tif (pop._content) {\r\n\t\t\tpop._content = decodeURI(pop._content);\r\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('elepath_toggle', function(e) {\r\n\t\tlet path = e.path;\r\n\r\n\t\tlet enabled = _.hasClass(path, 'hidden');\r\n\t\tlet text = _.select('text', e.legend);\r\n\r\n\t\tif (enabled) {\r\n\t\t\t_.removeClass(path, 'hidden');\r\n\t\t\t_.style(text, \"text-decoration-line\", \"\")\r\n\t\t} else {\r\n\t\t\t_.addClass(path, 'hidden');\r\n\t\t\t_.style(text, \"text-decoration-line\", \"line-through\")\r\n\t\t}\r\n\r\n\t\tthis._chartEnabled = this._area.selectAll('path:not(.hidden)').nodes().length != 0;\r\n\r\n\t\t// autotoggle chart data on single click\r\n\t\tif (!this._chartEnabled) {;\r\n\t\t\tthis._resetDrag();\r\n\t\t\tthis._clearPath();\r\n\t\t} else {\r\n\t\t\t// this._resizeChart();\r\n\t\t\t_.each(this._layers, l => _.addClass(l._path, this.options.polyline.className + ' ' + this.options.theme));\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_dragged\", function(e) {\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\r\n\t});\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tthis._altitudeLegend = this._legend.append('g')\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t});\r\n\r\n\tthis.on(\"elechart_updated\", function() {\r\n\t\t// TODO: maybe should i listen for this inside chart.js?\r\n\t\tthis._legend.selectAll('.legend-item')\r\n\t\t\t.on('click', (d, i, n) => {\r\n\t\t\t\tlet target = n[i];\r\n\t\t\t\tlet name = target.getAttribute('data-name');\r\n\t\t\t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t});\r\n\t});\r\n\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.summaryDiv.innerHTML +=\r\n\t\t\t'<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>' +\r\n\t\t\t'<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>' +\r\n\t\t\t'<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\r\n\t});\r\n\r\n\tthis.on(\"eletrack_download\", function(e) {\r\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\r\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\r\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\r\n\t\t\te.confirm();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_loaded', function(e) {\r\n\t\tlet layer = e.layer;\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(layer.getBounds());\r\n\t\t\t}, this);\r\n\t\t\tlayer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_clear', function() {\r\n\t\tthis._area.selectAll('path')\r\n\t\t\t.attr(\"d\", \"M0 0\");\r\n\t\tif (this._path) {\r\n\t\t\t// this._x.domain([0, 1]);\r\n\t\t\t// this._y.domain([0, 1]);\r\n\t\t\t// this._updateAxis();\r\n\t\t}\r\n\t});\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (!this.options.slope) return;\r\n\r\n\tlet opts = this.options;\r\n\tlet slope = {};\r\n\topts.margins.right = 50;\r\n\r\n\tif (this.options.slope != \"summary\") {\r\n\r\n\t\tthis.on(\"elechart_init\", function() {\r\n\t\t\tslope.path = this._area.append('path')\r\n\t\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_axis\", function() {\r\n\t\t\tslope.x = this._x;\r\n\r\n\t\t\t// slope.x = D3.Scale({\r\n\t\t\t// \tdata: this._data,\r\n\t\t\t// \trange: [0, this._width()],\r\n\t\t\t// \tattr: opts.xAttr,\r\n\t\t\t// \tmin: opts.xAxisMin,\r\n\t\t\t// \tmax: opts.xAxisMax,\r\n\t\t\t// \tforceBounds: opts.forceAxisBounds,\r\n\t\t\t// });\r\n\r\n\t\t\tslope.y = D3.Scale({\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\trange: [this._height(), 0],\r\n\t\t\t\tattr: \"slope\",\r\n\t\t\t\tmin: -1,\r\n\t\t\t\tmax: +1,\r\n\t\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t\t});\r\n\r\n\t\t\tslope.axis = D3.Axis({\r\n\t\t\t\taxis: \"y\",\r\n\t\t\t\tposition: \"right\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscale: slope.y,\r\n\t\t\t\tticks: this.options.yTicks,\r\n\t\t\t\ttickPadding: 16,\r\n\t\t\t\tlabel: \"%\",\r\n\t\t\t\tlabelX: 25,\r\n\t\t\t\tlabelY: 3,\r\n\t\t\t});\r\n\r\n\t\t\tthis._axis.call(slope.axis);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_updated\", function() {\r\n\t\t\tslope.area = D3.Area({\r\n\t\t\t\tinterpolation: \"curveStepAfter\",\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\tname: 'Slope',\r\n\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\tyAttr: \"slope\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscaleX: slope.x,\r\n\t\t\t\tscaleY: slope.y,\r\n\t\t\t});\r\n\r\n\t\t\tslope.path.call(slope.area);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_legend\", function() {\r\n\t\t\tslope.legend = this._legend.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\t\tname: 'Slope',\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._altitudeLegend\r\n\t\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\r\n\r\n\t\t\tslope.legend\r\n\t\t\t\t.attr(\"transform\", \"translate(50, 0)\");\r\n\r\n\t\t\tslope.legend.select(\"rect\")\r\n\t\t\t\t.classed(\"area\", false)\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\t// Slope / Gain\r\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\r\n\t\tlet tDes = this._tDes || 0; // Total Descent\r\n\t\tlet sMax = this._sMax || 0; // Slope Max\r\n\t\tlet sMin = this._sMin || 0; // Slope Min\r\n\t\tlet diff = 0;\r\n\t\tlet slope = 0;\r\n\r\n\t\tif (!isNaN(z)) {\r\n\t\t\t// diff height between actual and previous point\r\n\t\t\tdiff = i > 0 ? z - data[i - 1].z : 0;\r\n\t\t\tif (diff > 0) tAsc += diff;\r\n\t\t\tif (diff < 0) tDes -= diff;\r\n\t\t\t// slope in % = ( height / length ) * 100\r\n\t\t\tslope = delta !== 0 ? Math.round((diff / delta) * 10000) / 100 : 0;\r\n\t\t\t// apply slope to the previous point because we will\r\n\t\t\t// ascent or desent, so the slope is in the fist point\r\n\t\t\tif (i > 0) data[i - 1].slope = slope;\r\n\t\t\tsMax = slope > sMax ? slope : sMax;\r\n\t\t\tsMin = slope < sMin ? slope : sMin;\r\n\t\t}\r\n\r\n\t\tdata[i].slope = slope;\r\n\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\r\n\t\tthis.track_info.descent = this._tDes = tDes;\r\n\t\tthis.track_info.slope_max = this._sMax = sMax;\r\n\t\tthis.track_info.slope_min = this._sMin = sMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_change\", function(e) {\r\n\t\tlet item = e.data;\r\n\t\tlet xCoordinate = e.xCoord;\r\n\r\n\t\tif (this._focuslabel) {\r\n\t\t\tif (!this._focuslabelSlope || !this._focuslabelSlope.property('isConnected')) {\r\n\t\t\t\tthis._focuslabelSlope = this._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\r\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\r\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._focuslabelSlope.text(item.slope + \"%\");\r\n\r\n\t\t\tthis._focuslabel.select('.mouse-focus-label-x')\r\n\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t}\r\n\r\n\t\tif (this._mouseHeightFocusLabel) {\r\n\t\t\tif (!this._mouseSlopeFocusLabel) {\r\n\t\t\t\tthis._mouseSlopeFocusLabel = this._mouseHeightFocusLabel.append(\"svg:tspan\")\r\n\t\t\t\t\t.attr(\"class\", \"height-focus-slope \");\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseSlopeFocusLabel\r\n\t\t\t\t.attr(\"dy\", \"1.5em\")\r\n\t\t\t\t.text(Math.round(item.slope) + \"%\");\r\n\r\n\t\t\tthis._mouseHeightFocusLabel.select('.height-focus-y')\r\n\t\t\t\t.attr(\"dy\", \"-1.5em\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.ascent = this._tAsc || 0;\r\n\t\tthis.track_info.descent = this._tDes || 0;\r\n\t\tthis.track_info.slope_max = this._sMax || 0;\r\n\t\tthis.track_info.slope_min = this._sMin || 0;\r\n\r\n\t\tthis.summaryDiv.querySelector('.minele').insertAdjacentHTML('afterend', '<span class=\"ascent\"><span class=\"summarylabel\">' + L._(\"Total Ascent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.ascent) + '&nbsp;' +\r\n\t\t\tthis._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"descent\"><span class=\"summarylabel\">' + L._(\"Total Descent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"minslope\"><span class=\"summarylabel\">' + L._(\"Min Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_min + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>' + '<span class=\"maxslope\"><span class=\"summarylabel\">' + L._(\"Max Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_max + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>');\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._sMax = null;\r\n\t\tthis._sMin = null;\r\n\t\tthis._tAsc = null;\r\n\t\tthis._tDes = null;\r\n\t});\r\n\r\n});\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Elevation } from './control';\r\nimport './slope';\r\n\r\nElevation.Utils = _;\r\nElevation.Components = D3;\r\nElevation.Chart = Chart;\r\n\r\nL.control.elevation = (options) => new Elevation(options);\r\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","window","addEventListener","once","formatter","num","dec","sep","res","L","Util","formatNum","toString","numbers","split","d","join","GeoJSONLoader","data","control","JSON","parse","this","layer","geoJson","style","feature","extend","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","item","_typeof","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","requestAnimFrame","removeEventListener","addClass","targetNode","each","s","DomUtil","removeClass","value","getStyle","setProperty","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","factory","define","amd","exports","module","require","locales","locale","registerLocale","code","setLocale","i18n","_","string","template","err","DomEvent","off","hasClass","randomId","Math","random","substr","obj","fn","i","offsetWidth","offsetHeight","getClientRects","Area","xAttr","yAttr","scaleX","scaleY","height","interpolation","path","d3","area","curve","x","xDiagCoord","y0","y1","datum","attr","Axis","tickSize","tickPadding","width","axis","scale","ticks","tickFormat","label","labelX","labelY","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","call","text","DragRectangle","dragStartCoords","dragEndCoords","rect","x1","min","x2","max","FocusRect","Grid","props","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusPoint","circle","LegendItem","margins","toLowerCase","MouseFocusLine","MouseFocusLabel","xAlign","yAlign","bbox","getBBox","Browser","webkit","Infinity","Scale","forceBounds","range","domain","extent","scaleLinear","bisector","invert","Chart","Class","includes","Evented","prototype","Mixin","Events","initialize","opts","_data","_draggingEnabled","dragging","imperial","_xLabel","_yLabel","xLabel","yLabel","_xTicks","xTicks","_yTicks","yTicks","_updateScale","svg","_svg","_appendGrid","_appendAxis","_appendAreaPath","_appendFocusable","_appendLegend","_grid","_area","_path","_axis","_focus","_focusRect","_legend","_x","_y","update","_updateAxis","_updateAreaPath","render","container","_this","D3","_width","xAxisMin","xAxisMax","forceAxisBounds","_height","yAxisMin","yAxisMax","remove","_appendXGrid","_appendYGrid","_appendXaxis","_appendYaxis","_this2","_this3","_this4","_appendFocusRect","_appendMouseFocusG","focusRect","_this5","mobile","_dragStartHandler","bind","_dragHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_mouseoutHandler","focusG","_this6","_focusG","_focusline","_focuslabel","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","mouse","_dragRectangle","_dragCurrentCoords","_resetDrag","start","_findItemForX","end","dragstart","dragend","ctx","_this7","_hideDiagramIndicator","_showDiagramIndicator","xCoordinate","classed","hoverNumber","decimalsX","decimalsY","fx","fy","yCoordinate","addInitHook","Marker","_heightG","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","_marker","markerIcon","zIndexOffset","addTo","map","pane","renderer","_map","getPane","_pane","createPane","zIndex","_latlng","latLngToLayerPoint","normalizedAlt","maxElevation","z","normalizedY","getElement","setLatLng","getLatLng","Options","autohide","autohideMarker","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","legend","loadData","defer","placeholder","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","responsive","summary","slope","undefined","zFollow","Elevation","Control","__mileFactor","__footFactor","__D3","__LGPX","_d3LazyLoader","then","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","_container","onAdd","clear","_clearPath","_clearChart","_clearData","disableDragging","_chart","enableDragging","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","_distanceFactor","_heightFactor","_chartEnabled","_setMapView","throttle","load","loadChart","loadDefer","loadLazy","loadGPX","loadGeoJSON","_downloadURL","catch","_gpxLazyLoader","parentNode","alt","_initToggle","_initChart","_initMarker","_hidePositionMarker","_resetView","_resizeChart","_updateChart","_updateSummary","onRemove","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","coords","features","_addGPXData","_addPoint","_this8","lat","lng","meta","ele","eleMax","_maxElevation","eleMin","_minElevation","dist","_distance","curr","LatLng","prev","delta","distanceTo","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","distance","elevation_max","elevation_min","index","_mousemoveLayerHandler","_layers","stamp","id","_appendSummary","_this9","summaryDiv","_this10","_collapse","_expand","_findItemForLatLng","result","propagate","offWi","offHe","_maxWidth","containerWidth","clientWidth","chart","disableClickPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_showPositionMarker","gestureHandling","_enabled","ll","getCenter","getZoom","sign","deltaY","flyTo","_isFullscreen","newWidth","innerHTML","removeControl","setView","animate","duration","onclick","_this11","confirm","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enabled","nodes","_this12","_altitudeLegend","n","getAttribute","_this13","toFixed","CustomEvent","dispatchEvent","detail","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","diff","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseSlopeFocusLabel","insertAdjacentHTML","Utils","Components","elevation"],"mappings":"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"}