{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/chart.js","../src/marker.js","../src/summary.js","../src/options.js","../src/control.js","../src/altitude.js","../src/slope.js","../src/index.js"],"sourcesContent":["/**\r\n * Recursive deep merge objects.\r\n * Alternative to L.Util.setOptions(this, options).\r\n */\r\nexport function deepMerge(target, ...sources) {\r\n\tif (!sources.length) return target;\r\n\tconst source = sources.shift();\r\n\tif (isObject(target) && isObject(source)) {\r\n\t\tfor (const key in source) {\r\n\t\t\tif (isObject(source[key])) {\r\n\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t[key]: {}\r\n\t\t\t\t});\r\n\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn deepMerge(target, ...sources);\r\n}\r\n\r\n/**\r\n * Wait for document load before execute function.\r\n */\r\nexport function deferFunc(f) {\r\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\r\n\telse f();\r\n}\r\n\r\n/*\r\n * Similar to L.Util.formatNum\r\n */\r\nexport function formatNum(num, dec, sep) {\r\n\treturn num.toFixed(dec).toString().split(\".\").join(sep || \".\");\r\n}\r\n\r\n/**\r\n * Simple GeoJSON data loader.\r\n */\r\nexport function GeoJSONLoader(data, control) {\r\n\tif (typeof data === \"string\") {\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tcontrol = control || this;\r\n\r\n\tlet layer = L.geoJson(data, {\r\n\t\tstyle: (feature) => {\r\n\t\t\tlet style = L.extend({}, control.options.polyline);\r\n\t\t\tif (control.options.theme) {\r\n\t\t\t\tstyle.className += ' ' + control.options.theme;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\tif (name || desc) {\r\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t}\r\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\treturn marker;\r\n\t\t},\r\n\t\tonEachFeature: (feature, layer) => {\r\n\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\tcontrol.addData(feature, layer);\r\n\r\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\r\n\t\t},\r\n\t});\r\n\r\n\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info })\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Simple GPX data loader.\r\n */\r\nexport function GPXLoader(data, control) {\r\n\tcontrol = control || this;\r\n\r\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\r\n\r\n\tif (control.options.theme) {\r\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\r\n\t}\r\n\r\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\r\n\r\n\t// similar to L.GeoJSON.pointToLayer\r\n\tlayer.on('addpoint', (e) => {\r\n\t\tcontrol.fire(\"waypoint_added\", e);\r\n\t});\r\n\r\n\t// similar to L.GeoJSON.onEachFeature\r\n\tlayer.on(\"addline\", (e) => {\r\n\t\tcontrol.addData(e.line /*, layer*/ );\r\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\r\n\t});\r\n\r\n\t// unlike the L.GeoJSON, L.GPX parsing is async\r\n\tlayer.once('loaded', (e) => {\r\n\t\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info });\r\n\t\t});\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Check DOM element visibility.\r\n */\r\nexport function isDomVisible(elem) {\r\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n}\r\n\r\n/**\r\n * Check object type.\r\n */\r\nexport function isObject(item) {\r\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n/**\r\n * Check DOM element viewport visibility.\r\n */\r\nexport function isVisible(elem) {\r\n\tif (!elem) return false;\r\n\r\n\tlet styles = window.getComputedStyle(elem);\r\n\r\n\tfunction isVisibleByStyles(elem, styles) {\r\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t}\r\n\r\n\tfunction isAboveOtherElements(elem, styles) {\r\n\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\tlet left = boundingRect.left + 1;\r\n\t\tlet right = boundingRect.right - 1;\r\n\t\tlet top = boundingRect.top + 1;\r\n\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\tlet above = true;\r\n\r\n\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t// Only for completely visible elements\r\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\treturn above;\r\n\t}\r\n\r\n\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Check JSON object type.\r\n */\r\nexport function isJSONDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tJSON.parse(doc.toString());\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Check XML object type.\r\n */\r\nexport function isXMLDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"<\") == 0;\r\n\t} else {\r\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Async JS script download.\r\n */\r\nexport function lazyLoader(url, skip, loader) {\r\n\tif (skip === false) {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\tif (loader instanceof Promise) {\r\n\t\treturn loader;\r\n\t}\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\n/**\r\n * Download data from a remote url.\r\n */\r\nexport function loadFile(url, success) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = \"text\";\r\n\t\txhr.open('GET', url);\r\n\t\txhr.onload = () => resolve(xhr.response);\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\n/**\r\n * Generate download data event.\r\n */\r\nexport function saveFile(dataURI, fileName) {\r\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\r\n\tlet b = document.body;\r\n\tb.appendChild(a);\r\n\ta.click();\r\n\tb.removeChild(a);\r\n}\r\n\r\n/**\r\n * Wait for element visible before execute function.\r\n */\r\nexport function waitHolder(elem) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = () => {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(() => {\r\n\t\t\t\t\tif (isVisible(elem)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t});\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t});\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.addClass\r\n */\r\nexport function addClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.addClass(targetNode, s); });\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.removeClass()\r\n */\r\nexport function removeClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.removeClass(targetNode, s); });\r\n}\r\n\r\nexport function toggleClass(targetNode, className, conditional) {\r\n\treturn (conditional ? addClass : removeClass).call(null, targetNode, className)\r\n}\r\n\r\nexport function style(targetNode, name, value) {\r\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\r\n\telse return targetNode.style.setProperty(name, value);\r\n}\r\n\r\n/**\r\n * A little bit shorter than L.DomUtil.create()\r\n */\r\nexport function create(tagName, className, attributes, parent) {\r\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\r\n\tif (attributes) setAttributes(elem, attributes);\r\n\tif (parent) append(parent, elem);\r\n\treturn elem;\r\n}\r\n\r\n/**\r\n * Same as node.appendChild()\r\n */\r\nexport function append(parent, child) {\r\n\treturn parent.appendChild(child);\r\n}\r\n\r\n/**\r\n * Same as node.insertAdjacentElement()\r\n */\r\nexport function insert(parent, child, position) {\r\n\treturn parent.insertAdjacentElement(position, child);\r\n}\r\n\r\n/**\r\n * Loop for node.setAttribute()\r\n */\r\nexport function setAttributes(elem, attrs) {\r\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\r\n}\r\n\r\n/**\r\n * Same as node.querySelector().\r\n */\r\nexport function select(selector, context) {\r\n\treturn (context || document).querySelector(selector);\r\n}\r\n\r\n/**\r\n * Alias for L.DomEvent.on.\r\n */\r\nexport const on = L.DomEvent.on;\r\n\r\n/**\r\n * Alias for L.DomEvent.off.\r\n */\r\nexport const off = L.DomEvent.off;\r\n\r\n/**\r\n * Alias for L.DomUtil.hasClass.\r\n */\r\nexport const hasClass = L.DomUtil.hasClass;\r\n\r\n\r\nexport function randomId() {\r\n\treturn Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nexport function each(obj, fn) {\r\n\tfor (let i in obj) fn(obj[i], i);\r\n}\r\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Area = ({\r\n\tdata,\r\n\tname,\r\n\txAttr,\r\n\tyAttr,\r\n\tscaleX,\r\n\tscaleY,\r\n\theight,\r\n\tinterpolation = \"curveLinear\",\r\n}) => {\r\n\treturn path => {\r\n\t\tif (typeof interpolation === 'string') interpolation = d3[interpolation];\r\n\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\r\n\t\t\t.y0(height)\r\n\t\t\t.y1(d => scaleY(d[yAttr]));\r\n\r\n\t\tif (data) path.datum(data).attr(\"d\", area);\r\n\t\tif (name) path.attr('data-name', name);\r\n\r\n\t\treturn area;\r\n\t};\r\n};\r\n\r\nexport const AreaPath = (props) => {\r\n\treturn d3.create('svg:path')\r\n\t\t.attr(\"class\", \"area\")\r\n\t\t.call(Area(props));\r\n};\r\n\r\nexport const Axis = ({\r\n\ttype = \"axis\",\r\n\ttickSize = 6,\r\n\ttickPadding = 3,\r\n\tposition,\r\n\theight,\r\n\twidth,\r\n\taxis,\r\n\tscale,\r\n\tticks,\r\n\ttickFormat,\r\n\tlabel,\r\n\tlabelX,\r\n\tlabelY\r\n}) => {\r\n\treturn g => {\r\n\t\tlet [w, h] = [0, 0];\r\n\t\tif (position == \"bottom\") h = height;\r\n\t\tif (position == \"right\") w = width;\r\n\r\n\t\tif (axis == \"x\" && type == \"grid\") {\r\n\t\t\ttickSize = -height;\r\n\t\t} else if (axis == \"y\" && type == \"grid\") {\r\n\t\t\ttickSize = -width;\r\n\t\t}\r\n\r\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\r\n\t\t\t.scale(scale)\r\n\t\t\t.ticks(ticks)\r\n\t\t\t.tickPadding(tickPadding)\r\n\t\t\t.tickSize(tickSize)\r\n\t\t\t.tickFormat(tickFormat);\r\n\r\n\t\tlet axisGroup = g.append(\"g\")\r\n\t\t\t.attr(\"class\", [axis, type, position].join(\" \"))\r\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\r\n\t\t\t.call(axisScale);\r\n\r\n\t\tif (label) {\r\n\t\t\taxisGroup.append(\"text\")\r\n\t\t\t\t.attr(\"x\", labelX)\r\n\t\t\t\t.attr(\"y\", labelY)\r\n\t\t\t\t.text(label);\r\n\t\t}\r\n\r\n\t\treturn axisGroup;\r\n\t};\r\n};\r\n\r\nexport const DragRectangle = ({\r\n\tdragStartCoords,\r\n\tdragEndCoords,\r\n\theight,\r\n}) => {\r\n\treturn rect => {\r\n\t\tlet x1 = Math.min(dragStartCoords[0], dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\treturn rect\r\n\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.attr(\"x\", x1);\r\n\t};\r\n};\r\n\r\nexport const FocusRect = ({\r\n\twidth,\r\n\theight,\r\n}) => {\r\n\treturn rect => rect\r\n\t\t.attr(\"width\", width)\r\n\t\t.attr(\"height\", height)\r\n\t\t.style(\"fill\", \"none\")\r\n\t\t.style(\"stroke\", \"none\")\r\n\t\t.style(\"pointer-events\", \"all\");\r\n};\r\n\r\nexport const Grid = (props) => {\r\n\tprops.type = \"grid\";\r\n\treturn Axis(props);\r\n};\r\n\r\nexport const HeightFocusLine = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlength = 0,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t.attr(\"x1\", xCoord)\r\n\t\t.attr(\"x2\", xCoord)\r\n\t\t.attr(\"y1\", yCoord)\r\n\t\t.attr(\"y2\", length);\r\n};\r\n\r\nexport const HeightFocusLabel = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlabel,\r\n}) => {\r\n\treturn text => {\r\n\t\ttext\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t.attr(\"x\", xCoord + 5)\r\n\t\t\t.attr(\"y\", yCoord);\r\n\r\n\t\tlet y = text.select(\".height-focus-y\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"height-focus-y\")\r\n\t\t\t.text(label);\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\r\n\r\n\t\treturn text;\r\n\t};\r\n};\r\n\r\nexport const HeightFocusMarker = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n}) => {\r\n\treturn circle => circle\r\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\r\n\t\t.attr(\"r\", 6)\r\n\t\t.attr(\"cx\", 0)\r\n\t\t.attr(\"cy\", 0);\r\n};\r\n\r\n\r\nexport const LegendItem = ({\r\n\tname,\r\n\twidth,\r\n\theight,\r\n\tmargins = {},\r\n}) => {\r\n\treturn g => {\r\n\t\tg\r\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\r\n\t\t\t.attr(\"data-name\", name);\r\n\r\n\t\tg.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (width / 2) - 50)\r\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 10)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\tg.append('text')\r\n\t\t\t.text(L._(name))\r\n\t\t\t.attr(\"x\", (width / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', height + margins.bottom / 2)\r\n\t\t\t.attr('dy', \"0.75em\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const MouseFocusLine = ({\r\n\txCoord = 0,\r\n\theight,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr('class', 'mouse-focus-line')\r\n\t\t.attr('x2', xCoord)\r\n\t\t.attr('y2', 0)\r\n\t\t.attr('x1', xCoord)\r\n\t\t.attr('y1', height);\r\n};\r\n\r\nexport const MouseFocusLabel = ({\r\n\txCoord,\r\n\tyCoord,\r\n\tlabelX = \"\",\r\n\tlabelY = \"\",\r\n\twidth,\r\n}) => {\r\n\treturn g => {\r\n\r\n\t\tg.attr('class', 'mouse-focus-label');\r\n\r\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\r\n\t\tlet text = g.select(\".mouse-focus-label-text\");\r\n\t\tlet y = text.select(\".mouse-focus-label-y\");\r\n\t\tlet x = text.select(\".mouse-focus-label-x\");\r\n\r\n\t\tif (!rect.node()) rect = g.append(\"rect\");\r\n\t\tif (!text.node()) text = g.append(\"svg:text\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\r\n\r\n\t\ty.text(labelY);\r\n\t\tx.text(labelX);\r\n\r\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\r\n\t\tlet xAlign = 0;\r\n\t\tlet yAlign = 0;\r\n\t\tlet bbox = { width: 0, height: 0 };\r\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\r\n\r\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\r\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\r\n\r\n\t\trect\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\r\n\t\t\t.attr(\"x\", xAlign - 5)\r\n\t\t\t.attr(\"y\", yAlign - 5)\r\n\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t.attr(\"height\", bbox.height + 10)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\t\ttext\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr(\"y\", yAlign);\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"1em\");\r\n\t\tx\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\r\n\r\n\t\treturn g;\r\n\t};\r\n};\r\n\r\nexport const Scale = ({\r\n\tdata,\r\n\tattr,\r\n\tmin,\r\n\tforceBounds,\r\n\trange,\r\n}) => {\r\n\tlet domain = data ? d3.extent(data, d => d[attr]) : [0, 1];\r\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\r\n\t\tdomain[0] = min;\r\n\t}\r\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\r\n\t\tdomain[1] = max;\r\n\t}\r\n\treturn d3.scaleLinear()\r\n\t\t.range(range)\r\n\t\t.domain(domain);\r\n};\r\n\r\nexport const Bisect = ({\r\n\tdata = [0, 1],\r\n\tscale,\r\n\tx,\r\n\tattr\r\n}) => {\r\n\treturn d3\r\n\t\t.bisector(d => d[attr])\r\n\t\t.left(data, scale.invert(x));\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Chart = L.Class.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\tinitialize: function(opts) {\r\n\t\tthis.options = opts;\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._draggingEnabled = opts.dragging;\r\n\r\n\t\tif (opts.imperial) {\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._xLabel = opts.xLabel;\r\n\t\t\tthis._yLabel = opts.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._xTicks = opts.xTicks;\r\n\t\tthis._yTicks = opts.yTicks;\r\n\r\n\t\tlet scale = this._updateScale();\r\n\r\n\t\tlet svg = this._container = d3.create(\"svg\")\r\n\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\tlet g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\r\n\t\t\t.call(this._appendGrid())\r\n\t\t\t.call(this._appendAxis())\r\n\t\t\t.call(this._appendAreaPath())\r\n\t\t\t.call(this._appendFocusable())\r\n\t\t\t.call(this._appendLegend());\r\n\r\n\t\tthis._grid = svg.select('.grid');\r\n\t\tthis._area = svg.select('.area');\r\n\t\tthis._path = svg.select('.area path');\r\n\t\tthis._axis = svg.select('.axis');\r\n\t\tthis._focus = svg.select('.focus');\r\n\t\tthis._focusRect = this._focus.select('rect');\r\n\t\tthis._legend = svg.select('.legend');\r\n\t\tthis._x = scale.x;\r\n\t\tthis._y = scale.y;\r\n\r\n\t},\r\n\r\n\tupdate: function(props) {\r\n\t\tif (props.data) this._data = props.data;\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tthis._updateScale();\r\n\t\tthis._updateAxis();\r\n\t\tthis._updateAreaPath();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._container.node());\r\n\t},\r\n\r\n\tclear: function() {\r\n\t\tthis._resetDrag();\r\n\t\tthis._area.selectAll('path').attr(\"d\", \"M0 0\");\r\n\t\tif (this._path) {\r\n\t\t\t// this._x.domain([0, 1]);\r\n\t\t\t// this._y.domain([0, 1]);\r\n\t\t\t// this._updateAxis();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateScale: function() {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._x = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [0, this._width()],\r\n\t\t\tattr: opts.xAttr,\r\n\t\t\tmin: opts.xAxisMin,\r\n\t\t\tmax: opts.xAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tthis._y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: opts.yAttr,\r\n\t\t\tmin: opts.yAxisMin,\r\n\t\t\tmax: opts.yAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\treturn { x: this._x, y: this._y };\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll('g').remove();\r\n\t\tthis._axis.selectAll('g').remove();\r\n\t\tthis._grid\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t\tthis._axis\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\r\n\t\t// this.fire('axis_updated');\r\n\t},\r\n\r\n\t_updateAreaPath: function() {\r\n\t\tlet opts = this.options;\r\n\t\tthis._path\r\n\t\t\t.call(\r\n\t\t\t\tD3.Area({\r\n\t\t\t\t\tinterpolation: opts.interpolation,\r\n\t\t\t\t\tdata: this._data,\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\t\tyAttr: opts.yAttr,\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tscaleX: this._x,\r\n\t\t\t\t\tscaleY: this._y,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-axis\".\r\n\t */\r\n\t_appendXaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\tlabel: this._xLabel,\r\n\t\t\tlabelY: 25,\r\n\t\t\tlabelX: this._width() + 6,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\tlabel: this._yLabel,\r\n\t\t\tlabelX: -25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendAreaPath: function() {\r\n\t\treturn g => g.append('g')\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.append('path');\r\n\t},\r\n\r\n\t_appendFocusable: function() {\r\n\t\treturn g => {\r\n\t\t\treturn g.append('g')\r\n\t\t\t\t.attr(\"class\", 'focus')\r\n\t\t\t\t.call(this._appendFocusRect())\r\n\t\t\t\t.call(this._appendMouseFocusG());\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusRect = g.append(\"rect\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.FocusRect({\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tif (L.Browser.mobile) {\r\n\t\t\t\tfocusRect\r\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\t\tL.DomEvent.on(this._container.node(), 'touchend', this._dragEndHandler, this);\r\n\t\t\t}\r\n\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._container.node(), 'mouseup', this._dragEndHandler, this);\r\n\r\n\t\t\treturn focusRect;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\r\n\r\n\t\t\tthis._focusline = focusG.append('svg:line')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLine({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);;\r\n\t\t\tthis._focuslabel = focusG.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\tyCoord: 0,\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\tlabelX: \"\",\r\n\t\t\t\t\t\tlabelY: \"\",\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\treturn focusG;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function() {\r\n\t\treturn g => {\r\n\t\t\t// if (!this.options.legend) return;\r\n\r\n\t\t\tlet legend = g.append('g')\r\n\t\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\t\t// this.fire(\"legend\");\r\n\r\n\t\t\t// let items = legend.selectAll('.legend-item')\r\n\t\t\t// \t.on('click', (d, i) => {\r\n\t\t\t// \t\tlet target = items.nodes()[i];\r\n\t\t\t// \t\tlet name = target.getAttribute('data-name');\r\n\t\t\t// \t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t// \t\t// this._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t// \t});\r\n\r\n\t\t\treturn legend;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\r\n\t\tif (!this._dragRectangle) {\r\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t}\r\n\t\tthis._dragRectangle.call(\r\n\t\t\tD3.DragRectangle({\r\n\t\t\t\tdragStartCoords: this._dragStartCoords,\r\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet start = this._findIndexForXCoord(this._dragStartCoords[0]);\r\n\t\tlet end = this._findIndexForXCoord(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (start == end) return;\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis.fire(\"mouse_enter\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findIndexForXCoord(xCoord)];\r\n\r\n\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tthis.fire(\"mouse_out\");\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findIndexForXCoord: function(x) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d[this.options.xAttr])\r\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given latlng of the map\r\n\t */\r\n\t_findIndexForLatLng: function(latlng) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d.latlng)\r\n\t\t\t.left(this._data, latlng)\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangle) {\r\n\t\t\tthis._dragRectangle.remove();\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hideDiagramIndicator();\r\n\t\t\tthis.fire('reset_drag');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\t// if (!this._chartEnabled) return;\r\n\r\n\t\tlet opts = this.options;\r\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\r\n\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\r\n\t\tthis._focusline.call(\r\n\t\t\tD3.MouseFocusLine({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\theight: this._height()\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis._focuslabel.call(\r\n\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\tyCoord: yCoordinate,\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\tlabelX: _.formatNum(item[opts.xAttr], opts.decimalsX) + \" \" + this._xLabel,\r\n\t\t\t\tlabelY: _.formatNum(item[opts.yAttr], opts.decimalsY) + \" \" + this._yLabel,\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t_hideDiagramIndicator: function() {\r\n\t\tthis._focusG.classed(\"hidden\", true);\r\n\t},\r\n});\r\n\r\n// Chart.addInitHook(function() {\r\n// \tthis.on('mouse_move', function(e) {\r\n// \t\tif (e.item) this._showDiagramIndicator(e.item, e.xCoord);\r\n// \t});\r\n//\r\n// });\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Marker = L.Class.extend({\r\n\r\n\tinitialize: function(options) {\r\n\t\tthis.options = options;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\t// this._container = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tthis._focusline = d3.create('svg:line');\r\n\t\t\tthis._focusmarker = d3.create(\"svg:circle\");\r\n\t\t\tthis._focuslabel = d3.create(\"svg:text\");\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000, interactive: false });\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddTo: function(map) {\r\n\t\tthis._map = map;\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tlet g = this._container = d3.select(map.getPane('elevationPane')).select(\"svg > g\")\r\n\t\t\t\t.attr(\"class\", \"height-focus-group\");\r\n\t\t\tg.append(() => this._focusline.node());\r\n\t\t\tg.append(() => this._focusmarker.node());\r\n\t\t\tg.append(() => this._focuslabel.node());\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker.addTo(map, { pane: 'elevationPane' });\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\tupdate: function(props) {\r\n\t\tif (props.options) this.options = props.options;\r\n\t\tif (!this._map) this.addTo(props.map);\r\n\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._latlng = props.item.latlng;\r\n\r\n\t\tlet point = L.extend({}, props.item, this._map.latLngToLayerPoint(this._latlng));\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\r\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\r\n\t\t\tlet normalizedY = point.y - normalizedAlt;\r\n\r\n\t\t\tthis._container.classed(\"hidden\", false);\r\n\r\n\t\t\tthis._focusmarker\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusMarker({\r\n\t\t\t\t\t\ttheme: opts.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\tthis._focusline\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLine({\r\n\t\t\t\t\t\ttheme: opts.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t\tlength: normalizedY\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._focuslabel\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLabel({\r\n\t\t\t\t\t\ttheme: opts.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: normalizedY,\r\n\t\t\t\t\t\tlabel: _.formatNum(point[opts.yAttr], opts.decimalsY) + \" \" + this._yLabel\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.removeClass(this._marker.getElement(), 'hidden');\r\n\t\t\tthis._marker.setLatLng(this._latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\tremove: function() {\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tif (this._container) this._container.classed(\"hidden\", true);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.addClass(this._marker.getElement(), 'hidden');\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function() {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Summary = L.Class.extend({\r\n\tinitialize: function(opts) {\r\n\t\tthis.options = opts;\r\n\r\n\t\tlet summary = this._container = _.create(\"div\", \"elevation-summary \" + (opts.summary ? opts.summary + \"-summary\" : ''));\r\n\t\t_.style(summary, 'max-width', opts.width ? opts.width + 'px' : '');\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._container);\r\n\t},\r\n\r\n\treset: function() {\r\n\t\tthis._container.innerHTML = '';\r\n\t}\r\n\r\n});\r\n","import * as _ from './utils';\r\n\r\nexport var Options = {\r\n\tautohide: !L.Browser.mobile,\r\n\tautohideMarker: true,\r\n\tcollapsed: false,\r\n\tdetached: true,\r\n\tdistanceFactor: 1,\r\n\tdecimalsX: 2,\r\n\tdecimalsY: 0,\r\n\tdragging: !L.Browser.mobile,\r\n\tdownloadLink: 'link',\r\n\televationDiv: \"#elevation-div\",\r\n\tfollowMarker: true,\r\n\tforceAxisBounds: false,\r\n\tgpxOptions: {\r\n\t\tasync: true,\r\n\t\tmarker_options: {\r\n\t\t\tstartIconUrl: null,\r\n\t\t\tendIconUrl: null,\r\n\t\t\tshadowUrl: null,\r\n\t\t\twptIcons: {\r\n\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\theight: 200,\r\n\theightFactor: 1,\r\n\timperial: false,\r\n\tinterpolation: \"curveLinear\",\r\n\tlazyLoadJS: true,\r\n\tlegend: true,\r\n\tloadData: {\r\n\t\tdefer: false,\r\n\t\tlazy: false,\r\n\t},\r\n\tmargins: {\r\n\t\ttop: 10,\r\n\t\tright: 20,\r\n\t\tbottom: 30,\r\n\t\tleft: 50\r\n\t},\r\n\tmarker: 'elevation-line',\r\n\tmarkerIcon: L.divIcon({\r\n\t\tclassName: 'elevation-position-marker',\r\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\ticonSize: [32, 32],\r\n\t\ticonAnchor: [16, 16],\r\n\t}),\r\n\tplaceholder: false,\r\n\tposition: \"topright\",\r\n\tpolyline: {\r\n\t\tclassName: 'elevation-polyline',\r\n\t\tcolor: '#000',\r\n\t\topacity: 0.75,\r\n\t\tweight: 5,\r\n\t\tlineCap: 'round'\r\n\t},\r\n\treverseCoords: false,\r\n\tskipNullZCoords: false,\r\n\ttheme: \"lightblue-theme\",\r\n\tresponsive: true,\r\n\tsummary: 'inline',\r\n\tslope: false,\r\n\tsDeltaMax: undefined,\r\n\tsInterpolation: \"curveStepAfter\",\r\n\tsRange: undefined,\r\n\twidth: 600,\r\n\txAttr: \"dist\",\r\n\txLabel: \"km\",\r\n\txTicks: undefined,\r\n\tyAttr: \"z\",\r\n\tyAxisMax: undefined,\r\n\tyAxisMin: undefined,\r\n\tyLabel: \"m\",\r\n\tyTicks: undefined,\r\n\tzFollow: 13,\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Marker } from './marker';\r\nimport { Summary } from './summary';\r\nimport { Options } from './options';\r\n\r\nexport const Elevation = L.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: Options,\r\n\t_data: [],\r\n\t_layers: L.featureGroup(),\r\n\t_chartEnabled: true,\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\t__D3: 'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t__LGPX: 'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._addData(d);\r\n\t\t\tthis._addLayer(layer);\r\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tlet eleDiv = this._initElevationDiv();\r\n\t\t\tif (!eleDiv.isConnected) _.insert(map.getContainer(), eleDiv, 'afterend');\r\n\t\t\t_.append(eleDiv, this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tthis._marker.remove();\r\n\t\tthis._chart.clear();\r\n\t\tthis._layers.clearLayers();\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._distance = 0;\r\n\t\tthis.track_info = {};\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this.getBounds();\r\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\tgetBounds: function(data) {\r\n\t\tdata = data || this._data;\r\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\t_.style(this._container, \"display\", \"none\");\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options = _.deepMerge({}, this.options, options);\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (_.isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (_.isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\t_.loadFile(url)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.warn(err));\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\t_.GeoJSONLoader(data, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\r\n\t\t\tthis.__LGPX,\r\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._gpxLazyLoader\r\n\t\t).then(() => _.GPXLoader(data, this));\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\r\n\t\t_.waitHolder(elem)\r\n\t\t\t.then(() => {\r\n\t\t\t\topts.lazy = false;\r\n\t\t\t\tthis.loadData(data, opts)\r\n\t\t\t\tthis.once('eledata_loaded', () => opts.lazy.parentNode.removeChild(elem));\r\n\t\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\t_.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data.length) {\r\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\r\n\t\t\t_.insert(container, this.placeholder, 'beforebegin');\r\n\t\t}\r\n\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._initButton(container);\r\n\t\t\tthis._initChart(container);\r\n\t\t\tthis._initSummary(container);\r\n\t\t\tthis._initMarker(map);\r\n\t\t\tthis._initLayer(map);\r\n\r\n\t\t\tmap\r\n\t\t\t\t.on('zoom viewreset zoomanim', this._hideMarker, this)\r\n\t\t\t\t.on('resize', this._resetView, this)\r\n\t\t\t\t.on('resize', this._resizeChart, this)\r\n\t\t\t\t.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\t_.on(map.getContainer(), 'mousewheel', this._resetDrag, this);\r\n\t\t\t_.on(map.getContainer(), 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\tthis\r\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateChart, this)\r\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateSummary, this);\r\n\r\n\t\t\tthis._updateChart();\r\n\t\t\tthis._updateSummary();\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\r\n\t\tmap\r\n\t\t\t.off('zoom viewreset zoomanim', this._hideMarker, this)\r\n\t\t\t.off('resize', this._resetView, this)\r\n\t\t\t.off('resize', this._resizeChart, this)\r\n\t\t\t.off('mousedown', this._resetDrag, this);\r\n\r\n\t\t_.off(map.getContainer(), 'mousewheel', this._resetDrag, this);\r\n\t\t_.off(map.getContainer(), 'touchstart', this._resetDrag, this);\r\n\r\n\t\tthis\r\n\t\t\t.off('eledata_added eledata_loaded', this._updateChart, this)\r\n\t\t\t.off('eledata_added eledata_loaded', this._updateSummary, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\t_.style(this._container, \"display\", \"block\");\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\t_.each(d.features, feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXData(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point[1], point[0], point[2]));\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tlet data = this._data || [];\r\n\t\tlet i = data.length;\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = new L.LatLng(x, y);\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance = dist;\r\n\r\n\t\tthis._fireEvt(\"eledata_updated\", { index: i });\r\n\t},\r\n\r\n\t_addLayer: function(layer) {\r\n\t\tif (layer) this._layers.addLayer(layer)\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_initElevationDiv: function() {\r\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\r\n\t\t\teleDiv = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\t_.addClass(eleDiv, 'elevation-detached');\r\n\t\t\t_.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\t_.removeClass(this._container, 'elevation-expanded');\r\n\t\t_.addClass(this._container, 'elevation-collapsed');\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\t_.removeClass(this._container, 'elevation-collapsed');\r\n\t\t_.addClass(this._container, 'elevation-expanded');\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for the given LatLng\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\treturn this._data[this._chart._findIndexForLatLng(latlng)];\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for the given xDiagCoord\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn this._data[this._chart._findIndexForXCoord(x)];\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) this.fire(type, data, propagate);\r\n\t\tif (this._map) this._map.fire(type, data, propagate);\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hideMarker: function() {\r\n\t\tif (this.options.autohideMarker) {\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function(container) {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map.getContainer().clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet chart = this._chart = new Chart(opts);\r\n\r\n\t\td3\r\n\t\t\t.select(container)\r\n\t\t\t.call(chart.render())\r\n\r\n\t\tchart\r\n\t\t\t.on('reset_drag', this._hideMarker, this)\r\n\t\t\t.on('mouse_enter', this._fireEvt.bind('elechart_enter'), this)\r\n\t\t\t.on('dragged', this._dragendHandler, this)\r\n\t\t\t.on('mouse_move', this._mousemoveHandler, this)\r\n\t\t\t.on('mouse_out', this._mouseoutHandler, this);\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\t\tif (this.options.legend) this._fireEvt(\"elechart_legend\");\r\n\r\n\t\tthis._fireEvt(\"elechart_init\");\r\n\t},\r\n\r\n\t_initLayer: function() {\r\n\t\tthis._layers\r\n\t\t\t.on('layeradd layerremove', (e) => {\r\n\t\t\t\tlet layer = e.layer\r\n\t\t\t\tlet toggleClass = e.type == 'layeradd' ? _.addClass : _.removeClass;\r\n\t\t\t\tlet toggleEvt = layer[e.type == 'layeradd' ? \"on\" : \"off\"].bind(layer);\r\n\t\t\t\ttoggleClass(layer.getElement && layer.getElement(), this.options.polyline.className + ' ' + this.options.theme);\r\n\t\t\t\ttoggleEvt(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\ttoggleEvt(\"mouseout\", this._mouseoutHandler, this);\r\n\t\t\t});\r\n\t},\r\n\r\n\t_initMarker: function(map) {\r\n\t\tlet pane = map.getPane('elevationPane');\r\n\t\tif (!pane) {\r\n\t\t\tpane = this._pane = map.createPane('elevationPane');\r\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tpane.style.pointerEvents = 'none';\r\n\t\t}\r\n\t\tif (this._renderer) this._renderer.remove()\r\n\t\tthis._renderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\r\n\t\tthis._marker = (new Marker(this.options));\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initButton: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\t_.on(container, 'mouseover', this._expand, this);\r\n\t\t\t\t\t_.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\r\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t_initSummary: function(container) {\r\n\t\tlet summary = this._summary = new Summary({ summary: this.options.summary });\r\n\r\n\t\td3\r\n\t\t\t.select(container)\r\n\t\t\t.call(summary.render());\r\n\r\n\t\tthis.summaryDiv = this._summary._container;\r\n\t},\r\n\r\n\t_dragendHandler: function(e) {\r\n\t\tthis._hideMarker();\r\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\r\n\r\n\t\tthis._fireEvt(\"elechart_dragged\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(e) {\r\n\t\tif (!this._data.length || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet xCoord = e.xCoord;\r\n\t\tlet item = this._findItemForX(xCoord);\r\n\r\n\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\tthis._updateMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.addClass(this._map.getContainer(), 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item = this._findItemForLatLng(e.latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\t\tthis._updateMarker(item);\r\n\r\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hideMarker();\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t}\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.removeClass(this._map.getContainer(), 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\r\n\t\tlet z = this._map.getZoom() + Math.sign(e.deltaY);\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tthis._chart._resetDrag();\r\n\t\tthis._hideMarker();\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hideMarker();\r\n\t\tthis.fitBounds();\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\t// prevent displaying chart on resize if hidden\r\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\r\n\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\t\t\t\tif (newWidth) {\r\n\t\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\t\t_.append(this.eleDiv, this.onAdd(this._map));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_updateChart: function() {\r\n\t\tif (!this._data.length || !this._container) return;\r\n\r\n\t\tthis._chart = this._chart.update({ data: this._data });\r\n\r\n\t\tthis._x = this._chart._x;\r\n\t\tthis._y = this._chart._y;\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\r\n\t\tthis._fireEvt('elechart_updated');\r\n\t},\r\n\r\n\t/*\r\n\t * Update the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_updateMarker: function(item) {\r\n\t\tthis._marker.update({\r\n\t\t\tmap: this._map,\r\n\t\t\titem: item,\r\n\t\t\tmaxElevation: this._maxElevation,\r\n\t\t\toptions: this.options\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance || 0;\r\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\r\n\t\tthis._summary.reset();\r\n\r\n\t\tif (this.options.summary) {\r\n\t\t\tthis._fireEvt(\"elechart_summary\");\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\r\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\r\n\t\t\t};\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Attach here some useful elevation hooks.\r\n */\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on('waypoint_added', function(e) {\r\n\t\tlet p = e.point,\r\n\t\t\tpop = p._popup;\r\n\t\tif (pop) {\r\n\t\t\tpop.options.className = 'elevation-popup';\r\n\t\t}\r\n\t\tif (pop._content) {\r\n\t\t\tpop._content = decodeURI(pop._content);\r\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t}\r\n\t});\r\n\r\n\t// autotoggle chart data on click\r\n\tthis.on('elepath_toggle', function(e) {\r\n\t\tlet path = e.path;\r\n\t\tlet enable = _.hasClass(path, 'hidden');\r\n\t\tlet label = _.select('text', e.legend);\r\n\t\tlet rect = _.select('rect', e.legend);\r\n\r\n\t\t_.style(label, \"text-decoration-line\", enable ? \"\" : \"line-through\")\r\n\t\t_.style(rect, \"fill-opacity\", enable ? \"\" : \"0\")\r\n\t\t_.toggleClass(path, 'hidden', !enable);\r\n\r\n\t\tthis._chartEnabled = this._chart._area.selectAll('path:not(.hidden)').nodes().length != 0;\r\n\t\tthis._layers.eachLayer(l => _.toggleClass(l.getElement && l.getElement(), this.options.polyline.className + ' ' + this.options.theme, this._chartEnabled));\r\n\r\n\t\tif (!this._chartEnabled) {\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_updated\", function() {\r\n\t\t// TODO: maybe should i listen for this inside chart.js?\r\n\t\tthis._chart._legend.selectAll('.legend-item')\r\n\t\t\t.on('click', (d, i, n) => {\r\n\t\t\t\tlet target = n[i];\r\n\t\t\t\tlet name = target.getAttribute('data-name');\r\n\t\t\t\tlet path = this._chart._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t});\r\n\t});\r\n\r\n\tthis.on(\"eletrack_download\", function(e) {\r\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\r\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\r\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\r\n\t\t\te.confirm();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_loaded', function(e) {\r\n\t\tlet layer = e.layer;\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(layer.getBounds());\r\n\t\t\t}, this);\r\n\t\t\tlayer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && i > 0) {\r\n\t\t\tlet prevZ = data[i - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[i - 1].z = prevZ;\r\n\t\t\t\telse data.splice(i - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\r\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tthis._altitudeLegend = this._chart._legend.append('g')\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.summaryDiv.innerHTML +=\r\n\t\t\t'<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>' +\r\n\t\t\t'<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>' +\r\n\t\t\t'<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (!this.options.slope) return;\r\n\r\n\tlet opts = this.options;\r\n\tlet slope = {};\r\n\topts.margins.right = 50;\r\n\r\n\tif (this.options.slope != \"summary\") {\r\n\r\n\t\tthis.on(\"elechart_init\", function() {\r\n\t\t\tslope.path = this._chart._area.append('path')\r\n\t\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_axis\", function() {\r\n\t\t\tslope.x = this._chart._x;\r\n\r\n\t\t\t// slope.x = D3.Scale({\r\n\t\t\t// \tdata: this._data,\r\n\t\t\t// \trange: [0, this._width()],\r\n\t\t\t// \tattr: opts.xAttr,\r\n\t\t\t// \tmin: opts.xAxisMin,\r\n\t\t\t// \tmax: opts.xAxisMax,\r\n\t\t\t// \tforceBounds: opts.forceAxisBounds,\r\n\t\t\t// });\r\n\r\n\t\t\tslope.y = D3.Scale({\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\trange: [this._height(), 0],\r\n\t\t\t\tattr: \"slope\",\r\n\t\t\t\tmin: -1,\r\n\t\t\t\tmax: +1,\r\n\t\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t\t});\r\n\r\n\t\t\tslope.axis = D3.Axis({\r\n\t\t\t\taxis: \"y\",\r\n\t\t\t\tposition: \"right\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscale: slope.y,\r\n\t\t\t\tticks: this.options.yTicks,\r\n\t\t\t\ttickPadding: 16,\r\n\t\t\t\tlabel: \"%\",\r\n\t\t\t\tlabelX: 25,\r\n\t\t\t\tlabelY: 3,\r\n\t\t\t});\r\n\r\n\t\t\tthis._chart._axis.call(slope.axis);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_updated\", function() {\r\n\t\t\tslope.area = D3.Area({\r\n\t\t\t\tinterpolation: opts.sInterpolation,\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\tname: 'Slope',\r\n\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\tyAttr: \"slope\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscaleX: slope.x,\r\n\t\t\t\tscaleY: slope.y,\r\n\t\t\t});\r\n\r\n\t\t\tslope.path.call(slope.area);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_legend\", function() {\r\n\t\t\tslope.legend = this._chart._legend.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\t\tname: 'Slope',\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._altitudeLegend\r\n\t\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\r\n\r\n\t\t\tslope.legend\r\n\t\t\t\t.attr(\"transform\", \"translate(50, 0)\");\r\n\r\n\t\t\tslope.legend.select(\"rect\")\r\n\t\t\t\t.classed(\"area\", false)\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\t// Slope / Gain\r\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\r\n\t\tlet tDes = this._tDes || 0; // Total Descent\r\n\t\tlet sMax = this._sMax || 0; // Slope Max\r\n\t\tlet sMin = this._sMin || 0; // Slope Min\r\n\t\tlet slope = 0;\r\n\r\n\t\tif (!isNaN(z)) {\r\n\t\t\tlet deltaZ = i > 0 ? z - data[i - 1].z : 0;\r\n\t\t\tif (deltaZ > 0) tAsc += deltaZ;\r\n\t\t\telse if (deltaZ < 0) tDes -= deltaZ;\r\n\t\t\t// slope in % = ( height / length ) * 100\r\n\t\t\tslope = delta !== 0 ? (deltaZ / delta) * 100 : 0;\r\n\t\t}\r\n\r\n\t\t// Try to smooth \"crazy\" slope values.\r\n\t\tif (this.options.sDeltaMax) {\r\n\t\t\tlet deltaS = i > 0 ? slope - data[i - 1].slope : 0;\r\n\t\t\tlet maxDeltaS = this.options.sDeltaMax;\r\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\r\n\t\t\t\tslope = data[i - 1].slope + maxDeltaS * Math.sign(deltaS);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Range of acceptable slope values.\r\n\t\tif (this.options.sRange) {\r\n\t\t\tlet range = this.options.sRange;\r\n\t\t\tif (slope < range[0]) slope = range[0];\r\n\t\t\telse if (slope > range[1]) slope = range[1];\r\n\t\t}\r\n\r\n\t\tslope = L.Util.formatNum(slope, 2);\r\n\r\n\t\tsMax = slope > sMax ? slope : sMax;\r\n\t\tsMin = slope < sMin ? slope : sMin;\r\n\r\n\t\tdata[i].slope = slope;\r\n\r\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\r\n\t\tthis.track_info.descent = this._tDes = tDes;\r\n\t\tthis.track_info.slope_max = this._sMax = sMax;\r\n\t\tthis.track_info.slope_min = this._sMin = sMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_change\", function(e) {\r\n\t\tlet item = e.data;\r\n\t\tlet xCoordinate = e.xCoord;\r\n\t\tlet chart = this._chart;\r\n\r\n\t\tif (chart._focuslabel) {\r\n\t\t\tif (!chart._focuslabelSlope || !chart._focuslabelSlope.property('isConnected')) {\r\n\t\t\t\tchart._focuslabelSlope = chart._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\r\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\r\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t\t}\r\n\r\n\t\t\tchart._focuslabelSlope.text(item.slope + \"%\");\r\n\r\n\t\t\tchart._focuslabel.select('.mouse-focus-label-x')\r\n\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t}\r\n\r\n\t\tif (chart._mouseHeightFocusLabel) {\r\n\t\t\tif (!chart._mouseSlopeFocusLabel) {\r\n\t\t\t\tchart._mouseSlopeFocusLabel = chart._mouseHeightFocusLabel.append(\"svg:tspan\")\r\n\t\t\t\t\t.attr(\"class\", \"height-focus-slope \");\r\n\t\t\t}\r\n\r\n\t\t\tchart._mouseSlopeFocusLabel\r\n\t\t\t\t.attr(\"dy\", \"1.5em\")\r\n\t\t\t\t.text(Math.round(item.slope) + \"%\");\r\n\r\n\t\t\tchart._mouseHeightFocusLabel.select('.height-focus-y')\r\n\t\t\t\t.attr(\"dy\", \"-1.5em\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.ascent = this._tAsc || 0;\r\n\t\tthis.track_info.descent = this._tDes || 0;\r\n\t\tthis.track_info.slope_max = this._sMax || 0;\r\n\t\tthis.track_info.slope_min = this._sMin || 0;\r\n\r\n\t\tthis.summaryDiv.querySelector('.minele').insertAdjacentHTML('afterend', '<span class=\"ascent\"><span class=\"summarylabel\">' + L._(\"Total Ascent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.ascent) + '&nbsp;' +\r\n\t\t\tthis._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"descent\"><span class=\"summarylabel\">' + L._(\"Total Descent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"minslope\"><span class=\"summarylabel\">' + L._(\"Min Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_min + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>' + '<span class=\"maxslope\"><span class=\"summarylabel\">' + L._(\"Max Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_max + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>');\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._sMax = null;\r\n\t\tthis._sMin = null;\r\n\t\tthis._tAsc = null;\r\n\t\tthis._tDes = null;\r\n\t});\r\n\r\n});\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Elevation } from './control';\r\nimport './altitude';\r\nimport './slope';\r\n\r\nElevation.Utils = _;\r\nElevation.Components = D3;\r\nElevation.Chart = Chart;\r\n\r\nL.control.elevation = (options) => new Elevation(options);\r\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","window","addEventListener","once","formatNum","num","dec","sep","toFixed","toString","split","join","GeoJSONLoader","data","control","JSON","parse","this","layer","L","geoJson","style","feature","extend","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","Control","Elevation","_d3LazyLoader","then","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","item","_typeof","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","Util","requestAnimFrame","removeEventListener","addClass","targetNode","each","s","DomUtil","removeClass","toggleClass","conditional","call","value","getStyle","setProperty","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","factory","define","amd","exports","module","require","locales","locale","registerLocale","code","setLocale","i18n","_","string","template","err","DomEvent","off","hasClass","randomId","Math","random","substr","obj","fn","i","offsetWidth","offsetHeight","getClientRects","Area","xAttr","yAttr","scaleX","scaleY","height","interpolation","path","d3","area","curve","x","d","xDiagCoord","y0","y1","datum","attr","Axis","tickSize","tickPadding","width","axis","scale","ticks","tickFormat","label","labelX","labelY","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","text","DragRectangle","dragStartCoords","dragEndCoords","rect","x1","min","x2","max","FocusRect","Grid","props","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusMarker","circle","LegendItem","margins","toLowerCase","MouseFocusLine","MouseFocusLabel","xAlign","yAlign","bbox","getBBox","Browser","webkit","Infinity","Scale","forceBounds","range","domain","extent","scaleLinear","bisector","invert","Chart","Class","includes","Evented","prototype","Mixin","Events","initialize","opts","_data","_draggingEnabled","dragging","imperial","_xLabel","_yLabel","xLabel","yLabel","_xTicks","xTicks","_yTicks","yTicks","_updateScale","svg","_container","_appendGrid","_appendAxis","_appendAreaPath","_appendFocusable","_appendLegend","_grid","_area","_path","_axis","_focus","_focusRect","_legend","_x","_y","update","_updateAxis","_updateAreaPath","render","container","_this","clear","_resetDrag","D3","_width","xAxisMin","xAxisMax","forceAxisBounds","_height","yAxisMin","yAxisMax","remove","_appendXGrid","_appendYGrid","_appendXaxis","_appendYaxis","_this2","_this3","_this4","_appendFocusRect","_appendMouseFocusG","focusRect","_this5","mobile","_dragStartHandler","bind","_dragHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_mouseoutHandler","focusG","_this6","_focusG","_focusline","_focuslabel","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","mouse","_dragRectangle","_dragCurrentCoords","start","_findIndexForXCoord","end","dragstart","dragend","ctx","_this7","_findIndexForLatLng","_hideDiagramIndicator","_showDiagramIndicator","xCoordinate","yCoordinate","classed","decimalsX","decimalsY","Marker","_focusmarker","_marker","markerIcon","zIndexOffset","interactive","addTo","map","_map","getPane","pane","_latlng","latLngToLayerPoint","normalizedAlt","maxElevation","z","normalizedY","getElement","setLatLng","getLatLng","Summary","summary","reset","innerHTML","Options","autohide","autohideMarker","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","legend","loadData","defer","placeholder","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","responsive","slope","sDeltaMax","undefined","sInterpolation","sRange","zFollow","_layers","featureGroup","_chartEnabled","__mileFactor","__footFactor","__D3","__LGPX","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","getContainer","onAdd","_chart","clearLayers","_distance","disableDragging","enableDragging","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","_distanceFactor","_heightFactor","_setMapView","throttle","load","loadChart","loadDefer","loadLazy","loadGPX","loadGeoJSON","_downloadURL","catch","_gpxLazyLoader","parentNode","alt","_initButton","_initChart","_initSummary","_initMarker","_initLayer","_hideMarker","_resetView","_resizeChart","_updateChart","_updateSummary","onRemove","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","coords","features","_addGPXData","_addPoint","_this8","lat","lng","meta","ele","dist","curr","LatLng","prev","delta","distanceTo","round","push","distance","index","addLayer","id","_collapse","_expand","_findItemForLatLng","_findItemForX","propagate","offWi","offHe","_maxWidth","containerWidth","clientWidth","chart","_dragendHandler","toggleEvt","_this9","_mousemoveLayerHandler","_pane","createPane","zIndex","_renderer","disableClickPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_summary","summaryDiv","_updateMarker","gestureHandling","_enabled","ll","getCenter","getZoom","sign","deltaY","flyTo","_isFullscreen","newWidth","removeControl","setView","animate","duration","_maxElevation","elevation_max","elevation_min","_minElevation","onclick","_this10","confirm","addInitHook","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enable","nodes","eachLayer","_this11","n","getAttribute","_this12","CustomEvent","dispatchEvent","detail","eleMax","eleMin","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","_altitudeLegend","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","deltaZ","deltaS","maxDeltaS","abs","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseHeightFocusLabel","_mouseSlopeFocusLabel","insertAdjacentHTML","Utils","Components","elevation"],"mappings":"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"}