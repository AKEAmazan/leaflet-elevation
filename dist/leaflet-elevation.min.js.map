{"version":3,"file":"leaflet-elevation.min.js","sources":["../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/leaflet-elevation.js"],"sourcesContent":["// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","const AxisRange = (props) => {\r\n\tif (!props.data) {\r\n\t\tlet x = d3.scaleLinear().range([0, props.width]);\r\n\t\tlet y = d3.scaleLinear().range([props.height, 0]);\r\n\t\treturn [x, y];\r\n\t}\r\n\r\n\tlet xdomain = d3.extent(props.data, d => d.dist);\r\n\tlet ydomain = d3.extent(props.data, d => d.z);\r\n\tlet opts = props.options;\r\n\r\n\tif (opts.yAxisMin !== undefined && (opts.yAxisMin < ydomain[0] || opts.forceAxisBounds)) {\r\n\t\tydomain[0] = opts.yAxisMin;\r\n\t}\r\n\tif (opts.yAxisMax !== undefined && (opts.yAxisMax > ydomain[1] || opts.forceAxisBounds)) {\r\n\t\tydomain[1] = opts.yAxisMax;\r\n\t}\r\n\r\n\tlet x = props.x.domain(xdomain);\r\n\tlet y = props.y.domain(ydomain);\r\n\r\n\treturn [x, y];\r\n};\r\n\r\nconst AreaPath = (props) => {\r\n\tif (!props.data) {\r\n\t\tlet interpolation = typeof props.interpolation === 'function' ? props.interpolation : d3[props.interpolation];\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = props.x(d.dist)))\r\n\t\t\t.y0(props.height)\r\n\t\t\t.y1(d => props.y(d.z));\r\n\t\tlet path = d3.create(\"svg:path\")\r\n\t\t\t.attr(\"class\", \"area\");\r\n\t\treturn [area, path];\r\n\t}\r\n\r\n\tprops.path.datum(props.data).attr(\"d\", props.area);\r\n\r\n\treturn [props.path, props.area];\r\n};\r\n\r\nconst Chart = (props) => {\r\n\tlet container = d3.select(props.container);\r\n\tlet svg = container.append(\"svg\")\r\n\t\t.attr(\"class\", \"background\")\r\n\t\t.attr(\"width\", props.width)\r\n\t\t.attr(\"height\", props.height);\r\n\tlet g = svg\r\n\t\t.append(\"g\")\r\n\t\t.attr(\"transform\", \"translate(\" + props.options.margins.left + \",\" + props.options.margins.top + \")\");\r\n\treturn svg;\r\n};\r\n\r\nconst Summary = (props) => {\r\n\tlet container = d3.select(props.container);\r\n\tlet summary = container.append(\"div\")\r\n\t\t.attr(\"class\", \"elevation-summary \" + props.summary + \"-summary\")\r\n\t\t.node();\r\n\treturn summary;\r\n};\r\n\r\nexport {\r\n\tAreaPath,\r\n\tAxisRange,\r\n\tChart,\r\n\tSummary\r\n};\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as D3 from './components.js';\r\n\r\nL.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tautohide: true,\r\n\t\tautohideMarker: true,\r\n\t\tcollapsed: false,\r\n\t\tcontrolButton: {\r\n\t\t\ticonCssClass: \"elevation-toggle-icon\",\r\n\t\t\ttitle: \"Elevation\"\r\n\t\t},\r\n\t\tdetached: true,\r\n\t\tdistanceFactor: 1,\r\n\t\tdownloadLink: 'link',\r\n\t\televationDiv: \"#elevation-div\",\r\n\t\tfollowMarker: true,\r\n\t\tforceAxisBounds: false,\r\n\t\tgpxOptions: {\r\n\t\t\tasync: true,\r\n\t\t\tmarker_options: {\r\n\t\t\t\tstartIconUrl: null,\r\n\t\t\t\tendIconUrl: null,\r\n\t\t\t\tshadowUrl: null,\r\n\t\t\t\twptIcons: {\r\n\t\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t\theight: 200,\r\n\t\theightFactor: 1,\r\n\t\thoverNumber: {\r\n\t\t\tdecimalsX: 2,\r\n\t\t\tdecimalsY: 0,\r\n\t\t\tformatter: undefined\r\n\t\t},\r\n\t\timperial: false,\r\n\t\tinterpolation: \"curveLinear\",\r\n\t\tlazyLoadJS: true,\r\n\t\tlegend: true,\r\n\t\tloadData: {\r\n\t\t\tdefer: false,\r\n\t\t\tlazy: false,\r\n\t\t},\r\n\t\tmarker: 'elevation-line',\r\n\t\tmarkerIcon: L.divIcon({\r\n\t\t\tclassName: 'elevation-position-marker',\r\n\t\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\t\ticonSize: [32, 32],\r\n\t\t\ticonAnchor: [16, 16],\r\n\t\t}),\r\n\t\tplaceholder: false,\r\n\t\tposition: \"topright\",\r\n\t\tpolyline: {\r\n\t\t\tclassName: 'elevation-polyline',\r\n\t\t\tcolor: '#000',\r\n\t\t\topacity: 0.75,\r\n\t\t\tweight: 5,\r\n\t\t\tlineCap: 'round'\r\n\t\t},\r\n\t\treverseCoords: false,\r\n\t\tskipNullZCoords: false,\r\n\t\ttheme: \"lightblue-theme\",\r\n\t\tmargins: {\r\n\t\t\ttop: 10,\r\n\t\t\tright: 20,\r\n\t\t\tbottom: 30,\r\n\t\t\tleft: 50\r\n\t\t},\r\n\t\tresponsive: true,\r\n\t\tsummary: 'inline',\r\n\t\twidth: 600,\r\n\t\txLabel: \"km\",\r\n\t\txTicks: undefined,\r\n\t\tyAxisMax: undefined,\r\n\t\tyAxisMin: undefined,\r\n\t\tyLabel: \"m\",\r\n\t\tyTicks: undefined,\r\n\t\tzFollow: 13,\r\n\t},\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tL.Control.Elevation._d3LazyLoader = this._lazyLoadJS(\r\n\t\t\t'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t\t\ttypeof d3 !== 'object',\r\n\t\t\tL.Control.Elevation._d3LazyLoader\r\n\t\t).then(\r\n\t\t\tfunction(d, layer) {\r\n\t\t\t\tthis._addData(d);\r\n\r\n\t\t\t\tif (this._container) {\r\n\t\t\t\t\tthis._applyData();\r\n\t\t\t\t}\r\n\t\t\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\t\t\tlayer = d;\r\n\t\t\t\t}\r\n\t\t\t\tif (layer) {\r\n\t\t\t\t\tif (layer._path) {\r\n\t\t\t\t\t\tL.DomUtil.addClass(layer._path, this.options.polyline.className + ' ' + this.options.theme);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayer\r\n\t\t\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.track_info = L.extend({}, this.track_info, {\r\n\t\t\t\t\tdistance: this._distance,\r\n\t\t\t\t\televation_max: this._maxElevation,\r\n\t\t\t\t\televation_min: this._minElevation\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis._layers = this._layers || {};\r\n\t\t\t\tthis._layers[L.Util.stamp(layer)] = layer;\r\n\r\n\t\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info }, true);\r\n\t\t\t}.bind(this, d, layer));\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tthis._appendElevationDiv(map._container).appendChild(this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tthis._clearPath();\r\n\t\tthis._clearChart();\r\n\t\tthis._clearData();\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this._fullExtent;\r\n\t\tif (this._map && bounds) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\tthis._container.style.display = \"none\";\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options.autohide = typeof options.autohide !== \"undefined\" ? options.autohide : !L.Browser.mobile;\r\n\t\tthis.options = this._deepMerge({}, this.options, options);\r\n\r\n\t\tthis._draggingEnabled = !L.Browser.mobile;\r\n\t\tthis._chartEnabled = true;\r\n\r\n\t\tif (options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tthis.on('waypoint_added', function(e) {\r\n\t\t\tif (e.point._popup) {\r\n\t\t\t\te.point._popup.options.className = 'elevation-popup';\r\n\t\t\t\te.point._popup._content = decodeURI(e.point._popup._content);\r\n\t\t\t}\r\n\t\t\tif (e.point._popup && e.point._popup._content) {\r\n\t\t\t\te.point.bindTooltip(e.point._popup._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (this._isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (this._isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\tif (document.readyState !== 'complete') window.addEventListener(\"load\", L.bind(this.loadData, this, data, opts), { once: true });\r\n\t\telse this.loadData(data, opts)\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\ttry {\r\n\t\t\tlet xhr = new XMLHttpRequest();\r\n\t\t\txhr.responseType = \"text\";\r\n\t\t\txhr.open('GET', url);\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tif (xhr.status !== 200) {\r\n\t\t\t\t\tthrow \"Error \" + xhr.status + \" while fetching remote file: \" + url;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.loadData(xhr.response, { lazy: false, defer: false });\r\n\t\t\t\t}\r\n\t\t\t}.bind(this);\r\n\t\t\txhr.send();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\tdata = JSON.parse(data);\r\n\t\t}\r\n\r\n\t\tthis.layer = this.geojson = L.geoJson(data, {\r\n\t\t\tstyle: function(feature) {\r\n\t\t\t\tlet style = L.extend({}, this.options.polyline);\r\n\t\t\t\tif (this.options.theme) {\r\n\t\t\t\t\tstyle.className += ' ' + this.options.theme;\r\n\t\t\t\t}\r\n\t\t\t\treturn style;\r\n\t\t\t}.bind(this),\r\n\t\t\tpointToLayer: function(feature, latlng) {\r\n\t\t\t\tlet marker = L.marker(latlng, { icon: this.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\t\tif (name || desc) {\r\n\t\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t\t}\r\n\t\t\t\tthis.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\t\treturn marker;\r\n\t\t\t}.bind(this),\r\n\t\t\tonEachFeature: function(feature, layer) {\r\n\t\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\t\tthis.addData(feature, layer);\r\n\r\n\t\t\t\tthis.track_info = L.extend({}, this.track_info, { type: \"geojson\", name: data.name });\r\n\t\t\t}.bind(this),\r\n\t\t});\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(this.layer.getBounds());\r\n\t\t\t\tthis._fireEvt(\"eledata_loaded\", { data: data, layer: this.layer, name: this.track_info.name, track_info: this.track_info }, true);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.layer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tL.Control.Elevation._gpxLazyLoader = this._lazyLoadJS(\r\n\t\t\t'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\t\t\ttypeof L.GPX !== 'function',\r\n\t\t\tL.Control.Elevation._gpxLazyLoader\r\n\t\t).then(\r\n\t\t\tfunction(data) {\r\n\t\t\t\tthis.options.gpxOptions.polyline_options = L.extend({}, this.options.polyline, this.options.gpxOptions.polyline_options);\r\n\r\n\t\t\t\tif (this.options.theme) {\r\n\t\t\t\t\tthis.options.gpxOptions.polyline_options.className += ' ' + this.options.theme;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.layer = this.gpx = new L.GPX(data, this.options.gpxOptions);\r\n\r\n\t\t\t\tthis.layer.on('loaded', function(e) { this.fitBounds(e.target.getBounds()); }, this);\r\n\t\t\t\tthis.layer.on('addpoint', function(e) { this.fire(\"waypoint_added\", e, true); }, this);\r\n\t\t\t\tthis.layer.once(\"addline\", function(e) {\r\n\t\t\t\t\tthis.addData(e.line /*, this.layer*/ );\r\n\r\n\t\t\t\t\tthis.track_info = L.extend({}, this.track_info, { type: \"gpx\", name: this.layer.get_name() });\r\n\r\n\t\t\t\t\tthis._fireEvt(\"eledata_loaded\", { data: data, layer: this.layer, name: this.track_info.name, track_info: this.track_info }, true);\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\tif (this._map) {\r\n\t\t\t\t\tthis.layer.addTo(this._map);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t\t\t}\r\n\t\t\t}.bind(this, data)\r\n\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.lazy = false;\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = L.bind(function(data) {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(function() {\r\n\t\t\t\t\tif (this._isVisible(this.placeholder)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tthis.loadData(data, opts);\r\n\t\t\t\t\t\tthis.once('eledata_loaded', function() {\r\n\t\t\t\t\t\t\tif (this.placeholder && this.placeholder.parentNode) {\r\n\t\t\t\t\t\t\t\tthis.placeholder.parentNode.removeChild(this.placeholder);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t}, this);\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t}, this, data);\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (this.placeholder) this.placeholder.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = L.DomUtil.create(\"div\", \"elevation-control elevation\");\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.theme) {\r\n\t\t\tL.DomUtil.addClass(container, this.options.theme); // append theme to control\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data) {\r\n\t\t\tthis.placeholder = L.DomUtil.create('img', 'elevation-placeholder');\r\n\t\t\tif (typeof this.options.placeholder === 'string') {\r\n\t\t\t\tthis.placeholder.src = this.options.placeholder;\r\n\t\t\t\tthis.placeholder.alt = '';\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i in this.options.placeholder) { this.placeholder.setAttribute(i, this.options.placeholder[i]); }\r\n\t\t\t}\r\n\t\t\tcontainer.insertBefore(this.placeholder, container.firstChild);\r\n\t\t}\r\n\r\n\t\tL.Control.Elevation._d3LazyLoader = this._lazyLoadJS(\r\n\t\t\t'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t\t\ttypeof d3 !== 'object',\r\n\t\t\tL.Control.Elevation._d3LazyLoader\r\n\t\t).then(\r\n\t\t\tfunction(map, container) {\r\n\t\t\t\tthis._initToggle(container);\r\n\t\t\t\tthis._initChart(container);\r\n\r\n\t\t\t\tthis._applyData();\r\n\r\n\t\t\t\tthis._map.on('zoom viewreset zoomanim', this._hidePositionMarker, this);\r\n\t\t\t\tthis._map.on('resize', this._resetView, this);\r\n\t\t\t\tthis._map.on('resize', this._resizeChart, this);\r\n\t\t\t\tthis._map.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\t\tthis._map.on('eledata_added', this._updateSummary, this);\r\n\r\n\t\t\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t\t\tL.DomEvent.on(this._map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\t}.bind(this, map, container)\r\n\t\t);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\tthis._container.style.display = \"block\";\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\tgeom.coordinates.forEach(coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\td.features.forEach(feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXdata(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\tif (coords) {\r\n\t\t\tcoords.forEach(point => this._addPoint(point[1], point[0], point[2]));\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXdata: function(coords) {\r\n\t\tif (coords) {\r\n\t\t\tcoords.forEach(point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tlet data = this._data || [];\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = new L.LatLng(x, y);\r\n\t\tlet prev = data.length ? data[data.length - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && data.length > 0) {\r\n\t\t\tlet prevZ = data[data.length - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[data.length - 1].z = prevZ;\r\n\t\t\t\telse data.splice(data.length - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis._distance = dist;\r\n\t\tthis._maxElevation = eleMax;\r\n\t\tthis._minElevation = eleMin;\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart container.\r\n\t */\r\n\t_appendChart: function(svg) {\r\n\t\tlet g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + this.options.margins.left + \",\" + this.options.margins.top + \")\");\r\n\r\n\t\tthis._appendGrid(g);\r\n\t\tthis._appendAreaPath(g);\r\n\t\tthis._appendAxis(g);\r\n\t\tthis._appendFocusRect(g);\r\n\t\tthis._appendMouseFocusG(g);\r\n\t\tthis._appendLegend(g);\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_appendElevationDiv: function(container) {\r\n\t\tlet eleDiv = document.querySelector(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\teleDiv = L.DomUtil.create('div', 'leaflet-control elevation elevation-div');\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + Math.random().toString(36).substr(2, 9);\r\n\t\t\teleDiv.id = this.options.elevationDiv.substr(1);\r\n\t\t\tcontainer.parentNode.insertBefore(eleDiv, container.nextSibling); // insert after end of container.\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\tL.DomUtil.addClass(eleDiv, 'elevation-detached');\r\n\t\t\tL.DomUtil.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-axis\".\r\n\t */\r\n\t_appendXaxis: function(axis) {\r\n\t\taxis\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"x axis\")\r\n\t\t\t.attr(\"transform\", \"translate(0,\" + this._height() + \")\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisBottom()\r\n\t\t\t\t.scale(this._x)\r\n\t\t\t\t.ticks(this.options.xTicks)\r\n\t\t\t)\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", this._width() + 6)\r\n\t\t\t.attr(\"y\", 30)\r\n\t\t\t.text(this._xLabel);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function(grid) {\r\n\t\tgrid.append(\"g\")\r\n\t\t\t.attr(\"class\", \"x grid\")\r\n\t\t\t.attr(\"transform\", \"translate(0,\" + this._height() + \")\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisBottom()\r\n\t\t\t\t.scale(this._x)\r\n\t\t\t\t.ticks(this.options.xTicks)\r\n\t\t\t\t.tickSize(-this._height())\r\n\t\t\t\t.tickFormat(\"\")\r\n\t\t\t);\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function(axis) {\r\n\t\taxis\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"y axis\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisLeft()\r\n\t\t\t\t.scale(this._y)\r\n\t\t\t\t.ticks(this.options.yTicks)\r\n\t\t\t)\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", -30)\r\n\t\t\t.attr(\"y\", 3)\r\n\t\t\t.text(this._yLabel);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function(grid) {\r\n\t\tgrid.append(\"g\")\r\n\t\t\t.attr(\"class\", \"y grid\")\r\n\t\t\t.call(\r\n\t\t\t\td3\r\n\t\t\t\t.axisLeft()\r\n\t\t\t\t.scale(this._y)\r\n\t\t\t\t.ticks(this.options.yTicks)\r\n\t\t\t\t.tickSize(-this._width())\r\n\t\t\t\t.tickFormat(\"\")\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendAreaPath: function(g) {\r\n\t\tg.append(() => this._areapath.node());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function(g) {\r\n\t\tthis._axis = g.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\");\r\n\t\tthis._appendXaxis(this._axis);\r\n\t\tthis._appendYaxis(this._axis);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function(g) {\r\n\t\tlet focusRect = this._focusRect = g.append(\"rect\")\r\n\t\t\t.attr(\"width\", this._width())\r\n\t\t\t.attr(\"height\", this._height())\r\n\t\t\t.style(\"fill\", \"none\")\r\n\t\t\t.style(\"stroke\", \"none\")\r\n\t\t\t.style(\"pointer-events\", \"all\");\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._container, 'touchend', this._dragEndHandler, this);\r\n\t\t}\r\n\r\n\t\tfocusRect\r\n\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\tL.DomEvent.on(this._container, 'mouseup', this._dragEndHandler, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function(g) {\r\n\t\tthis._grid = g.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\");\r\n\t\tthis._appendXGrid(this._grid);\r\n\t\tthis._appendYGrid(this._grid);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function(g) {\r\n\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-group\");\r\n\r\n\t\tthis._mousefocus = focusG.append('svg:line')\r\n\t\t\t.attr('class', 'mouse-focus-line')\r\n\t\t\t.attr('x2', '0')\r\n\t\t\t.attr('y2', '0')\r\n\t\t\t.attr('x1', '0')\r\n\t\t\t.attr('y1', '0');\r\n\r\n\t\tthis._focuslabelrect = focusG.append(\"rect\")\r\n\t\t\t.attr('class', 'mouse-focus-label')\r\n\t\t\t.attr(\"x\", 0)\r\n\t\t\t.attr(\"y\", 0)\r\n\t\t\t.attr(\"width\", 0)\r\n\t\t\t.attr(\"height\", 0)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\r\n\t\tthis._focuslabeltext = focusG.append(\"svg:text\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\");\r\n\t\tthis._focuslabelY = this._focuslabeltext.append(\"svg:tspan\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"-1em\");\r\n\t\tthis._focuslabelX = this._focuslabeltext.append(\"svg:tspan\")\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function(g) {\r\n\t\tif (!this.options.legend) return;\r\n\r\n\t\tlet legend = this._legend = g.append('g')\r\n\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\tlet altitude = this._altitudeLegend = this._legend.append('g')\r\n\t\t\t.attr(\"class\", \"legend-altitude\");\r\n\r\n\t\taltitude.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (this._width() / 2) - 50)\r\n\t\t\t.attr(\"y\", this._height() + this.options.margins.bottom - 17)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 5)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\taltitude.append('text')\r\n\t\t\t.text('Altitude')\r\n\t\t\t.attr(\"x\", (this._width() / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', this._height() + this.options.margins.bottom - 11);\r\n\r\n\t\t// autotoggle chart data on single click\r\n\t\tlegend.on('click', function() {\r\n\t\t\tif (this._chartEnabled) {\r\n\t\t\t\tthis._clearChart();\r\n\t\t\t\tthis._clearPath();\r\n\t\t\t\tthis._chartEnabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis._resizeChart();\r\n\t\t\t\tthis._chartEnabled = true;\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg:line\".\r\n\t */\r\n\t_appendPositionMarker: function(pane) {\r\n\t\tlet theme = this.options.theme;\r\n\t\tlet heightG = pane.select(\"g\");\r\n\r\n\t\tthis._mouseHeightFocus = heightG.append('svg:line')\r\n\t\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t\t.attr(\"x2\", 0)\r\n\t\t\t.attr(\"y2\", 0)\r\n\t\t\t.attr(\"x1\", 0)\r\n\t\t\t.attr(\"y1\", 0);\r\n\r\n\t\tthis._pointG = heightG.append(\"g\");\r\n\t\tthis._pointG.append(\"svg:circle\")\r\n\t\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t\t.attr(\"r\", 6)\r\n\t\t\t.attr(\"cx\", 0)\r\n\t\t\t.attr(\"cy\", 0);\r\n\r\n\t\tthis._mouseHeightFocusLabel = heightG.append(\"svg:text\")\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\");\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_applyData: function() {\r\n\t\tif (!this._data) return;\r\n\r\n\t\tlet state = {\r\n\t\t\tx: this._x,\r\n\t\t\ty: this._y,\r\n\t\t\tarea: this._area,\r\n\t\t\tpath: this._areapath,\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tdata: this._data,\r\n\t\t\toptions: this.options\r\n\t\t};\r\n\r\n\t\t[this._x, this._y] = D3.AxisRange(state);\r\n\t\t[this._area, this._areapath] = D3.AreaPath(state);\r\n\r\n\t\tthis._updateAxis();\r\n\r\n\t\tthis._fullExtent = this._calculateFullExtent(this._data);\r\n\t},\r\n\r\n\t/*\r\n\t * Calculates the full extent of the data array\r\n\t */\r\n\t_calculateFullExtent: function(data) {\r\n\t\tif (!data || data.length < 1) {\r\n\t\t\tthrow new Error(\"no data in parameters\");\r\n\t\t}\r\n\r\n\t\tlet ext = new L.latLngBounds(data[0].latlng, data[0].latlng);\r\n\r\n\t\tdata.forEach(item => ext.extend(item.latlng));\r\n\r\n\t\treturn ext;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset chart.\r\n\t */\r\n\t_clearChart: function() {\r\n\t\tthis._resetDrag();\r\n\t\tif (this._areapath) {\r\n\t\t\t// workaround for 'Error: Problem parsing d=\"\"' in Webkit when empty data\r\n\t\t\t// https://groups.google.com/d/msg/d3-js/7rFxpXKXFhI/HzIO_NPeDuMJ\r\n\t\t\t//this._areapath.datum(this._data).attr(\"d\", this._area);\r\n\t\t\tthis._areapath.attr(\"d\", \"M0 0\");\r\n\r\n\t\t\tthis._x.domain([0, 1]);\r\n\t\t\tthis._y.domain([0, 1]);\r\n\t\t\tthis._updateAxis();\r\n\t\t}\r\n\t\tif (this._altitudeLegend) {\r\n\t\t\tthis._altitudeLegend.select('text').style(\"text-decoration-line\", \"line-through\");\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data.\r\n\t */\r\n\t_clearData: function() {\r\n\t\tthis._data = null;\r\n\t\tthis._distance = null;\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t\tthis.track_info = null;\r\n\t\tthis._layers = null;\r\n\t\t// if (this.layer) {\r\n\t\t// \tthis.layer.removeFrom(this._map);\r\n\t\t// }\r\n\t},\r\n\r\n\t/*\r\n\t * Reset path.\r\n\t */\r\n\t_clearPath: function() {\r\n\t\tthis._hidePositionMarker();\r\n\t\tfor (let id in this._layers) {\r\n\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.polyline.className);\r\n\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.theme);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-expanded');\r\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-collapsed');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Recursive deep merge objects.\r\n\t * Alternative to L.Util.setOptions(this, options).\r\n\t */\r\n\t_deepMerge: function(target, ...sources) {\r\n\t\tif (!sources.length) return target;\r\n\t\tconst source = sources.shift();\r\n\t\tif (this._isObject(target) && this._isObject(source)) {\r\n\t\t\tfor (const key in source) {\r\n\t\t\t\tif (this._isObject(source[key])) {\r\n\t\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t\t[key]: {}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis._deepMerge(target[key], source[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._deepMerge(target, ...sources);\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item1 = this._findItemForX(this._dragStartCoords[0]);\r\n\t\tlet item2 = this._findItemForX(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (item1 == item2) return;\r\n\r\n\t\tthis._hidePositionMarker();\r\n\r\n\t\tthis._fitSection(item1, item2);\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis._fireEvt(\"elechart_dragged\", { data: { dragstart: this._data[item1], dragend: this._data[item2] } }, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet dragEndCoords = this._dragCurrentCoords = d3.mouse(this._focusRect.node());\r\n\r\n\t\tlet x1 = Math.min(this._dragStartCoords[0], dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(this._dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\tif (!this._dragRectangle && !this._dragRectangleG) {\r\n\t\t\tlet g = d3.select(this._container).select(\"svg\").select(\"g\");\r\n\r\n\t\t\tthis._dragRectangleG = g.insert(\"g\", \".mouse-focus-group\");\r\n\r\n\t\t\tthis._dragRectangle = this._dragRectangleG.append(\"rect\")\r\n\t\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t\t.attr(\"height\", this._height())\r\n\t\t\t\t.attr(\"x\", x1)\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t} else {\r\n\t\t\tthis._dragRectangle.attr(\"width\", x2 - x1)\r\n\t\t\t\t.attr(\"x\", x1);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-collapsed');\r\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-expanded');\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Finds an item with the smallest delta in distance to the given latlng coords\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\tlet result = null;\r\n\t\tlet d = Infinity;\r\n\t\tthis._data.forEach(item => {\r\n\t\t\tlet dist = latlng.distanceTo(item.latlng);\r\n\t\t\tif (dist < d) {\r\n\t\t\t\td = dist;\r\n\t\t\t\tresult = item;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\tlet bisect = d3.bisector(function(d) {\r\n\t\t\treturn d.dist;\r\n\t\t}).left;\r\n\t\tlet xinvert = this._x.invert(x);\r\n\t\treturn bisect(this._data, xinvert);\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) {\r\n\t\t\tthis.fire(type, data, propagate);\r\n\t\t}\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.fire(type, data, propagate);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Make the map fit the route section between given indexes.\r\n\t */\r\n\t_fitSection: function(index1, index2) {\r\n\t\tlet start = Math.min(index1, index2);\r\n\t\tlet end = Math.max(index1, index2);\r\n\t\tlet ext = this._calculateFullExtent(this._data.slice(start, end));\r\n\t\tthis.fitBounds(ext);\r\n\t},\r\n\r\n\t/*\r\n\t * Fromatting funciton using the given decimals and seperator\r\n\t */\r\n\t_formatter: function(num, dec, sep) {\r\n\t\tlet res = L.Util.formatNum(num, dec).toString();\r\n\t\tlet numbers = res.split(\".\");\r\n\t\tif (numbers[1]) {\r\n\t\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\r\n\t\t\t\tnumbers[1] += \"0\";\r\n\t\t\t}\r\n\t\t\tres = numbers.join(sep || \".\");\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hidePositionMarker: function() {\r\n\t\tif (!this.options.autohideMarker) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._selectedItem = null;\r\n\r\n\t\tif (this._marker) {\r\n\t\t\tif (this._map) this._map.removeLayer(this._marker);\r\n\t\t\tthis._marker = null;\r\n\t\t}\r\n\t\tif (this._mouseHeightFocus) {\r\n\t\t\tthis._mouseHeightFocus.style(\"visibility\", \"hidden\");\r\n\t\t\tthis._mouseHeightFocusLabel.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t\tif (this._pointG) {\r\n\t\t\tthis._pointG.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t\tif (this._focusG) {\r\n\t\t\tthis._focusG.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function() {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\t\topts.hoverNumber.formatter = opts.hoverNumber.formatter || this._formatter;\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet [width, height] = [this._width(), this._height()];\r\n\r\n\t\t[this._x, this._y] = D3.AxisRange({ width: width, height: height });\r\n\r\n\t\tlet state = {\r\n\t\t\tx: this._x,\r\n\t\t\ty: this._y,\r\n\t\t\twidth: width,\r\n\t\t\theight: height,\r\n\t\t\toptions: opts,\r\n\t\t\tinterpolation: opts.interpolation,\r\n\t\t\tcontainer: this._container\r\n\t\t};\r\n\r\n\t\tthis._svg = D3.Chart(L.extend({}, state, { width: opts.width, height: opts.height }));\r\n\r\n\t\t[this._area, this._areapath] = D3.AreaPath(state);\r\n\r\n\t\tthis.summaryDiv = D3.Summary(L.extend({}, state, { className: this.options.summary }));\r\n\r\n\t\tthis._appendChart(this._svg);\r\n\t\tthis._updateSummary();\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initToggle: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tL.DomEvent.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet iconCssClass = \"elevation-toggle \" + this.options.controlButton.iconCssClass + (this.options.autohide ? \"\" : \" close-button\");\r\n\t\t\tlet link = this._button = L.DomUtil.create('a', iconCssClass, container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = this.options.controlButton.title;\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t\t\t.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tL.DomEvent\r\n\t\t\t\t\t\t.on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t\t\t.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Check object type.\r\n\t */\r\n\t_isObject: function(item) {\r\n\t\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n\t},\r\n\r\n\t/**\r\n\t * Check JSON object type.\r\n\t */\r\n\t_isJSONDoc: function(doc, lazy) {\r\n\t\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\t\tif (typeof doc === \"string\" && lazy) {\r\n\t\t\tdoc = doc.trim();\r\n\t\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tJSON.parse(doc.toString());\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\t\tconsole.warn(e);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Check XML object type.\r\n\t */\r\n\t_isXMLDoc: function(doc, lazy) {\r\n\t\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\t\tif (typeof doc === \"string\" && lazy) {\r\n\t\t\tdoc = doc.trim();\r\n\t\t\treturn doc.indexOf(\"<\") == 0;\r\n\t\t} else {\r\n\t\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Check DOM element visibility.\r\n\t */\r\n\t_isDomVisible: function(elem) {\r\n\t\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n\t},\r\n\r\n\t/**\r\n\t * Check DOM element viewport visibility.\r\n\t */\r\n\t_isVisible: function(elem) {\r\n\t\tif (!elem) return false;\r\n\r\n\t\tlet styles = window.getComputedStyle(elem);\r\n\r\n\t\tfunction isVisibleByStyles(elem, styles) {\r\n\t\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t\t}\r\n\r\n\t\tfunction isAboveOtherElements(elem, styles) {\r\n\t\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\t\tlet left = boundingRect.left + 1;\r\n\t\t\tlet right = boundingRect.right - 1;\r\n\t\t\tlet top = boundingRect.top + 1;\r\n\t\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\t\tlet above = true;\r\n\r\n\t\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t\t// Only for completely visible elements\r\n\t\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\t\treturn above;\r\n\t\t}\r\n\r\n\t\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\t\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Async JS script download.\r\n\t */\r\n\t_lazyLoadJS: function(url, skip, loader) {\r\n\t\tif (skip === false || !this.options.lazyLoadJS) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\tif (loader instanceof Promise) {\r\n\t\t\treturn loader;\r\n\t\t}\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet tag = document.createElement(\"script\");\r\n\t\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\t\ttag.src = url;\r\n\t\t\tdocument.head.appendChild(tag);\r\n\t\t});\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis._fireEvt(\"elechart_enter\", null, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findItemForX(xCoord)];\r\n\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis._showDiagramIndicator(item, xCoord);\r\n\t\tthis._showPositionMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map && this._map._container) {\r\n\t\t\tL.DomUtil.addClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item }, true);\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item }, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data || this._data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet latlng = e.latlng;\r\n\t\tlet item = this._findItemForLatLng(latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t\tthis._showDiagramIndicator(item, xCoord);\r\n\t\t\tthis._showPositionMarker(item);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\r\n\t\tif (this._map && this._map._container) {\r\n\t\t\tL.DomUtil.removeClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\", null, true);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._selectedItem ? this._selectedItem.latlng : this._map.getCenter();\r\n\t\tlet z = e.deltaY > 0 ? this._map.getZoom() - 1 : this._map.getZoom() + 1;\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangleG) {\r\n\t\t\tthis._dragRectangleG.remove();\r\n\t\t\tthis._dragRectangleG = null;\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hidePositionMarker();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hidePositionMarker();\r\n\t\tthis.fitBounds(this._fullExtent);\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\r\n\t\t\t\tif (newWidth <= 0) return;\r\n\r\n\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\tthis.eleDiv.appendChild(this.onAdd(this._map));\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate GPX / GeoJSON download event.\r\n\t */\r\n\t_saveFile: function(fileUrl) {\r\n\t\tlet d = document,\r\n\t\t\ta = d.createElement('a'),\r\n\t\t\tb = d.body;\r\n\t\ta.href = fileUrl;\r\n\t\ta.target = '_new';\r\n\t\ta.download = \"\"; // fileName\r\n\t\ta.style.display = 'none';\r\n\t\tb.appendChild(a);\r\n\t\ta.click();\r\n\t\tb.removeChild(a);\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\tif (!this._chartEnabled) return;\r\n\r\n\t\tlet opts = this.options;\r\n\t\tthis._focusG.style(\"visibility\", \"visible\");\r\n\r\n\t\tthis._mousefocus.attr('x1', xCoordinate)\r\n\t\t\t.attr('y1', 0)\r\n\t\t\t.attr('x2', xCoordinate)\r\n\t\t\t.attr('y2', this._height())\r\n\t\t\t.classed('hidden', false);\r\n\r\n\t\tlet alt = item.z,\r\n\t\t\tdist = item.dist,\r\n\t\t\tll = item.latlng,\r\n\t\t\tnumY = opts.hoverNumber.formatter(alt, opts.hoverNumber.decimalsY),\r\n\t\t\tnumX = opts.hoverNumber.formatter(dist, opts.hoverNumber.decimalsX);\r\n\r\n\t\tthis._focuslabeltext\r\n\t\t\t// .attr(\"x\", xCoordinate)\r\n\t\t\t.attr(\"y\", this._y(item.z))\r\n\t\t\t.style(\"font-weight\", \"700\");\r\n\r\n\t\tthis._focuslabelX\r\n\t\t\t.text(numX + \" \" + this._xLabel)\r\n\t\t\t.attr(\"x\", xCoordinate + 10);\r\n\r\n\t\tthis._focuslabelY\r\n\t\t\t.text(numY + \" \" + this._yLabel)\r\n\t\t\t.attr(\"x\", xCoordinate + 10);\r\n\r\n\t\tlet focuslabeltext = this._focuslabeltext.node();\r\n\t\tif (this._isDomVisible(focuslabeltext)) {\r\n\t\t\tlet bbox = focuslabeltext.getBBox();\r\n\t\t\tlet padding = 2;\r\n\r\n\t\t\tthis._focuslabelrect\r\n\t\t\t\t.attr(\"x\", bbox.x - padding)\r\n\t\t\t\t.attr(\"y\", bbox.y - padding)\r\n\t\t\t\t.attr(\"width\", bbox.width + (padding * 2))\r\n\t\t\t\t.attr(\"height\", bbox.height + (padding * 2));\r\n\r\n\t\t\t// move focus label to left\r\n\t\t\tif (xCoordinate >= this._width() / 2) {\r\n\t\t\t\tthis._focuslabelrect.attr(\"x\", this._focuslabelrect.attr(\"x\") - this._focuslabelrect.attr(\"width\") - (padding * 2) - 10);\r\n\t\t\t\tthis._focuslabelX.attr(\"x\", this._focuslabelX.attr(\"x\") - this._focuslabelrect.attr(\"width\") - (padding * 2) - 10);\r\n\t\t\t\tthis._focuslabelY.attr(\"x\", this._focuslabelY.attr(\"x\") - this._focuslabelrect.attr(\"width\") - (padding * 2) - 10);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (L.DomUtil.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t/*\r\n\t * Shows the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_showPositionMarker: function(item) {\r\n\t\tthis._selectedItem = item;\r\n\r\n\t\tif (this._map && !this._map.getPane('elevationPane')) {\r\n\t\t\tthis._map.createPane('elevationPane');\r\n\t\t\tthis._map.getPane('elevationPane').style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tthis._map.getPane('elevationPane').style.pointerEvents = 'none';\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tthis._updatePositionMarker(item);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._updateLeafletMarker(item);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll(\"g\").remove();\r\n\t\tthis._axis.selectAll(\"g\").remove();\r\n\t\tthis._appendXGrid(this._grid);\r\n\t\tthis._appendYGrid(this._grid);\r\n\t\tthis._appendXaxis(this._axis);\r\n\t\tthis._appendYaxis(this._axis);\r\n\t},\r\n\r\n\t/**\r\n\t * Update distance and altitude level (\"leaflet-marker\").\r\n\t */\r\n\t_updateHeightIndicator: function(item) {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tlet numY = opts.hoverNumber.formatter(item.z, opts.hoverNumber.decimalsY);\r\n\t\tlet numX = opts.hoverNumber.formatter(item.dist, opts.hoverNumber.decimalsX);\r\n\r\n\t\tlet normalizedAlt = this._height() / this._maxElevation * item.z;\r\n\t\tlet normalizedY = item.y - normalizedAlt;\r\n\r\n\t\tthis._mouseHeightFocus\r\n\t\t\t.attr(\"x1\", item.x)\r\n\t\t\t.attr(\"x2\", item.x)\r\n\t\t\t.attr(\"y1\", item.y)\r\n\t\t\t.attr(\"y2\", normalizedY)\r\n\t\t\t.style(\"visibility\", \"visible\");\r\n\r\n\t\tthis._mouseHeightFocusLabel\r\n\t\t\t.attr(\"x\", item.x)\r\n\t\t\t.attr(\"y\", normalizedY)\r\n\t\t\t.text(numY + \" \" + this._yLabel)\r\n\t\t\t.style(\"visibility\", \"visible\");\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\t_updateLeafletMarker: function(item) {\r\n\t\tlet ll = item.latlng;\r\n\r\n\t\tif (!this._marker) {\r\n\t\t\tthis._marker = new L.Marker(ll, {\r\n\t\t\t\ticon: this.options.markerIcon,\r\n\t\t\t\tzIndexOffset: 1000000,\r\n\t\t\t});\r\n\t\t\tthis._marker.addTo(this._map, {\r\n\t\t\t\tpane: 'elevationPane',\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis._marker.setLatLng(ll);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update focus point (\"leaflet-marker\").\r\n\t */\r\n\t_updatePointG: function(item) {\r\n\t\tthis._pointG\r\n\t\t\t.attr(\"transform\", \"translate(\" + item.x + \",\" + item.y + \")\")\r\n\t\t\t.style(\"visibility\", \"visible\");\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\t_updatePositionMarker: function(item) {\r\n\t\tlet point = this._map.latLngToLayerPoint(item.latlng);\r\n\t\tlet layerpoint = {\r\n\t\t\tdist: item.dist,\r\n\t\t\tx: point.x,\r\n\t\t\ty: point.y,\r\n\t\t\tz: item.z,\r\n\t\t};\r\n\r\n\t\tif (!this._mouseHeightFocus) {\r\n\t\t\tL.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\t\t\tlet layerpane = d3.select(this._map.getContainer()).select(\".leaflet-elevation-pane svg\");\r\n\t\t\tthis._appendPositionMarker(layerpane);\r\n\t\t}\r\n\r\n\t\tthis._updatePointG(layerpoint);\r\n\t\tthis._updateHeightIndicator(layerpoint);\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tif (this.options.summary && this.summaryDiv) {\r\n\t\t\tthis.track_info = this.track_info || {};\r\n\t\t\tthis.track_info.distance = this._distance || 0;\r\n\t\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\t\t\td3.select(this.summaryDiv).html('<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + ' ' + this._xLabel + '</span></span><span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + ' ' + this._yLabel + '</span></span><span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + ' ' + this._yLabel + '</span></span>');\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tlet span = document.createElement('span');\r\n\t\t\tspan.className = 'download';\r\n\t\t\tlet save = document.createElement('a');\r\n\t\t\tsave.innerHTML = \"Download\";\r\n\t\t\tsave.href = \"#\";\r\n\t\t\tsave.onclick = function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tlet evt = { confirm: this._saveFile.bind(this, this._downloadURL) };\r\n\t\t\t\tlet type = this.options.downloadLink;\r\n\t\t\t\tif (type == 'modal') {\r\n\t\t\t\t\tif (typeof CustomEvent === \"function\") document.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: evt }));\r\n\t\t\t\t\tthis._fireEvt('eletrack_download', evt);\r\n\t\t\t\t} else if (type == 'link' || type === true) {\r\n\t\t\t\t\tevt.confirm();\r\n\t\t\t\t}\r\n\t\t\t}.bind(this);\r\n\r\n\t\t\tthis.summaryDiv.appendChild(span).appendChild(save);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\nL.control.elevation = function(options) {\r\n\treturn new L.Control.Elevation(options);\r\n};\r\n"],"names":["factory","window","define","amd","exports","module","require","L","locales","locale","registerLocale","code","Util","extend","setLocale","i18n","_","string","data","template","err","AxisRange","props","d3","scaleLinear","range","width","height","xdomain","extent","d","dist","ydomain","z","opts","options","undefined","yAxisMin","forceAxisBounds","yAxisMax","x","domain","y","AreaPath","interpolation","area","curve","xDiagCoord","y0","y1","create","attr","path","datum","Control","Elevation","includes","Evented","prototype","Mixin","Events","autohide","autohideMarker","collapsed","controlButton","iconCssClass","title","detached","distanceFactor","downloadLink","elevationDiv","followMarker","gpxOptions","async","marker_options","startIconUrl","endIconUrl","shadowUrl","wptIcons","divIcon","className","html","iconSize","iconAnchor","heightFactor","hoverNumber","decimalsX","decimalsY","formatter","imperial","lazyLoadJS","legend","loadData","defer","lazy","marker","markerIcon","placeholder","position","polyline","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","theme","margins","top","right","bottom","left","responsive","summary","xLabel","xTicks","yLabel","yTicks","zFollow","__mileFactor","__footFactor","addData","layer","_d3LazyLoader","this","_lazyLoadJS","then","_addData","_container","_applyData","on","_path","DomUtil","addClass","_mousemoveLayerHandler","_mouseoutHandler","track_info","distance","_distance","elevation_max","_maxElevation","elevation_min","_minElevation","_layers","stamp","_fireEvt","bind","addTo","map","_appendElevationDiv","appendChild","onAdd","call","clear","_clearPath","_clearChart","_clearData","disableDragging","_draggingEnabled","_resetDrag","enableDragging","fitBounds","bounds","_fullExtent","_map","getZFollow","_zFollow","hide","style","display","initialize","Browser","mobile","_deepMerge","_chartEnabled","_distanceFactor","_heightFactor","_xLabel","_yLabel","_setMapView","throttle","e","point","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","load","loadChart","loadDefer","loadLazy","_isXMLDoc","loadGPX","_isJSONDoc","loadGeoJSON","loadFile","document","readyState","addEventListener","once","url","_downloadURL","xhr","XMLHttpRequest","responseType","open","onload","status","response","send","console","warn","JSON","parse","geojson","geoJson","feature","pointToLayer","latlng","icon","desc","properties","name","bindPopup","length","openPopup","fire","point_type","element","onEachFeature","geometry","type","getBounds","_gpxLazyLoader","GPX","polyline_options","gpx","target","line","get_name","ticking","scrollFn","requestAnimFrame","_isVisible","removeEventListener","parentNode","removeChild","container","_data","src","alt","i","setAttribute","insertBefore","firstChild","_initToggle","_initChart","_hidePositionMarker","_resetView","_resizeChart","_updateSummary","DomEvent","onRemove","redraw","setZFollow","zoom","show","geom","feat","_latlngs","_addGeoJSONData","coordinates","forEach","coords","features","_addGPXdata","_addPoint","lat","lng","meta","ele","eleMax","Infinity","eleMin","curr","LatLng","prev","delta","distanceTo","Math","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","_appendChart","svg","g","append","_appendGrid","_appendAreaPath","_appendAxis","_appendFocusRect","_appendMouseFocusG","_appendLegend","eleDiv","querySelector","random","toString","substr","id","nextSibling","removeClass","_appendXaxis","axis","_height","axisBottom","scale","_x","ticks","_width","text","_appendXGrid","grid","tickSize","tickFormat","_appendYaxis","axisLeft","_y","_appendYGrid","_areapath","node","_axis","focusRect","_focusRect","_dragHandler","_dragStartHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_grid","focusG","_focusG","_mousefocus","_focuslabelrect","_focuslabeltext","_focuslabelY","_focuslabelX","_legend","altitude","_altitudeLegend","_appendPositionMarker","pane","heightG","select","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","state","_area","D3.AxisRange","D3.AreaPath","_updateAxis","_calculateFullExtent","Error","ext","latLngBounds","item","_collapse","sources","source","shift","_isObject","key","Object","assign","[object Object]","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","_dragCurrentCoords","item1","_findItemForX","item2","_fitSection","dragstart","dragend","mouse","dragEndCoords","x1","min","x2","max","_dragRectangle","_dragRectangleG","insert","_expand","_findItemForLatLng","result","bisect","bisector","xinvert","invert","propagate","index1","index2","start","end","slice","_formatter","num","dec","sep","res","formatNum","numbers","split","join","_selectedItem","_marker","removeLayer","offWi","offsetWidth","offHe","offsetHeight","_maxWidth","containerWidth","clientWidth","_svg","D3.Chart","summaryDiv","disableClickPropagation","_mousewheelHandler","link","_button","href","stop","_toggle","Array","isArray","doc","trim","indexOf","documentElement","ownerDocument","nodeName","_isDomVisible","elem","getClientRects","styles","getComputedStyle","visibility","isVisibleByStyles","boundingRect","getBoundingClientRect","above","pointerEvents","elementFromPoint","isAboveOtherElements","skip","loader","Promise","resolve","reject","tag","createElement","head","ctx","xCoord","_showDiagramIndicator","_showPositionMarker","gestureHandling","_enabled","ll","getCenter","deltaY","getZoom","flyTo","remove","_isFullscreen","newWidth","innerHTML","removeControl","_saveFile","fileUrl","a","b","body","download","click","xCoordinate","classed","numY","numX","focuslabeltext","bbox","getBBox","padding","hasClass","setView","animate","duration","getPane","createPane","zIndex","_updatePositionMarker","_updateLeafletMarker","selectAll","_updateHeightIndicator","normalizedAlt","normalizedY","setLatLng","Marker","zIndexOffset","_updatePointG","latLngToLayerPoint","layerpoint","layerpane","getContainer","toFixed","span","save","onclick","evt","confirm","CustomEvent","dispatchEvent","detail","control","elevation"],"mappings":"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"}