{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/chart.js","../src/marker.js","../src/summary.js","../src/options.js","../src/control.js","../src/altitude.js","../src/slope.js","../src/index.js"],"sourcesContent":["/**\r\n * Recursive deep merge objects.\r\n * Alternative to L.Util.setOptions(this, options).\r\n */\r\nexport function deepMerge(target, ...sources) {\r\n\tif (!sources.length) return target;\r\n\tconst source = sources.shift();\r\n\tif (isObject(target) && isObject(source)) {\r\n\t\tfor (const key in source) {\r\n\t\t\tif (isObject(source[key])) {\r\n\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t[key]: {}\r\n\t\t\t\t});\r\n\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn deepMerge(target, ...sources);\r\n}\r\n\r\n/**\r\n * Wait for document load before execute function.\r\n */\r\nexport function deferFunc(f) {\r\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\r\n\telse f();\r\n}\r\n\r\n/*\r\n * Formatting funciton using the given decimals and seperator.\r\n */\r\nexport function formatter(num, dec, sep) {\r\n\tlet res = L.Util.formatNum(num, dec).toString();\r\n\tlet numbers = res.split(\".\");\r\n\tif (numbers[1]) {\r\n\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\r\n\t\t\tnumbers[1] += \"0\";\r\n\t\t}\r\n\t\tres = numbers.join(sep || \".\");\r\n\t}\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * Simple GeoJSON data loader.\r\n */\r\nexport function GeoJSONLoader(data, control) {\r\n\tif (typeof data === \"string\") {\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tcontrol = control || this;\r\n\r\n\tlet layer = L.geoJson(data, {\r\n\t\tstyle: (feature) => {\r\n\t\t\tlet style = L.extend({}, control.options.polyline);\r\n\t\t\tif (control.options.theme) {\r\n\t\t\t\tstyle.className += ' ' + control.options.theme;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\tif (name || desc) {\r\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t}\r\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\treturn marker;\r\n\t\t},\r\n\t\tonEachFeature: (feature, layer) => {\r\n\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\tcontrol.addData(feature, layer);\r\n\r\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\r\n\t\t},\r\n\t});\r\n\r\n\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info })\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Simple GPX data loader.\r\n */\r\nexport function GPXLoader(data, control) {\r\n\tcontrol = control || this;\r\n\r\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\r\n\r\n\tif (control.options.theme) {\r\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\r\n\t}\r\n\r\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\r\n\r\n\t// similar to L.GeoJSON.pointToLayer\r\n\tlayer.on('addpoint', (e) => {\r\n\t\tcontrol.fire(\"waypoint_added\", e);\r\n\t});\r\n\r\n\t// similar to L.GeoJSON.onEachFeature\r\n\tlayer.on(\"addline\", (e) => {\r\n\t\tcontrol.addData(e.line /*, layer*/ );\r\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\r\n\t});\r\n\r\n\t// unlike the L.GeoJSON, L.GPX parsing is async\r\n\tlayer.once('loaded', (e) => {\r\n\t\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info });\r\n\t\t});\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Check DOM element visibility.\r\n */\r\nexport function isDomVisible(elem) {\r\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n}\r\n\r\n/**\r\n * Check object type.\r\n */\r\nexport function isObject(item) {\r\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n/**\r\n * Check DOM element viewport visibility.\r\n */\r\nexport function isVisible(elem) {\r\n\tif (!elem) return false;\r\n\r\n\tlet styles = window.getComputedStyle(elem);\r\n\r\n\tfunction isVisibleByStyles(elem, styles) {\r\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t}\r\n\r\n\tfunction isAboveOtherElements(elem, styles) {\r\n\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\tlet left = boundingRect.left + 1;\r\n\t\tlet right = boundingRect.right - 1;\r\n\t\tlet top = boundingRect.top + 1;\r\n\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\tlet above = true;\r\n\r\n\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t// Only for completely visible elements\r\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\treturn above;\r\n\t}\r\n\r\n\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Check JSON object type.\r\n */\r\nexport function isJSONDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tJSON.parse(doc.toString());\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Check XML object type.\r\n */\r\nexport function isXMLDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"<\") == 0;\r\n\t} else {\r\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Async JS script download.\r\n */\r\nexport function lazyLoader(url, skip, loader) {\r\n\tif (skip === false) {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\tif (loader instanceof Promise) {\r\n\t\treturn loader;\r\n\t}\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\n/**\r\n * Download data from a remote url.\r\n */\r\nexport function loadFile(url, success) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = \"text\";\r\n\t\txhr.open('GET', url);\r\n\t\txhr.onload = () => resolve(xhr.response);\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\n/**\r\n * Generate download data event.\r\n */\r\nexport function saveFile(dataURI, fileName) {\r\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\r\n\tlet b = document.body;\r\n\tb.appendChild(a);\r\n\ta.click();\r\n\tb.removeChild(a);\r\n}\r\n\r\n/**\r\n * Wait for element visible before execute function.\r\n */\r\nexport function waitHolder(elem) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = () => {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(() => {\r\n\t\t\t\t\tif (isVisible(elem)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t});\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t});\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.addClass\r\n */\r\nexport function addClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.addClass(targetNode, s); });\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.removeClass()\r\n */\r\nexport function removeClass(targetNode, className) {\r\n\teach(className.split(\" \"), s => { if (targetNode && className) L.DomUtil.removeClass(targetNode, s); });\r\n}\r\n\r\nexport function toggleClass(targetNode, className, conditional) {\r\n\treturn (conditional ? addClass : removeClass).call(null, targetNode, className)\r\n}\r\n\r\nexport function style(targetNode, name, value) {\r\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\r\n\telse return targetNode.style.setProperty(name, value);\r\n}\r\n\r\n/**\r\n * A little bit shorter than L.DomUtil.create()\r\n */\r\nexport function create(tagName, className, attributes, parent) {\r\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\r\n\tif (attributes) setAttributes(elem, attributes);\r\n\tif (parent) append(parent, elem);\r\n\treturn elem;\r\n}\r\n\r\n/**\r\n * Same as node.appendChild()\r\n */\r\nexport function append(parent, child) {\r\n\treturn parent.appendChild(child);\r\n}\r\n\r\n/**\r\n * Same as node.insertAdjacentElement()\r\n */\r\nexport function insert(parent, child, position) {\r\n\treturn parent.insertAdjacentElement(position, child);\r\n}\r\n\r\n/**\r\n * Loop for node.setAttribute()\r\n */\r\nexport function setAttributes(elem, attrs) {\r\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\r\n}\r\n\r\n/**\r\n * Same as node.querySelector().\r\n */\r\nexport function select(selector, context) {\r\n\treturn (context || document).querySelector(selector);\r\n}\r\n\r\n/**\r\n * Alias for L.DomEvent.on.\r\n */\r\nexport const on = L.DomEvent.on;\r\n\r\n/**\r\n * Alias for L.DomEvent.off.\r\n */\r\nexport const off = L.DomEvent.off;\r\n\r\n/**\r\n * Alias for L.DomUtil.hasClass.\r\n */\r\nexport const hasClass = L.DomUtil.hasClass;\r\n\r\n\r\nexport function randomId() {\r\n\treturn Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nexport function each(obj, fn) {\r\n\tfor (let i in obj) fn(obj[i], i);\r\n}\r\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Area = ({\r\n\tdata,\r\n\tname,\r\n\txAttr,\r\n\tyAttr,\r\n\tscaleX,\r\n\tscaleY,\r\n\theight,\r\n\tinterpolation = \"curveLinear\",\r\n}) => {\r\n\treturn path => {\r\n\t\tif (typeof interpolation === 'string') interpolation = d3[interpolation];\r\n\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\r\n\t\t\t.y0(height)\r\n\t\t\t.y1(d => scaleY(d[yAttr]));\r\n\r\n\t\tif (data) path.datum(data).attr(\"d\", area);\r\n\t\tif (name) path.attr('data-name', name);\r\n\r\n\t\treturn area;\r\n\t};\r\n};\r\n\r\nexport const AreaPath = (props) => {\r\n\treturn d3.create('svg:path')\r\n\t\t.attr(\"class\", \"area\")\r\n\t\t.call(Area(props));\r\n};\r\n\r\nexport const Axis = ({\r\n\ttype = \"axis\",\r\n\ttickSize = 6,\r\n\ttickPadding = 3,\r\n\tposition,\r\n\theight,\r\n\twidth,\r\n\taxis,\r\n\tscale,\r\n\tticks,\r\n\ttickFormat,\r\n\tlabel,\r\n\tlabelX,\r\n\tlabelY\r\n}) => {\r\n\treturn g => {\r\n\t\tlet [w, h] = [0, 0];\r\n\t\tif (position == \"bottom\") h = height;\r\n\t\tif (position == \"right\") w = width;\r\n\r\n\t\tif (axis == \"x\" && type == \"grid\") {\r\n\t\t\ttickSize = -height;\r\n\t\t} else if (axis == \"y\" && type == \"grid\") {\r\n\t\t\ttickSize = -width;\r\n\t\t}\r\n\r\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\r\n\t\t\t.scale(scale)\r\n\t\t\t.ticks(ticks)\r\n\t\t\t.tickPadding(tickPadding)\r\n\t\t\t.tickSize(tickSize)\r\n\t\t\t.tickFormat(tickFormat);\r\n\r\n\t\tlet axisGroup = g.append(\"g\")\r\n\t\t\t.attr(\"class\", [axis, type, position].join(\" \"))\r\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\r\n\t\t\t.call(axisScale);\r\n\r\n\t\tif (label) {\r\n\t\t\taxisGroup.append(\"text\")\r\n\t\t\t\t.attr(\"x\", labelX)\r\n\t\t\t\t.attr(\"y\", labelY)\r\n\t\t\t\t.text(label);\r\n\t\t}\r\n\r\n\t\treturn axisGroup;\r\n\t};\r\n};\r\n\r\nexport const DragRectangle = ({\r\n\tdragStartCoords,\r\n\tdragEndCoords,\r\n\theight,\r\n}) => {\r\n\treturn rect => {\r\n\t\tlet x1 = Math.min(dragStartCoords[0], dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\treturn rect\r\n\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.attr(\"x\", x1);\r\n\t};\r\n};\r\n\r\nexport const FocusRect = ({\r\n\twidth,\r\n\theight,\r\n}) => {\r\n\treturn rect => rect\r\n\t\t.attr(\"width\", width)\r\n\t\t.attr(\"height\", height)\r\n\t\t.style(\"fill\", \"none\")\r\n\t\t.style(\"stroke\", \"none\")\r\n\t\t.style(\"pointer-events\", \"all\");\r\n};\r\n\r\nexport const Grid = (props) => {\r\n\tprops.type = \"grid\";\r\n\treturn Axis(props);\r\n};\r\n\r\nexport const HeightFocusLine = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlength = 0,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t.attr(\"x1\", xCoord)\r\n\t\t.attr(\"x2\", xCoord)\r\n\t\t.attr(\"y1\", yCoord)\r\n\t\t.attr(\"y2\", length);\r\n};\r\n\r\nexport const HeightFocusLabel = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlabel,\r\n}) => {\r\n\treturn text => {\r\n\t\ttext\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t.attr(\"x\", xCoord + 5)\r\n\t\t\t.attr(\"y\", yCoord);\r\n\r\n\t\tlet y = text.select(\".height-focus-y\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"height-focus-y\")\r\n\t\t\t.text(label);\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\r\n\r\n\t\treturn text;\r\n\t};\r\n};\r\n\r\nexport const HeightFocusPoint = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n}) => {\r\n\treturn circle => circle\r\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\r\n\t\t.attr(\"r\", 6)\r\n\t\t.attr(\"cx\", 0)\r\n\t\t.attr(\"cy\", 0);\r\n};\r\n\r\n\r\nexport const LegendItem = ({\r\n\tname,\r\n\twidth,\r\n\theight,\r\n\tmargins = {},\r\n}) => {\r\n\treturn g => {\r\n\t\tg\r\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\r\n\t\t\t.attr(\"data-name\", name);\r\n\r\n\t\tg.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (width / 2) - 50)\r\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 10)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\tg.append('text')\r\n\t\t\t.text(L._(name))\r\n\t\t\t.attr(\"x\", (width / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', height + margins.bottom / 2)\r\n\t\t\t.attr('dy', \"0.75em\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const MouseFocusLine = ({\r\n\txCoord = 0,\r\n\theight,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr('class', 'mouse-focus-line')\r\n\t\t.attr('x2', xCoord)\r\n\t\t.attr('y2', 0)\r\n\t\t.attr('x1', xCoord)\r\n\t\t.attr('y1', height);\r\n};\r\n\r\nexport const MouseFocusLabel = ({\r\n\txCoord,\r\n\tyCoord,\r\n\tlabelX = \"\",\r\n\tlabelY = \"\",\r\n\twidth,\r\n}) => {\r\n\treturn g => {\r\n\r\n\t\tg.attr('class', 'mouse-focus-label');\r\n\r\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\r\n\t\tlet text = g.select(\".mouse-focus-label-text\");\r\n\t\tlet y = text.select(\".mouse-focus-label-y\");\r\n\t\tlet x = text.select(\".mouse-focus-label-x\");\r\n\r\n\t\tif (!rect.node()) rect = g.append(\"rect\");\r\n\t\tif (!text.node()) text = g.append(\"svg:text\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\r\n\r\n\t\ty.text(labelY);\r\n\t\tx.text(labelX);\r\n\r\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\r\n\t\tlet xAlign = 0;\r\n\t\tlet yAlign = 0;\r\n\t\tlet bbox = { width: 0, height: 0 };\r\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\r\n\r\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\r\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\r\n\r\n\t\trect\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\r\n\t\t\t.attr(\"x\", xAlign - 5)\r\n\t\t\t.attr(\"y\", yAlign - 5)\r\n\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t.attr(\"height\", bbox.height + 10)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\t\ttext\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr(\"y\", yAlign);\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"1em\");\r\n\t\tx\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\r\n\r\n\t\treturn g;\r\n\t};\r\n};\r\n\r\nexport const Scale = ({\r\n\tdata,\r\n\tattr,\r\n\tmin,\r\n\tforceBounds,\r\n\trange,\r\n}) => {\r\n\tlet domain = data ? d3.extent(data, d => d[attr]) : [0, 1];\r\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\r\n\t\tdomain[0] = min;\r\n\t}\r\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\r\n\t\tdomain[1] = max;\r\n\t}\r\n\treturn d3.scaleLinear()\r\n\t\t.range(range)\r\n\t\t.domain(domain);\r\n};\r\n\r\nexport const Bisect = ({\r\n\tdata = [0, 1],\r\n\tscale,\r\n\tx,\r\n\tattr\r\n}) => {\r\n\treturn d3\r\n\t\t.bisector(d => d[attr])\r\n\t\t.left(data, scale.invert(x));\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Chart = L.Class.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\tinitialize: function(options) {\r\n\t\tlet opts = this.options = options;\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._draggingEnabled = opts.dragging;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._xTicks = opts.xTicks;\r\n\t\tthis._yTicks = opts.yTicks;\r\n\r\n\t\tlet scale = this._updateScale();\r\n\r\n\t\tlet svg = this._svg = d3.create(\"svg\")\r\n\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\tlet g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\r\n\t\t\t.call(this._appendGrid())\r\n\t\t\t.call(this._appendAxis())\r\n\t\t\t.call(this._appendAreaPath())\r\n\t\t\t.call(this._appendFocusable())\r\n\t\t\t.call(this._appendLegend());\r\n\r\n\t\tthis._grid = svg.select('.grid');\r\n\t\tthis._area = svg.select('.area');\r\n\t\tthis._path = svg.select('.area path');\r\n\t\tthis._axis = svg.select('.axis');\r\n\t\tthis._focus = svg.select('.focus');\r\n\t\tthis._focusRect = this._focus.select('rect');\r\n\t\tthis._legend = svg.select('.legend');\r\n\t\tthis._x = scale.x;\r\n\t\tthis._y = scale.y;\r\n\r\n\t},\r\n\r\n\tupdate: function(props) {\r\n\t\tif (props.data) this._data = props.data;\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tthis._updateScale();\r\n\t\tthis._updateAxis();\r\n\t\tthis._updateAreaPath();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._svg.node());\r\n\t},\r\n\r\n\t_updateScale: function() {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._x = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [0, this._width()],\r\n\t\t\tattr: opts.xAttr,\r\n\t\t\tmin: opts.xAxisMin,\r\n\t\t\tmax: opts.xAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tthis._y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: opts.yAttr,\r\n\t\t\tmin: opts.yAxisMin,\r\n\t\t\tmax: opts.yAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\treturn { x: this._x, y: this._y };\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll('g').remove();\r\n\t\tthis._axis.selectAll('g').remove();\r\n\t\tthis._grid\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t\tthis._axis\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\r\n\t\t// this.fire('axis_updated');\r\n\t},\r\n\r\n\t_updateAreaPath: function() {\r\n\t\tlet opts = this.options;\r\n\t\tthis._path\r\n\t\t\t.call(\r\n\t\t\t\tD3.Area({\r\n\t\t\t\t\tinterpolation: opts.interpolation,\r\n\t\t\t\t\tdata: this._data,\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\t\tyAttr: opts.yAttr,\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tscaleX: this._x,\r\n\t\t\t\t\tscaleY: this._y,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-axis\".\r\n\t */\r\n\t_appendXaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\tlabel: this._xLabel,\r\n\t\t\tlabelY: 25,\r\n\t\t\tlabelX: this._width() + 6,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\tlabel: this._yLabel,\r\n\t\t\tlabelX: -25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendAreaPath: function() {\r\n\t\treturn g => g.append('g')\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.append('path');\r\n\t},\r\n\r\n\t_appendFocusable: function() {\r\n\t\treturn g => {\r\n\t\t\treturn g.append('g')\r\n\t\t\t\t.attr(\"class\", 'focus')\r\n\t\t\t\t.call(this._appendFocusRect())\r\n\t\t\t\t.call(this._appendMouseFocusG());\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusRect = g.append(\"rect\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.FocusRect({\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tif (L.Browser.mobile) {\r\n\t\t\t\tfocusRect\r\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\t\tL.DomEvent.on(this._svg.node(), 'touchend', this._dragEndHandler, this);\r\n\t\t\t}\r\n\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._svg.node(), 'mouseup', this._dragEndHandler, this);\r\n\r\n\t\t\treturn focusRect;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\r\n\r\n\t\t\tthis._focusline = focusG.append('svg:line')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLine({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);;\r\n\t\t\tthis._focuslabel = focusG.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\tyCoord: 0,\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\tlabelX: \"\",\r\n\t\t\t\t\t\tlabelY: \"\",\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\treturn focusG;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function() {\r\n\t\treturn g => {\r\n\t\t\t// if (!this.options.legend) return;\r\n\r\n\t\t\tlet legend = g.append('g')\r\n\t\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\t\t// this.fire(\"legend\");\r\n\r\n\t\t\t// let items = legend.selectAll('.legend-item')\r\n\t\t\t// \t.on('click', (d, i) => {\r\n\t\t\t// \t\tlet target = items.nodes()[i];\r\n\t\t\t// \t\tlet name = target.getAttribute('data-name');\r\n\t\t\t// \t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t// \t\t// this._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t// \t});\r\n\r\n\t\t\treturn legend;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\r\n\t\tif (!this._dragRectangle) {\r\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t}\r\n\t\tthis._dragRectangle.call(\r\n\t\t\tD3.DragRectangle({\r\n\t\t\t\tdragStartCoords: this._dragStartCoords,\r\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet start = this._findIndexForXCoord(this._dragStartCoords[0]);\r\n\t\tlet end = this._findIndexForXCoord(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (start == end) return;\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis.fire(\"mouse_enter\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findIndexForXCoord(xCoord)];\r\n\r\n\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tthis.fire(\"mouse_out\");\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findIndexForXCoord: function(x) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d[this.options.xAttr])\r\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given latlng of the map\r\n\t */\r\n\t_findIndexForLatLng: function(latlng) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d.latlng)\r\n\t\t\t.left(this._data, latlng)\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangle) {\r\n\t\t\tthis._dragRectangle.remove();\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hideDiagramIndicator();\r\n\t\t\tthis.fire('reset_drag');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\t// if (!this._chartEnabled) return;\r\n\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\r\n\t\tlet opts = this.options;\r\n\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\tlet [fx, fy] = [opts.hoverNumber.decimalsX, opts.hoverNumber.decimalsY];\r\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\r\n\r\n\t\tthis._focusline.call(\r\n\t\t\tD3.MouseFocusLine({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\theight: this._height()\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis._focuslabel.call(\r\n\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\tyCoord: yCoordinate,\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\tlabelX: formatter(item[opts.xAttr], fx) + \" \" + this._xLabel,\r\n\t\t\t\tlabelY: formatter(item[opts.yAttr], fy) + \" \" + this._yLabel,\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t_hideDiagramIndicator: function() {\r\n\t\tthis._focusG.classed(\"hidden\", true);\r\n\t},\r\n});\r\n\r\n// Chart.addInitHook(function() {\r\n// \tthis.on('mouse_move', function(e) {\r\n// \t\tif (e.item) this._showDiagramIndicator(e.item, e.xCoord);\r\n// \t});\r\n//\r\n// });\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Marker = L.Class.extend({\r\n\r\n\tinitialize: function(options) {\r\n\t\tthis.options = options;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tlet g = this._heightG = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tthis._mouseHeightFocus = d3.create('svg:line');\r\n\t\t\tthis._pointG = d3.create(\"svg:circle\");\r\n\t\t\tthis._mouseHeightFocusLabel = d3.create(\"svg:text\");\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000, interactive: false });\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddTo: function(map) {\r\n\t\tthis._map = map;\r\n\t\tlet pane, renderer;\r\n\t\tif (!map.getPane('elevationPane')) {\r\n\t\t\tpane = this._pane = map.createPane('elevationPane');\r\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tpane.style.pointerEvents = 'none';\r\n\t\t}\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\trenderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\t\t\tlet g = this._heightG = d3.select(renderer.getPane()).select(\"svg > g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tg.append(() => this._mouseHeightFocus.node());\r\n\t\t\tg.append(() => this._pointG.node());\r\n\t\t\tg.append(() => this._mouseHeightFocusLabel.node());\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker.addTo(map, { pane: 'elevationPane' });\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\tupdate: function(props) {\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tlet opts = this.options;\r\n\r\n\t\tif (!this._map) this.addTo(props.map);\r\n\r\n\t\tthis._latlng = props.item.latlng;\r\n\r\n\t\tlet point = L.extend({}, props.item, this._map.latLngToLayerPoint(this._latlng));\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\r\n\t\t\tlet formatter = opts.hoverNumber.formatter;\r\n\t\t\tlet fy = opts.hoverNumber.decimalsY;\r\n\r\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\r\n\t\t\tlet normalizedY = point.y - normalizedAlt;\r\n\r\n\t\t\tthis._heightG.classed(\"hidden\", false);\r\n\t\t\tthis._pointG.classed(\"hidden\", false);\r\n\r\n\t\t\tthis._pointG\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusPoint({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\tthis._mouseHeightFocus\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLine({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t\tlength: normalizedY\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._mouseHeightFocusLabel\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLabel({\r\n\t\t\t\t\t\ttheme: this.options.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: normalizedY,\r\n\t\t\t\t\t\tlabel: formatter(point[opts.yAttr], fy) + \" \" + this._yLabel\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.removeClass(this._marker.getElement(), 'hidden');\r\n\t\t\tthis._marker.setLatLng(this._latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\tremove: function() {\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tif (this._heightG) this._heightG.classed(\"hidden\", true);\r\n\t\t\tif (this._pointG) this._pointG.classed(\"hidden\", true);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.addClass(this._marker.getElement(), 'hidden');\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function() {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Summary = L.Class.extend({\r\n\tinitialize: function(options) {\r\n\t\tlet opts = this.options = options;\r\n\r\n\t\tlet summary = this._summary = _.create(\"div\", \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : ''), {\r\n\t\t\tstyle: 'max-width:' + this.options.width + 'px'\r\n\t\t});\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._summary);\r\n\t},\r\n\r\n\treset: function(){\r\n\t\tthis._summary.innerHTML = '';\r\n\t}\r\n});\r\n","import * as _ from './utils';\r\n\r\nexport var Options = {\r\n\tautohide: !L.Browser.mobile,\r\n\tautohideMarker: true,\r\n\tcollapsed: false,\r\n\tdetached: true,\r\n\tdistanceFactor: 1,\r\n\tdragging: !L.Browser.mobile,\r\n\tdownloadLink: 'link',\r\n\televationDiv: \"#elevation-div\",\r\n\tfollowMarker: true,\r\n\tforceAxisBounds: false,\r\n\tgpxOptions: {\r\n\t\tasync: true,\r\n\t\tmarker_options: {\r\n\t\t\tstartIconUrl: null,\r\n\t\t\tendIconUrl: null,\r\n\t\t\tshadowUrl: null,\r\n\t\t\twptIcons: {\r\n\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\theight: 200,\r\n\theightFactor: 1,\r\n\thoverNumber: {\r\n\t\tdecimalsX: 2,\r\n\t\tdecimalsY: 0,\r\n\t\tformatter: _.formatter,\r\n\t},\r\n\timperial: false,\r\n\tinterpolation: \"curveLinear\",\r\n\tlazyLoadJS: true,\r\n\tlegend: true,\r\n\tloadData: {\r\n\t\tdefer: false,\r\n\t\tlazy: false,\r\n\t},\r\n\tmargins: {\r\n\t\ttop: 10,\r\n\t\tright: 20,\r\n\t\tbottom: 30,\r\n\t\tleft: 50\r\n\t},\r\n\tmarker: 'elevation-line',\r\n\tmarkerIcon: L.divIcon({\r\n\t\tclassName: 'elevation-position-marker',\r\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\ticonSize: [32, 32],\r\n\t\ticonAnchor: [16, 16],\r\n\t}),\r\n\tplaceholder: false,\r\n\tposition: \"topright\",\r\n\tpolyline: {\r\n\t\tclassName: 'elevation-polyline',\r\n\t\tcolor: '#000',\r\n\t\topacity: 0.75,\r\n\t\tweight: 5,\r\n\t\tlineCap: 'round'\r\n\t},\r\n\treverseCoords: false,\r\n\tskipNullZCoords: false,\r\n\ttheme: \"lightblue-theme\",\r\n\tresponsive: true,\r\n\tsummary: 'inline',\r\n\tslope: false,\r\n\tsDeltaMax: false,\r\n\tsInterpolation: \"curveStepAfter\",\r\n\tsRange: false,\r\n\twidth: 600,\r\n\txAttr: \"dist\",\r\n\txLabel: \"km\",\r\n\txTicks: undefined,\r\n\tyAttr: \"z\",\r\n\tyAxisMax: undefined,\r\n\tyAxisMin: undefined,\r\n\tyLabel: \"m\",\r\n\tyTicks: undefined,\r\n\tzFollow: 13,\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Marker } from './marker';\r\nimport { Summary } from './summary';\r\nimport { Options } from './options';\r\n\r\nexport const Elevation = L.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: Options,\r\n\t_data: [],\r\n\t_layers: L.featureGroup(),\r\n\t_chartEnabled: true,\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\t__D3: 'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t__LGPX: 'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._addData(d);\r\n\t\t\tthis._addLayer(layer);\r\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tlet eleDiv = this._initElevationDiv();\r\n\t\t\tif (!eleDiv.isConnected) _.insert(map._container, eleDiv, 'afterend');\r\n\t\t\t_.append(eleDiv, this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tthis._marker.remove();\r\n\t\tthis._chart._resetDrag();\r\n\t\tthis._layers.clearLayers();\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._distance = 0;\r\n\t\tthis.track_info = {};\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this.getBounds();\r\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\tgetBounds: function(data) {\r\n\t\tdata = data || this._data;\r\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\t_.style(this._container, \"display\", \"none\");\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis.options = _.deepMerge({}, this.options, options);\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\t\tthis._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (_.isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (_.isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\t_.loadFile(url)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.warn(err));\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\t_.GeoJSONLoader(data, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\r\n\t\t\tthis.__LGPX,\r\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._gpxLazyLoader\r\n\t\t).then(() => _.GPXLoader(data, this));\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\r\n\t\t_.waitHolder(elem)\r\n\t\t\t.then(() => {\r\n\t\t\t\topts.lazy = false;\r\n\t\t\t\tthis.loadData(data, opts)\r\n\t\t\t\tthis.once('eledata_loaded', () => opts.lazy.parentNode.removeChild(elem));\r\n\t\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\t_.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data.length) {\r\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\r\n\t\t\t_.insert(container, this.placeholder, 'beforebegin');\r\n\t\t}\r\n\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._initToggle(container);\r\n\t\t\tthis._initChart(container);\r\n\t\t\tthis._initMarker(map);\r\n\t\t\tthis._initLayer(map);\r\n\r\n\t\t\tmap\r\n\t\t\t\t.on('zoom viewreset zoomanim', this._hideMarker, this)\r\n\t\t\t\t.on('resize', this._resetView, this)\r\n\t\t\t\t.on('resize', this._resizeChart, this)\r\n\t\t\t\t.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\t_.on(map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t\t_.on(map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\tthis\r\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateChart, this)\r\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateSummary, this);\r\n\r\n\t\t\tthis._updateChart();\r\n\t\t\tthis._updateSummary();\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\r\n\t\tmap\r\n\t\t\t.off('zoom viewreset zoomanim', this._hideMarker, this)\r\n\t\t\t.off('resize', this._resetView, this)\r\n\t\t\t.off('resize', this._resizeChart, this)\r\n\t\t\t.off('mousedown', this._resetDrag, this);\r\n\r\n\t\t_.off(map._container, 'mousewheel', this._resetDrag, this);\r\n\t\t_.off(map._container, 'touchstart', this._resetDrag, this);\r\n\r\n\t\tthis\r\n\t\t\t.off('eledata_added eledata_loaded', this._updateChart, this)\r\n\t\t\t.off('eledata_added eledata_loaded', this._updateSummary, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\t_.style(this._container, \"display\", \"block\");\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\t_.each(d.features, feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXData(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point[1], point[0], point[2]));\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tlet data = this._data || [];\r\n\t\tlet i = data.length;\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = new L.LatLng(x, y);\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\tz = z * this._heightFactor;\r\n\r\n\t\tdata.push({\r\n\t\t\tdist: dist,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: curr\r\n\t\t});\r\n\r\n\t\tthis._data = data;\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance = dist;\r\n\r\n\t\tthis._fireEvt(\"eledata_updated\", { index: i });\r\n\t},\r\n\r\n\t_addLayer: function(layer) {\r\n\t\tif (layer) this._layers.addLayer(layer)\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_initElevationDiv: function() {\r\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\r\n\t\t\teleDiv = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\t_.addClass(eleDiv, 'elevation-detached');\r\n\t\t\t_.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\t_.removeClass(this._container, 'elevation-expanded');\r\n\t\t_.addClass(this._container, 'elevation-collapsed');\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\t_.removeClass(this._container, 'elevation-collapsed');\r\n\t\t_.addClass(this._container, 'elevation-expanded');\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for the given LatLng\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\treturn this._data[this._chart._findIndexForLatLng(latlng)];\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for the given xDiagCoord\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn this._data[this._chart._findIndexForXCoord(x)];\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) this.fire(type, data, propagate);\r\n\t\tif (this._map) this._map.fire(type, data, propagate);\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hideMarker: function() {\r\n\t\tif (this.options.autohideMarker) {\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function() {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet chart = this._chart = new Chart(opts);\r\n\t\tlet summary = this._summary = new Summary(opts);\r\n\r\n\t\tlet container = d3.select(this._container)\r\n\t\t\t.call(chart.render())\r\n\t\t\t.call(summary.render());\r\n\r\n\t\tthis._svg = chart._svg;\r\n\t\tthis._grid = chart._grid;\r\n\t\tthis._area = chart._area;\r\n\t\tthis._path = chart._path;\r\n\t\tthis._axis = chart._axis;\r\n\t\tthis._focus = chart._focus;\r\n\t\tthis._focusRect = chart._focusRect;\r\n\t\tthis._x = chart._x;\r\n\t\tthis._y = chart._y;\r\n\t\tthis._legend = chart._legend;\r\n\t\tthis._focuslabel = chart._focuslabel;\r\n\t\tthis._focusline = chart._focusline;\r\n\t\tthis.summaryDiv = summary._summary;\r\n\r\n\t\tchart\r\n\t\t\t.on('reset_drag', this._hideMarker, this)\r\n\t\t\t.on('mouse_enter', this._fireEvt.bind('elechart_enter'), this)\r\n\t\t\t.on('dragged', this._fireEvt.bind(\"elechart_dragged\"), this)\r\n\t\t\t.on('mouse_move', this._mousemoveHandler, this)\r\n\t\t\t.on('mouse_out', this._mouseoutHandler, this);\r\n\t\t// chart.on('legend', this._fireEvt.bind('elechart_legend'), this);\r\n\r\n\t\tif (this.options.legend) this._fireEvt(\"elechart_legend\");\r\n\r\n\t\tthis._fireEvt(\"elechart_init\");\r\n\t},\r\n\r\n\t_initLayer: function() {\r\n\t\tthis._layers\r\n\t\t\t.on('layeradd layerremove', (e) => {\r\n\t\t\t\tlet layer = e.layer\r\n\t\t\t\tlet toggleClass = e.type == 'layeradd' ? _.addClass : _.removeClass;\r\n\t\t\t\tlet toggleEvt = layer[e.type == 'layeradd' ? \"on\" : \"off\"].bind(layer);\r\n\t\t\t\ttoggleClass(layer.getElement(), this.options.polyline.className + ' ' + this.options.theme);\r\n\t\t\t\ttoggleEvt(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\ttoggleEvt(\"mouseout\", this._mouseoutHandler, this);\r\n\t\t\t});\r\n\t},\r\n\r\n\t_initMarker: function(map) {\r\n\t\tthis._marker = (new Marker(this.options)).addTo(map);\r\n\r\n\t\tthis._mouseHeightFocusLabel = this._marker._mouseHeightFocusLabel;\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initToggle: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\t_.on(container, 'mouseover', this._expand, this);\r\n\t\t\t\t\t_.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\r\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(e) {\r\n\t\tif (!this._data.length || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet xCoord = e.xCoord;\r\n\t\tlet item = this._findItemForX(xCoord);\r\n\r\n\t\tif(this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\tthis._updateMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.addClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item = this._findItemForLatLng(e.latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\t\tthis._updateMarker(item);\r\n\r\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hideMarker();\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t}\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.removeClass(this._map._container, 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\r\n\t\tlet z = this._map.getZoom() + Math.sign(e.deltaY);\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tthis._chart._resetDrag();\r\n\t\tthis._hideMarker();\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hideMarker();\r\n\t\tthis.fitBounds();\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\t// prevent displaying chart on resize if hidden\r\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\r\n\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\t\t\t\tif (newWidth) {\r\n\t\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\t\t_.append(this.eleDiv, this.onAdd(this._map));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_updateChart: function() {\r\n\t\tif (!this._data.length || !this._container) return;\r\n\r\n\t\tthis._chart = this._chart.update({ data: this._data });\r\n\r\n\t\tthis._x = this._chart._x;\r\n\t\tthis._y = this._chart._y;\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\r\n\t\tthis._fireEvt('elechart_updated');\r\n\t},\r\n\r\n\t/*\r\n\t * Update the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_updateMarker: function(item) {\r\n\t\tthis._marker.update({ item: item, maxElevation: this._maxElevation, options: this.options });\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tthis.track_info = this.track_info || {};\r\n\t\tthis.track_info.distance = this._distance || 0;\r\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\r\n\t\tthis._summary.reset();\r\n\r\n\t\tif (this.options.summary) {\r\n\t\t\tthis._fireEvt(\"elechart_summary\");\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\r\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\r\n\t\t\t};\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Attach here some useful elevation hooks.\r\n */\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on('waypoint_added', function(e) {\r\n\t\tlet p = e.point,\r\n\t\t\tpop = p._popup;\r\n\t\tif (pop) {\r\n\t\t\tpop.options.className = 'elevation-popup';\r\n\t\t}\r\n\t\tif (pop._content) {\r\n\t\t\tpop._content = decodeURI(pop._content);\r\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t}\r\n\t});\r\n\r\n\t// autotoggle chart data on click\r\n\tthis.on('elepath_toggle', function(e) {\r\n\t\tlet path = e.path;\r\n\t\tlet enable = _.hasClass(path, 'hidden');\r\n\t\tlet label = _.select('text', e.legend);\r\n\t\tlet rect = _.select('rect', e.legend);\r\n\r\n\t\t_.style(label, \"text-decoration-line\", enable ? \"\" : \"line-through\")\r\n\t\t_.style(rect, \"fill-opacity\", enable ? \"\" : \"0\")\r\n\t\t_.toggleClass(path, 'hidden', !enable);\r\n\r\n\t\tthis._chartEnabled = this._area.selectAll('path:not(.hidden)').nodes().length != 0;\r\n\t\tthis._layers.eachLayer(l => _.toggleClass(l.getElement(), this.options.polyline.className + ' ' + this.options.theme, this._chartEnabled));\r\n\r\n\t\tif (!this._chartEnabled) {\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_dragged\", function(e) {\r\n\t\tthis._hideMarker();\r\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\r\n\t});\r\n\r\n\tthis.on(\"elechart_updated\", function() {\r\n\t\t// TODO: maybe should i listen for this inside chart.js?\r\n\t\tthis._legend.selectAll('.legend-item')\r\n\t\t\t.on('click', (d, i, n) => {\r\n\t\t\t\tlet target = n[i];\r\n\t\t\t\tlet name = target.getAttribute('data-name');\r\n\t\t\t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t});\r\n\t});\r\n\r\n\tthis.on(\"eletrack_download\", function(e) {\r\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\r\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\r\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\r\n\t\t\te.confirm();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_loaded', function(e) {\r\n\t\tlet layer = e.layer;\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.once('layeradd', function(e) {\r\n\t\t\t\tthis.fitBounds(layer.getBounds());\r\n\t\t\t}, this);\r\n\t\t\tlayer.addTo(this._map);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_clear', function() {\r\n\t\tthis._area.selectAll('path')\r\n\t\t\t.attr(\"d\", \"M0 0\");\r\n\t\tif (this._path) {\r\n\t\t\t// this._x.domain([0, 1]);\r\n\t\t\t// this._y.domain([0, 1]);\r\n\t\t\t// this._updateAxis();\r\n\t\t}\r\n\t});\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && i > 0) {\r\n\t\t\tlet prevZ = data[i - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z * this._heightFactor;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) data[i - 1].z = prevZ;\r\n\t\t\t\telse data.splice(i - 1, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\r\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tthis._altitudeLegend = this._legend.append('g')\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.summaryDiv.innerHTML +=\r\n\t\t\t'<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>' +\r\n\t\t\t'<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>' +\r\n\t\t\t'<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (!this.options.slope) return;\r\n\r\n\tlet opts = this.options;\r\n\tlet slope = {};\r\n\topts.margins.right = 50;\r\n\r\n\tif (this.options.slope != \"summary\") {\r\n\r\n\t\tthis.on(\"elechart_init\", function() {\r\n\t\t\tslope.path = this._area.append('path')\r\n\t\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_axis\", function() {\r\n\t\t\tslope.x = this._x;\r\n\r\n\t\t\t// slope.x = D3.Scale({\r\n\t\t\t// \tdata: this._data,\r\n\t\t\t// \trange: [0, this._width()],\r\n\t\t\t// \tattr: opts.xAttr,\r\n\t\t\t// \tmin: opts.xAxisMin,\r\n\t\t\t// \tmax: opts.xAxisMax,\r\n\t\t\t// \tforceBounds: opts.forceAxisBounds,\r\n\t\t\t// });\r\n\r\n\t\t\tslope.y = D3.Scale({\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\trange: [this._height(), 0],\r\n\t\t\t\tattr: \"slope\",\r\n\t\t\t\tmin: -1,\r\n\t\t\t\tmax: +1,\r\n\t\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t\t});\r\n\r\n\t\t\tslope.axis = D3.Axis({\r\n\t\t\t\taxis: \"y\",\r\n\t\t\t\tposition: \"right\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscale: slope.y,\r\n\t\t\t\tticks: this.options.yTicks,\r\n\t\t\t\ttickPadding: 16,\r\n\t\t\t\tlabel: \"%\",\r\n\t\t\t\tlabelX: 25,\r\n\t\t\t\tlabelY: 3,\r\n\t\t\t});\r\n\r\n\t\t\tthis._axis.call(slope.axis);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_updated\", function() {\r\n\t\t\tslope.area = D3.Area({\r\n\t\t\t\tinterpolation: opts.sInterpolation,\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\tname: 'Slope',\r\n\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\tyAttr: \"slope\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscaleX: slope.x,\r\n\t\t\t\tscaleY: slope.y,\r\n\t\t\t});\r\n\r\n\t\t\tslope.path.call(slope.area);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_legend\", function() {\r\n\t\t\tslope.legend = this._legend.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\t\tname: 'Slope',\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._altitudeLegend\r\n\t\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\r\n\r\n\t\t\tslope.legend\r\n\t\t\t\t.attr(\"transform\", \"translate(50, 0)\");\r\n\r\n\t\t\tslope.legend.select(\"rect\")\r\n\t\t\t\t.classed(\"area\", false)\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\t// Slope / Gain\r\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\r\n\t\tlet tDes = this._tDes || 0; // Total Descent\r\n\t\tlet sMax = this._sMax || 0; // Slope Max\r\n\t\tlet sMin = this._sMin || 0; // Slope Min\r\n\t\tlet slope = 0;\r\n\r\n\t\tif (!isNaN(z)) {\r\n\t\t\tlet deltaZ = i > 0 ? z - data[i - 1].z : 0;\r\n\t\t\tif (deltaZ > 0) tAsc += deltaZ;\r\n\t\t\telse if (deltaZ < 0) tDes -= deltaZ;\r\n\t\t\t// slope in % = ( height / length ) * 100\r\n\t\t\tslope = delta !== 0 ? (deltaZ / delta) * 100 : 0;\r\n\t\t}\r\n\r\n\t\tif (this.options.sDeltaMax) {\r\n\t\t\tlet deltaS = i > 0 ? slope - data[i - 1].slope : 0;\r\n\t\t\tlet maxDeltaS = this.options.sDeltaMax;\r\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\r\n\t\t\t\tslope = data[i - 1].slope + maxDeltaS * Math.sign(deltaS);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.options.sRange) {\r\n\t\t\tlet range = this.options.sRange;\r\n\t\t\tif (slope < range[0]) slope = range[0];\r\n\t\t\telse if (slope > range[1]) slope = range[1];\r\n\t\t}\r\n\r\n\t\tslope = L.Util.formatNum(slope, 2);\r\n\r\n\t\tsMax = slope > sMax ? slope : sMax;\r\n\t\tsMin = slope < sMin ? slope : sMin;\r\n\r\n\t\tdata[i].slope = slope;\r\n\r\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\r\n\t\tthis.track_info.descent = this._tDes = tDes;\r\n\t\tthis.track_info.slope_max = this._sMax = sMax;\r\n\t\tthis.track_info.slope_min = this._sMin = sMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_change\", function(e) {\r\n\t\tlet item = e.data;\r\n\t\tlet xCoordinate = e.xCoord;\r\n\r\n\t\tif (this._focuslabel) {\r\n\t\t\tif (!this._focuslabelSlope || !this._focuslabelSlope.property('isConnected')) {\r\n\t\t\t\tthis._focuslabelSlope = this._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\r\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\r\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._focuslabelSlope.text(item.slope + \"%\");\r\n\r\n\t\t\tthis._focuslabel.select('.mouse-focus-label-x')\r\n\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t}\r\n\r\n\t\tif (this._mouseHeightFocusLabel) {\r\n\t\t\tif (!this._mouseSlopeFocusLabel) {\r\n\t\t\t\tthis._mouseSlopeFocusLabel = this._mouseHeightFocusLabel.append(\"svg:tspan\")\r\n\t\t\t\t\t.attr(\"class\", \"height-focus-slope \");\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseSlopeFocusLabel\r\n\t\t\t\t.attr(\"dy\", \"1.5em\")\r\n\t\t\t\t.text(Math.round(item.slope) + \"%\");\r\n\r\n\t\t\tthis._mouseHeightFocusLabel.select('.height-focus-y')\r\n\t\t\t\t.attr(\"dy\", \"-1.5em\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.ascent = this._tAsc || 0;\r\n\t\tthis.track_info.descent = this._tDes || 0;\r\n\t\tthis.track_info.slope_max = this._sMax || 0;\r\n\t\tthis.track_info.slope_min = this._sMin || 0;\r\n\r\n\t\tthis.summaryDiv.querySelector('.minele').insertAdjacentHTML('afterend', '<span class=\"ascent\"><span class=\"summarylabel\">' + L._(\"Total Ascent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.ascent) + '&nbsp;' +\r\n\t\t\tthis._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"descent\"><span class=\"summarylabel\">' + L._(\"Total Descent: \") + '</span><span class=\"summaryvalue\">' + Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel +\r\n\t\t\t'</span></span>' + '<span class=\"minslope\"><span class=\"summarylabel\">' + L._(\"Min Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_min + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>' + '<span class=\"maxslope\"><span class=\"summarylabel\">' + L._(\"Max Slope: \") + '</span><span class=\"summaryvalue\">' + this.track_info.slope_max + '&nbsp;' + '%' +\r\n\t\t\t'</span></span>');\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._sMax = null;\r\n\t\tthis._sMin = null;\r\n\t\tthis._tAsc = null;\r\n\t\tthis._tDes = null;\r\n\t});\r\n\r\n});\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Elevation } from './control';\r\nimport './altitude';\r\nimport './slope';\r\n\r\nElevation.Utils = _;\r\nElevation.Components = D3;\r\nElevation.Chart = Chart;\r\n\r\nL.control.elevation = (options) => new Elevation(options);\r\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","window","addEventListener","once","formatter","num","dec","sep","res","L","Util","formatNum","toString","numbers","split","d","join","GeoJSONLoader","data","control","JSON","parse","this","layer","geoJson","style","feature","extend","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","Control","Elevation","_d3LazyLoader","then","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","item","_typeof","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","requestAnimFrame","removeEventListener","addClass","targetNode","each","s","DomUtil","removeClass","toggleClass","conditional","call","value","getStyle","setProperty","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","factory","define","amd","exports","module","require","locales","locale","registerLocale","code","setLocale","i18n","_","string","template","err","DomEvent","off","hasClass","randomId","Math","random","substr","obj","fn","i","offsetWidth","offsetHeight","getClientRects","Area","xAttr","yAttr","scaleX","scaleY","height","interpolation","path","d3","area","curve","x","xDiagCoord","y0","y1","datum","attr","Axis","tickSize","tickPadding","width","axis","scale","ticks","tickFormat","label","labelX","labelY","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","text","DragRectangle","dragStartCoords","dragEndCoords","rect","x1","min","x2","max","FocusRect","Grid","props","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusPoint","circle","LegendItem","margins","toLowerCase","MouseFocusLine","MouseFocusLabel","xAlign","yAlign","bbox","getBBox","Browser","webkit","Infinity","Scale","forceBounds","range","domain","extent","scaleLinear","bisector","invert","Chart","Class","includes","Evented","prototype","Mixin","Events","initialize","opts","_data","_draggingEnabled","dragging","imperial","_xLabel","_yLabel","xLabel","yLabel","_xTicks","xTicks","_yTicks","yTicks","_updateScale","svg","_svg","_appendGrid","_appendAxis","_appendAreaPath","_appendFocusable","_appendLegend","_grid","_area","_path","_axis","_focus","_focusRect","_legend","_x","_y","update","_updateAxis","_updateAreaPath","render","container","_this","D3","_width","xAxisMin","xAxisMax","forceAxisBounds","_height","yAxisMin","yAxisMax","remove","_appendXGrid","_appendYGrid","_appendXaxis","_appendYaxis","_this2","_this3","_this4","_appendFocusRect","_appendMouseFocusG","focusRect","_this5","mobile","_dragStartHandler","bind","_dragHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_mouseoutHandler","focusG","_this6","_focusG","_focusline","_focuslabel","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","mouse","_dragRectangle","_dragCurrentCoords","_resetDrag","start","_findIndexForXCoord","end","dragstart","dragend","ctx","_this7","_findIndexForLatLng","_hideDiagramIndicator","_showDiagramIndicator","xCoordinate","classed","hoverNumber","decimalsX","decimalsY","fx","fy","yCoordinate","Marker","_heightG","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","_marker","markerIcon","zIndexOffset","interactive","addTo","map","pane","renderer","_map","getPane","_pane","createPane","zIndex","_latlng","latLngToLayerPoint","normalizedAlt","maxElevation","z","normalizedY","getElement","setLatLng","getLatLng","Summary","_summary","summary","reset","innerHTML","Options","autohide","autohideMarker","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","legend","loadData","defer","placeholder","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","responsive","slope","sDeltaMax","sInterpolation","sRange","undefined","zFollow","_layers","featureGroup","_chartEnabled","__mileFactor","__footFactor","__D3","__LGPX","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","_container","onAdd","clear","_chart","clearLayers","_distance","disableDragging","enableDragging","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","_distanceFactor","_heightFactor","_setMapView","throttle","load","loadChart","loadDefer","loadLazy","loadGPX","loadGeoJSON","_downloadURL","catch","_gpxLazyLoader","parentNode","alt","_initToggle","_initChart","_initMarker","_initLayer","_hideMarker","_resetView","_resizeChart","_updateChart","_updateSummary","onRemove","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","coords","features","_addGPXData","_addPoint","_this8","lat","lng","meta","ele","dist","curr","LatLng","prev","delta","distanceTo","round","push","distance","index","addLayer","id","_collapse","_expand","_findItemForLatLng","_findItemForX","propagate","offWi","offHe","_maxWidth","containerWidth","clientWidth","chart","summaryDiv","toggleEvt","_this9","_mousemoveLayerHandler","disableClickPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_updateMarker","gestureHandling","_enabled","ll","getCenter","getZoom","sign","deltaY","flyTo","_isFullscreen","newWidth","removeControl","setView","animate","duration","_maxElevation","elevation_max","elevation_min","_minElevation","onclick","_this10","confirm","addInitHook","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enable","nodes","eachLayer","_this11","n","getAttribute","_this12","CustomEvent","dispatchEvent","detail","eleMax","eleMin","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","_altitudeLegend","toFixed","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","deltaZ","deltaS","maxDeltaS","abs","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseSlopeFocusLabel","insertAdjacentHTML","Utils","Components","elevation"],"mappings":"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"}