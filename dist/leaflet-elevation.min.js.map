{"version":3,"file":"leaflet-elevation.min.js","sources":["../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/leaflet-elevation.js"],"sourcesContent":["// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","/*\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\n *\n *  This file is free software: you may copy, redistribute and/or modify it\n *  under the terms of the GNU General Public License as published by the\n *  Free Software Foundation, either version 2 of the License, or (at your\n *  option) any later version.\n *\n *  This file is distributed in the hope that it will be useful, but\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n *  General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see .\n *\n * This file incorporates work covered by the following copyright and\n * permission notice:\n *\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\n *\n *     Permission to use, copy, modify, and/or distribute this software\n *     for any purpose with or without fee is hereby granted, provided\n *     that the above copyright notice and this permission notice appear\n *     in all copies.\n *\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n */\n\nimport 'leaflet-i18n';\n\nL.Control.Elevation = L.Control.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\toptions: {\n\t\tautohide: !L.Browser.mobile,\n\t\tautohideMarker: true,\n\t\tcollapsed: false,\n\t\tcontrolButton: {\n\t\t\ticonCssClass: \"elevation-toggle-icon\",\n\t\t\ttitle: \"Elevation\"\n\t\t},\n\t\tdetached: true,\n\t\tdistanceFactor: 1,\n\t\tdragging: !L.Browser.mobile,\n\t\tdownloadLink: 'link',\n\t\televationDiv: \"#elevation-div\",\n\t\tfollowMarker: true,\n\t\tforceAxisBounds: false,\n\t\tgpxOptions: {\n\t\t\tasync: true,\n\t\t\tmarker_options: {\n\t\t\t\tstartIconUrl: null,\n\t\t\t\tendIconUrl: null,\n\t\t\t\tshadowUrl: null,\n\t\t\t\twptIcons: {\n\t\t\t\t\t'': L.divIcon({\n\t\t\t\t\t\tclassName: 'elevation-waypoint-marker',\n\t\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\n\t\t\t\t\t\ticonSize: [30, 30],\n\t\t\t\t\t\ticonAnchor: [8, 30],\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\theight: 200,\n\t\theightFactor: 1,\n\t\thoverNumber: {\n\t\t\tdecimalsX: 2,\n\t\t\tdecimalsY: 0,\n\t\t\tformatter: undefined\n\t\t},\n\t\timperial: false,\n\t\tinterpolation: \"curveLinear\",\n\t\tlazyLoadJS: true,\n\t\tlegend: true,\n\t\tloadData: {\n\t\t\tdefer: false,\n\t\t\tlazy: false,\n\t\t},\n\t\tmarker: 'elevation-line',\n\t\tmarkerIcon: L.divIcon({\n\t\t\tclassName: 'elevation-position-marker',\n\t\t\thtml: '<i class=\"elevation-position-icon\"></i>',\n\t\t\ticonSize: [32, 32],\n\t\t\ticonAnchor: [16, 16],\n\t\t}),\n\t\tplaceholder: false,\n\t\tposition: \"topright\",\n\t\tpolyline: {\n\t\t\tclassName: 'elevation-polyline',\n\t\t\tcolor: '#000',\n\t\t\topacity: 0.75,\n\t\t\tweight: 5,\n\t\t\tlineCap: 'round'\n\t\t},\n\t\treverseCoords: false,\n\t\tskipNullZCoords: false,\n\t\ttheme: \"lightblue-theme\",\n\t\tmargins: {\n\t\t\ttop: 10,\n\t\t\tright: 20,\n\t\t\tbottom: 30,\n\t\t\tleft: 50\n\t\t},\n\t\tresponsive: true,\n\t\tsummary: 'inline',\n\t\twidth: 600,\n\t\txLabel: \"km\",\n\t\txTicks: undefined,\n\t\tyAxisMax: undefined,\n\t\tyAxisMin: undefined,\n\t\tyLabel: \"m\",\n\t\tyTicks: undefined,\n\t\tzFollow: 13,\n\t},\n\t__mileFactor: 0.621371,\n\t__footFactor: 3.28084,\n\n\t/*\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\n\t */\n\taddData: function(d, layer) {\n\t\tL.Control.Elevation._d3LazyLoader = this._lazyLoadJS(\n\t\t\t'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\n\t\t\ttypeof d3 !== 'object',\n\t\t\tL.Control.Elevation._d3LazyLoader\n\t\t).then(\n\t\t\tfunction(d, layer) {\n\t\t\t\tthis._addData(d);\n\n\t\t\t\tif (this._container) {\n\t\t\t\t\tthis._applyData();\n\t\t\t\t}\n\t\t\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\n\t\t\t\t\tlayer = d;\n\t\t\t\t}\n\t\t\t\tif (layer) {\n\t\t\t\t\tif (layer._path) {\n\t\t\t\t\t\tL.DomUtil.addClass(layer._path, this.options.polyline.className + ' ' + this.options.theme);\n\t\t\t\t\t}\n\t\t\t\t\tlayer\n\t\t\t\t\t\t.on(\"mousemove\", this._mousemoveLayerHandler, this)\n\t\t\t\t\t\t.on(\"mouseout\", this._mouseoutHandler, this);\n\t\t\t\t}\n\n\t\t\t\tthis.track_info = L.extend({}, this.track_info, {\n\t\t\t\t\tdistance: this._distance,\n\t\t\t\t\televation_max: this._maxElevation,\n\t\t\t\t\televation_min: this._minElevation\n\t\t\t\t});\n\n\t\t\t\tthis._layers = this._layers || {};\n\t\t\t\tthis._layers[L.Util.stamp(layer)] = layer;\n\n\t\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info }, true);\n\t\t\t}.bind(this, d, layer));\n\t},\n\n\t/**\n\t * Adds the control to the given map.\n\t */\n\taddTo: function(map) {\n\t\tif (this.options.detached) {\n\t\t\tthis._appendElevationDiv(map._container).appendChild(this.onAdd(map));\n\t\t} else {\n\t\t\tL.Control.prototype.addTo.call(this, map);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/*\n\t * Reset data and display\n\t */\n\tclear: function() {\n\t\tthis._clearPath();\n\t\tthis._clearChart();\n\t\tthis._clearData();\n\n\t\tthis._fireEvt(\"eledata_clear\");\n\t},\n\n\t/**\n\t * Disable dragging chart on touch events.\n\t */\n\tdisableDragging: function() {\n\t\tthis._draggingEnabled = false;\n\t\tthis._resetDrag();\n\t},\n\n\t/**\n\t * Enable dragging chart on touch events.\n\t */\n\tenableDragging: function() {\n\t\tthis._draggingEnabled = true;\n\t},\n\n\t/**\n\t * Sets a map view that contains the given geographical bounds.\n\t */\n\tfitBounds: function(bounds) {\n\t\tbounds = bounds || this._fullExtent;\n\t\tif (this._map && bounds) this._map.fitBounds(bounds);\n\t},\n\n\t/**\n\t * Get default zoom level when \"followMarker\" is true.\n\t */\n\tgetZFollow: function() {\n\t\treturn this._zFollow;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\thide: function() {\n\t\tthis._container.style.display = \"none\";\n\t},\n\n\t/**\n\t * Initialize chart control \"options\" and \"container\".\n\t */\n\tinitialize: function(options) {\n\t\tthis.options = this._deepMerge({}, this.options, options);\n\n\t\tif (this.options.imperial) {\n\t\t\tthis._distanceFactor = this.__mileFactor;\n\t\t\tthis._heightFactor = this.__footFactor;\n\t\t\tthis._xLabel = \"mi\";\n\t\t\tthis._yLabel = \"ft\";\n\t\t} else {\n\t\t\tthis._distanceFactor = this.options.distanceFactor;\n\t\t\tthis._heightFactor = this.options.heightFactor;\n\t\t\tthis._xLabel = this.options.xLabel;\n\t\t\tthis._yLabel = this.options.yLabel;\n\t\t}\n\n\t\tthis._chartEnabled = true;\n\t\tthis._draggingEnabled = this.options.dragging;\n\t\tthis._zFollow = this.options.zFollow;\n\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\n\n\t\tthis.on('waypoint_added', function(e) {\n\t\t\tif (e.point._popup) {\n\t\t\t\te.point._popup.options.className = 'elevation-popup';\n\t\t\t\te.point._popup._content = decodeURI(e.point._popup._content);\n\t\t\t}\n\t\t\tif (e.point._popup && e.point._popup._content) {\n\t\t\t\te.point.bindTooltip(e.point._popup._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Alias for loadData\n\t */\n\tload: function(data, opts) {\n\t\tthis.loadData(data, opts);\n\t},\n\n\t/**\n\t * Alias for addTo\n\t */\n\tloadChart: function(map) {\n\t\tthis.addTo(map);\n\t},\n\n\t/**\n\t * Load elevation data (GPX or GeoJSON).\n\t */\n\tloadData: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\tif (opts.defer) {\n\t\t\tthis.loadDefer(data, opts);\n\t\t} else if (opts.lazy) {\n\t\t\tthis.loadLazy(data, opts);\n\t\t} else if (this._isXMLDoc(data)) {\n\t\t\tthis.loadGPX(data);\n\t\t} else if (this._isJSONDoc(data)) {\n\t\t\tthis.loadGeoJSON(data);\n\t\t} else {\n\t\t\tthis.loadFile(data);\n\t\t}\n\t},\n\n\t/**\n\t * Wait for document load before download data.\n\t */\n\tloadDefer: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\topts.defer = false;\n\t\tif (document.readyState !== 'complete') window.addEventListener(\"load\", L.bind(this.loadData, this, data, opts), { once: true });\n\t\telse this.loadData(data, opts)\n\t},\n\n\t/**\n\t * Load data from a remote url.\n\t */\n\tloadFile: function(url) {\n\t\tthis._downloadURL = url; // TODO: handle multiple urls?\n\t\ttry {\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\txhr.responseType = \"text\";\n\t\t\txhr.open('GET', url);\n\t\t\txhr.onload = function() {\n\t\t\t\tif (xhr.status !== 200) {\n\t\t\t\t\tthrow \"Error \" + xhr.status + \" while fetching remote file: \" + url;\n\t\t\t\t} else {\n\t\t\t\t\tthis.loadData(xhr.response, { lazy: false, defer: false });\n\t\t\t\t}\n\t\t\t}.bind(this);\n\t\t\txhr.send();\n\t\t} catch (e) {\n\t\t\tconsole.warn(e);\n\t\t}\n\t},\n\n\t/**\n\t * Load raw GeoJSON data.\n\t */\n\tloadGeoJSON: function(data) {\n\t\tif (typeof data === \"string\") {\n\t\t\tdata = JSON.parse(data);\n\t\t}\n\n\t\tthis.layer = this.geojson = L.geoJson(data, {\n\t\t\tstyle: function(feature) {\n\t\t\t\tlet style = L.extend({}, this.options.polyline);\n\t\t\t\tif (this.options.theme) {\n\t\t\t\t\tstyle.className += ' ' + this.options.theme;\n\t\t\t\t}\n\t\t\t\treturn style;\n\t\t\t}.bind(this),\n\t\t\tpointToLayer: function(feature, latlng) {\n\t\t\t\tlet marker = L.marker(latlng, { icon: this.options.gpxOptions.marker_options.wptIcons[''] });\n\t\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\n\t\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\n\t\t\t\tif (name || desc) {\n\t\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\n\t\t\t\t}\n\t\t\t\tthis.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\n\t\t\t\treturn marker;\n\t\t\t}.bind(this),\n\t\t\tonEachFeature: function(feature, layer) {\n\t\t\t\tif (feature.geometry.type == 'Point') return;\n\n\t\t\t\tthis.addData(feature, layer);\n\n\t\t\t\tthis.track_info = L.extend({}, this.track_info, { type: \"geojson\", name: data.name });\n\t\t\t}.bind(this),\n\t\t});\n\t\tif (this._map) {\n\t\t\tthis._map.once('layeradd', function(e) {\n\t\t\t\tthis.fitBounds(this.layer.getBounds());\n\t\t\t\tthis._fireEvt(\"eledata_loaded\", { data: data, layer: this.layer, name: this.track_info.name, track_info: this.track_info }, true);\n\t\t\t}, this);\n\n\t\t\tthis.layer.addTo(this._map);\n\t\t} else {\n\t\t\tconsole.warn(\"Undefined elevation map object\");\n\t\t}\n\t},\n\n\t/**\n\t * Load raw GPX data.\n\t */\n\tloadGPX: function(data) {\n\t\tL.Control.Elevation._gpxLazyLoader = this._lazyLoadJS(\n\t\t\t'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\n\t\t\ttypeof L.GPX !== 'function',\n\t\t\tL.Control.Elevation._gpxLazyLoader\n\t\t).then(\n\t\t\tfunction(data) {\n\t\t\t\tthis.options.gpxOptions.polyline_options = L.extend({}, this.options.polyline, this.options.gpxOptions.polyline_options);\n\n\t\t\t\tif (this.options.theme) {\n\t\t\t\t\tthis.options.gpxOptions.polyline_options.className += ' ' + this.options.theme;\n\t\t\t\t}\n\n\t\t\t\tthis.layer = this.gpx = new L.GPX(data, this.options.gpxOptions);\n\n\t\t\t\tthis.layer.on('loaded', function(e) { this.fitBounds(e.target.getBounds()); }, this);\n\t\t\t\tthis.layer.on('addpoint', function(e) { this.fire(\"waypoint_added\", e, true); }, this);\n\t\t\t\tthis.layer.once(\"addline\", function(e) {\n\t\t\t\t\tthis.addData(e.line /*, this.layer*/ );\n\n\t\t\t\t\tthis.track_info = L.extend({}, this.track_info, { type: \"gpx\", name: this.layer.get_name() });\n\n\t\t\t\t\tthis._fireEvt(\"eledata_loaded\", { data: data, layer: this.layer, name: this.track_info.name, track_info: this.track_info }, true);\n\t\t\t\t}, this);\n\n\t\t\t\tif (this._map) {\n\t\t\t\t\tthis.layer.addTo(this._map);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(\"Undefined elevation map object\");\n\t\t\t\t}\n\t\t\t}.bind(this, data)\n\t\t);\n\t},\n\n\t/**\n\t * Wait for chart container visible before download data.\n\t */\n\tloadLazy: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\topts.lazy = false;\n\t\tlet ticking = false;\n\t\tlet scrollFn = L.bind(function(data) {\n\t\t\tif (!ticking) {\n\t\t\t\tL.Util.requestAnimFrame(function() {\n\t\t\t\t\tif (this._isVisible(this.placeholder)) {\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\n\t\t\t\t\t\tthis.loadData(data, opts);\n\t\t\t\t\t\tthis.once('eledata_loaded', function() {\n\t\t\t\t\t\t\tif (this.placeholder && this.placeholder.parentNode) {\n\t\t\t\t\t\t\t\tthis.placeholder.parentNode.removeChild(this.placeholder);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this)\n\t\t\t\t\t}\n\t\t\t\t\tticking = false;\n\t\t\t\t}, this);\n\t\t\t\tticking = true;\n\t\t\t}\n\t\t}, this, data);\n\t\twindow.addEventListener('scroll', scrollFn);\n\t\tif (this.placeholder) this.placeholder.addEventListener('mouseenter', scrollFn, { once: true });\n\t\tscrollFn();\n\t},\n\n\t/**\n\t * Create container DOM element and related event listeners.\n\t * Called on control.addTo(map).\n\t */\n\tonAdd: function(map) {\n\t\tthis._map = map;\n\n\t\tlet container = this._container = L.DomUtil.create(\"div\", \"elevation-control elevation\");\n\n\t\tif (!this.options.detached) {\n\t\t\tL.DomUtil.addClass(container, 'leaflet-control');\n\t\t}\n\n\t\tif (this.options.theme) {\n\t\t\tL.DomUtil.addClass(container, this.options.theme); // append theme to control\n\t\t}\n\n\t\tif (this.options.placeholder && !this._data) {\n\t\t\tthis.placeholder = L.DomUtil.create('img', 'elevation-placeholder');\n\t\t\tif (typeof this.options.placeholder === 'string') {\n\t\t\t\tthis.placeholder.src = this.options.placeholder;\n\t\t\t\tthis.placeholder.alt = '';\n\t\t\t} else {\n\t\t\t\tfor (let i in this.options.placeholder) { this.placeholder.setAttribute(i, this.options.placeholder[i]); }\n\t\t\t}\n\t\t\tcontainer.insertBefore(this.placeholder, container.firstChild);\n\t\t}\n\n\t\tL.Control.Elevation._d3LazyLoader = this._lazyLoadJS(\n\t\t\t'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\n\t\t\ttypeof d3 !== 'object',\n\t\t\tL.Control.Elevation._d3LazyLoader\n\t\t).then(\n\t\t\tfunction(map, container) {\n\t\t\t\tthis._initToggle(container);\n\t\t\t\tthis._initChart(container);\n\n\t\t\t\tthis._applyData();\n\n\t\t\t\tthis._map.on('zoom viewreset zoomanim', this._hidePositionMarker, this);\n\t\t\t\tthis._map.on('resize', this._resetView, this);\n\t\t\t\tthis._map.on('resize', this._resizeChart, this);\n\t\t\t\tthis._map.on('mousedown', this._resetDrag, this);\n\n\t\t\t\tthis._map.on('eledata_added', this._updateSummary, this);\n\n\t\t\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._resetDrag, this);\n\t\t\t\tL.DomEvent.on(this._map._container, 'touchstart', this._resetDrag, this);\n\n\t\t\t}.bind(this, map, container)\n\t\t);\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Clean up control code and related event listeners.\n\t * Called on control.remove().\n\t */\n\tonRemove: function(map) {\n\t\tthis._container = null;\n\t},\n\n\t/**\n\t * Redraws the chart control. Sometimes useful after screen resize.\n\t */\n\tredraw: function() {\n\t\tthis._resizeChart();\n\t},\n\n\t/**\n\t * Set default zoom level when \"followMarker\" is true.\n\t */\n\tsetZFollow: function(zoom) {\n\t\tthis._zFollow = zoom;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\tshow: function() {\n\t\tthis._container.style.display = \"block\";\n\t},\n\n\t/*\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\n\t */\n\t_addData: function(d) {\n\t\tlet geom = d && d.geometry;\n\t\tlet feat = d && d.type === \"FeatureCollection\";\n\t\tlet gpx = d && d._latlngs;\n\n\t\tif (geom) {\n\t\t\tswitch (geom.type) {\n\t\t\t\tcase 'LineString':\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'MultiLineString':\n\t\t\t\t\tgeom.coordinates.forEach(coords => this._addGeoJSONData(coords));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\n\t\t\t}\n\t\t}\n\n\t\tif (feat) {\n\t\t\td.features.forEach(feature => this._addData(feature));\n\t\t}\n\n\t\tif (gpx) {\n\t\t\tthis._addGPXdata(d._latlngs);\n\t\t}\n\t},\n\n\t/*\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\n\t */\n\t_addGeoJSONData: function(coords) {\n\t\tif (coords) {\n\t\t\tcoords.forEach(point => this._addPoint(point[1], point[0], point[2]));\n\t\t}\n\t},\n\n\t/*\n\t * Parsing function for GPX data and their elevation in z-coordinate\n\t */\n\t_addGPXdata: function(coords) {\n\t\tif (coords) {\n\t\t\tcoords.forEach(point => this._addPoint(point.lat, point.lng, point.meta.ele));\n\t\t}\n\t},\n\n\t/*\n\t * Parse and push a single (x, y, z) point to current elevation profile.\n\t */\n\t_addPoint: function(x, y, z) {\n\t\tif (this.options.reverseCoords) {\n\t\t\t[x, y] = [y, x];\n\t\t}\n\n\t\tlet data = this._data || [];\n\t\tlet eleMax = this._maxElevation || -Infinity;\n\t\tlet eleMin = this._minElevation || +Infinity;\n\t\tlet dist = this._distance || 0;\n\n\t\tlet curr = new L.LatLng(x, y);\n\t\tlet prev = data.length ? data[data.length - 1].latlng : curr;\n\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\n\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\n\n\t\t// check and fix missing elevation data on last added point\n\t\tif (!this.options.skipNullZCoords && data.length > 0) {\n\t\t\tlet prevZ = data[data.length - 1].z;\n\t\t\tif (isNaN(prevZ)) {\n\t\t\t\tlet lastZ = this._lastValidZ;\n\t\t\t\tlet currZ = z * this._heightFactor;\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\n\t\t\t\t} else if (!isNaN(lastZ)) {\n\t\t\t\t\tprevZ = lastZ;\n\t\t\t\t} else if (!isNaN(currZ)) {\n\t\t\t\t\tprevZ = currZ;\n\t\t\t\t}\n\t\t\t\tif (!isNaN(prevZ)) data[data.length - 1].z = prevZ;\n\t\t\t\telse data.splice(data.length - 1, 1);\n\t\t\t}\n\t\t}\n\n\t\tz = z * this._heightFactor;\n\n\t\t// skip point if it has not elevation\n\t\tif (!isNaN(z)) {\n\t\t\teleMax = eleMax < z ? z : eleMax;\n\t\t\teleMin = eleMin > z ? z : eleMin;\n\t\t\tthis._lastValidZ = z;\n\t\t}\n\n\t\tdata.push({\n\t\t\tdist: dist,\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tz: z,\n\t\t\tlatlng: curr\n\t\t});\n\n\t\tthis._data = data;\n\t\tthis._distance = dist;\n\t\tthis._maxElevation = eleMax;\n\t\tthis._minElevation = eleMin;\n\n\t\tthis._fireEvt(\"eledata_updated\", { index: data.length - 1 }, true);\n\t},\n\n\t/**\n\t * Generate \"svg\" chart container.\n\t */\n\t_appendChart: function(svg) {\n\t\tlet g = svg\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(\" + this.options.margins.left + \",\" + this.options.margins.top + \")\");\n\n\t\tthis._appendGrid(g);\n\t\tthis._appendAreaPath(g);\n\t\tthis._appendAxis(g);\n\t\tthis._appendFocusRect(g);\n\t\tthis._appendMouseFocusG(g);\n\t\tthis._appendLegend(g);\n\t},\n\n\t/**\n\t * Adds the control to the given \"detached\" div.\n\t */\n\t_appendElevationDiv: function(container) {\n\t\tlet eleDiv = document.querySelector(this.options.elevationDiv);\n\t\tif (!eleDiv) {\n\t\t\teleDiv = L.DomUtil.create('div', 'leaflet-control elevation elevation-div');\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + Math.random().toString(36).substr(2, 9);\n\t\t\teleDiv.id = this.options.elevationDiv.substr(1);\n\t\t\tcontainer.parentNode.insertBefore(eleDiv, container.nextSibling); // insert after end of container.\n\t\t}\n\t\tif (this.options.detached) {\n\t\t\tL.DomUtil.addClass(eleDiv, 'elevation-detached');\n\t\t\tL.DomUtil.removeClass(eleDiv, 'leaflet-control');\n\t\t}\n\t\tthis.eleDiv = eleDiv;\n\t\treturn this.eleDiv;\n\t},\n\n\t/**\n\t * Generate \"x-axis\".\n\t */\n\t_appendXaxis: function(axis) {\n\t\taxis\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"x axis\")\n\t\t\t.attr(\"transform\", \"translate(0,\" + this._height() + \")\")\n\t\t\t.call(\n\t\t\t\td3\n\t\t\t\t.axisBottom()\n\t\t\t\t.scale(this._x)\n\t\t\t\t.ticks(this.options.xTicks)\n\t\t\t)\n\t\t\t.append(\"text\")\n\t\t\t.attr(\"x\", this._width() + 6)\n\t\t\t.attr(\"y\", 30)\n\t\t\t.text(this._xLabel);\n\t},\n\n\t/**\n\t * Generate \"x-grid\".\n\t */\n\t_appendXGrid: function(grid) {\n\t\tgrid.append(\"g\")\n\t\t\t.attr(\"class\", \"x grid\")\n\t\t\t.attr(\"transform\", \"translate(0,\" + this._height() + \")\")\n\t\t\t.call(\n\t\t\t\td3\n\t\t\t\t.axisBottom()\n\t\t\t\t.scale(this._x)\n\t\t\t\t.ticks(this.options.xTicks)\n\t\t\t\t.tickSize(-this._height())\n\t\t\t\t.tickFormat(\"\")\n\t\t\t);\n\n\t},\n\n\t/**\n\t * Generate \"y-axis\".\n\t */\n\t_appendYaxis: function(axis) {\n\t\taxis\n\t\t\t.append(\"g\")\n\t\t\t.attr(\"class\", \"y axis\")\n\t\t\t.call(\n\t\t\t\td3\n\t\t\t\t.axisLeft()\n\t\t\t\t.scale(this._y)\n\t\t\t\t.ticks(this.options.yTicks)\n\t\t\t)\n\t\t\t.append(\"text\")\n\t\t\t.attr(\"x\", -30)\n\t\t\t.attr(\"y\", 3)\n\t\t\t.text(this._yLabel);\n\t},\n\n\t/**\n\t * Generate \"y-grid\".\n\t */\n\t_appendYGrid: function(grid) {\n\t\tgrid.append(\"g\")\n\t\t\t.attr(\"class\", \"y grid\")\n\t\t\t.call(\n\t\t\t\td3\n\t\t\t\t.axisLeft()\n\t\t\t\t.scale(this._y)\n\t\t\t\t.ticks(this.options.yTicks)\n\t\t\t\t.tickSize(-this._width())\n\t\t\t\t.tickFormat(\"\")\n\t\t\t);\n\t},\n\n\t/**\n\t * Generate \"path\".\n\t */\n\t_appendAreaPath: function(g) {\n\t\tthis._areapath = g.append(\"path\")\n\t\t\t.attr(\"class\", \"area\");\n\t},\n\n\t/**\n\t * Generate \"axis\".\n\t */\n\t_appendAxis: function(g) {\n\t\tthis._axis = g.append(\"g\")\n\t\t\t.attr(\"class\", \"axis\");\n\t\tthis._appendXaxis(this._axis);\n\t\tthis._appendYaxis(this._axis);\n\t},\n\n\t/**\n\t * Generate \"mouse-focus\" and \"drag-rect\".\n\t */\n\t_appendFocusRect: function(g) {\n\t\tlet focusRect = this._focusRect = g.append(\"rect\")\n\t\t\t.attr(\"width\", this._width())\n\t\t\t.attr(\"height\", this._height())\n\t\t\t.style(\"fill\", \"none\")\n\t\t\t.style(\"stroke\", \"none\")\n\t\t\t.style(\"pointer-events\", \"all\");\n\n\t\tif (L.Browser.mobile) {\n\t\t\tfocusRect\n\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\n\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\n\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\n\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\n\t\t\tL.DomEvent.on(this._container, 'touchend', this._dragEndHandler, this);\n\t\t}\n\n\t\tfocusRect\n\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\n\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\n\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\n\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\n\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\n\t\tL.DomEvent.on(this._container, 'mouseup', this._dragEndHandler, this);\n\t},\n\n\t/**\n\t * Generate \"grid\".\n\t */\n\t_appendGrid: function(g) {\n\t\tthis._grid = g.append(\"g\")\n\t\t\t.attr(\"class\", \"grid\");\n\t\tthis._appendXGrid(this._grid);\n\t\tthis._appendYGrid(this._grid);\n\t},\n\n\t/**\n\t * Generate \"mouse-focus\".\n\t */\n\t_appendMouseFocusG: function(g) {\n\t\tlet focusG = this._focusG = g.append(\"g\")\n\t\t\t.attr(\"class\", \"mouse-focus-group\");\n\n\t\tthis._mousefocus = focusG.append('svg:line')\n\t\t\t.attr('class', 'mouse-focus-line')\n\t\t\t.attr('x2', '0')\n\t\t\t.attr('y2', '0')\n\t\t\t.attr('x1', '0')\n\t\t\t.attr('y1', '0');\n\n\t\tthis._focuslabelrect = focusG.append(\"rect\")\n\t\t\t.attr('class', 'mouse-focus-label')\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"width\", 0)\n\t\t\t.attr(\"height\", 0)\n\t\t\t.attr(\"rx\", 3)\n\t\t\t.attr(\"ry\", 3);\n\n\t\tthis._focuslabeltext = focusG.append(\"svg:text\")\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\");\n\t\tthis._focuslabelY = this._focuslabeltext.append(\"svg:tspan\")\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\n\t\t\t.attr(\"dy\", \"1em\");\n\t\tthis._focuslabelX = this._focuslabeltext.append(\"svg:tspan\")\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\n\t\t\t.attr(\"dy\", \"2em\");\n\t},\n\n\t/**\n\t * Generate \"legend\".\n\t */\n\t_appendLegend: function(g) {\n\t\tif (!this.options.legend) return;\n\n\t\tlet legend = this._legend = g.append('g')\n\t\t\t.attr(\"class\", \"legend\");\n\n\t\tlet altitude = this._altitudeLegend = this._legend.append('g')\n\t\t\t.attr(\"class\", \"legend-altitude\");\n\n\t\taltitude.append(\"rect\")\n\t\t\t.attr(\"class\", \"area\")\n\t\t\t.attr(\"x\", (this._width() / 2) - 50)\n\t\t\t.attr(\"y\", this._height() + this.options.margins.bottom - 17)\n\t\t\t.attr(\"width\", 50)\n\t\t\t.attr(\"height\", 5)\n\t\t\t.attr(\"opacity\", 0.75);\n\n\t\taltitude.append('text')\n\t\t\t.text(L._('Altitude'))\n\t\t\t.attr(\"x\", (this._width() / 2) + 5)\n\t\t\t.attr(\"font-size\", 10)\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr('y', this._height() + this.options.margins.bottom - 11);\n\n\t\t// autotoggle chart data on single click\n\t\tlegend.on('click', function() {\n\t\t\tif (this._chartEnabled) {\n\t\t\t\tthis._clearChart();\n\t\t\t\tthis._clearPath();\n\t\t\t\tthis._chartEnabled = false;\n\t\t\t} else {\n\t\t\t\tthis._resizeChart();\n\t\t\t\tfor (let id in this._layers) {\n\t\t\t\t\tif (this._layers[id]._path) {\n\t\t\t\t\t\tL.DomUtil.addClass(this._layers[id]._path, this.options.polyline.className + ' ' + this.options.theme);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._chartEnabled = true;\n\t\t\t}\n\t\t}.bind(this));\n\n\t},\n\n\t/**\n\t * Generate \"svg:line\".\n\t */\n\t_appendPositionMarker: function(pane) {\n\t\tlet theme = this.options.theme;\n\t\tlet heightG = pane.select(\"g\").attr(\"class\", \"height-focus-group\");\n\n\t\tthis._mouseHeightFocus = heightG.append('svg:line')\n\t\t\t.attr(\"class\", theme + \" height-focus line\")\n\t\t\t.attr(\"x2\", 0)\n\t\t\t.attr(\"y2\", 0)\n\t\t\t.attr(\"x1\", 0)\n\t\t\t.attr(\"y1\", 0);\n\n\t\tthis._pointG = heightG.append(\"svg:circle\")\n\t\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\n\t\t\t.attr(\"r\", 6)\n\t\t\t.attr(\"cx\", 0)\n\t\t\t.attr(\"cy\", 0);\n\n\t\tthis._mouseHeightFocusLabel = heightG.append(\"svg:text\")\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\n\t\t\t.style(\"pointer-events\", \"none\");\n\n\t\tthis._mouseHeightFocusLabelY = this._mouseHeightFocusLabel.append(\"svg:tspan\")\n\t\t\t.attr(\"class\", \"height-focus-y\");\n\t},\n\n\t/**\n\t * Calculates [x, y] domain and then update chart.\n\t */\n\t_applyData: function() {\n\t\tif (!this._data) return;\n\n\t\tlet xdomain = d3.extent(this._data, d => d.dist);\n\t\tlet ydomain = d3.extent(this._data, d => d.z);\n\t\tlet opts = this.options;\n\n\t\tif (opts.yAxisMin !== undefined && (opts.yAxisMin < ydomain[0] || opts.forceAxisBounds)) {\n\t\t\tydomain[0] = opts.yAxisMin;\n\t\t}\n\t\tif (opts.yAxisMax !== undefined && (opts.yAxisMax > ydomain[1] || opts.forceAxisBounds)) {\n\t\t\tydomain[1] = opts.yAxisMax;\n\t\t}\n\n\t\tthis._x.domain(xdomain);\n\t\tthis._y.domain(ydomain);\n\t\tthis._areapath.datum(this._data)\n\t\t\t.attr(\"d\", this._area);\n\t\tthis._updateAxis();\n\n\t\tthis._fullExtent = this._calculateFullExtent(this._data);\n\t},\n\n\t/*\n\t * Calculates the full extent of the data array\n\t */\n\t_calculateFullExtent: function(data) {\n\t\tif (!data || data.length < 1) {\n\t\t\tthrow new Error(\"no data in parameters\");\n\t\t}\n\n\t\tlet ext = new L.latLngBounds(data[0].latlng, data[0].latlng);\n\n\t\tdata.forEach(item => ext.extend(item.latlng));\n\n\t\treturn ext;\n\t},\n\n\t/*\n\t * Reset chart.\n\t */\n\t_clearChart: function() {\n\t\tthis._resetDrag();\n\t\tif (this._areapath) {\n\t\t\t// workaround for 'Error: Problem parsing d=\"\"' in Webkit when empty data\n\t\t\t// https://groups.google.com/d/msg/d3-js/7rFxpXKXFhI/HzIO_NPeDuMJ\n\t\t\t//this._areapath.datum(this._data).attr(\"d\", this._area);\n\t\t\tthis._areapath.attr(\"d\", \"M0 0\");\n\n\t\t\tthis._x.domain([0, 1]);\n\t\t\tthis._y.domain([0, 1]);\n\t\t\tthis._updateAxis();\n\t\t}\n\t\tif (this._altitudeLegend) {\n\t\t\tthis._altitudeLegend.select('text').style(\"text-decoration-line\", \"line-through\");\n\t\t}\n\t},\n\n\t/*\n\t * Reset data.\n\t */\n\t_clearData: function() {\n\t\tthis._data = null;\n\t\tthis._distance = null;\n\t\tthis._maxElevation = null;\n\t\tthis._minElevation = null;\n\t\tthis.track_info = null;\n\t\tthis._layers = null;\n\t\t// if (this.layer) {\n\t\t// \tthis.layer.removeFrom(this._map);\n\t\t// }\n\t},\n\n\t/*\n\t * Reset path.\n\t */\n\t_clearPath: function() {\n\t\tthis._hidePositionMarker();\n\t\tfor (let id in this._layers) {\n\t\t\tif (this._layers[id]._path) {\n\t\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.polyline.className);\n\t\t\t\tL.DomUtil.removeClass(this._layers[id]._path, this.options.theme);\n\t\t\t}\n\t\t}\n\t},\n\n\t/*\n\t * Collapse current chart control.\n\t */\n\t_collapse: function() {\n\t\tif (this._container) {\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-expanded');\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-collapsed');\n\t\t}\n\t},\n\n\t/**\n\t * Recursive deep merge objects.\n\t * Alternative to L.Util.setOptions(this, options).\n\t */\n\t_deepMerge: function(target, ...sources) {\n\t\tif (!sources.length) return target;\n\t\tconst source = sources.shift();\n\t\tif (this._isObject(target) && this._isObject(source)) {\n\t\t\tfor (const key in source) {\n\t\t\t\tif (this._isObject(source[key])) {\n\t\t\t\t\tif (!target[key]) Object.assign(target, {\n\t\t\t\t\t\t[key]: {}\n\t\t\t\t\t});\n\t\t\t\t\tthis._deepMerge(target[key], source[key]);\n\t\t\t\t} else {\n\t\t\t\t\tObject.assign(target, {\n\t\t\t\t\t\t[key]: source[key]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this._deepMerge(target, ...sources);\n\t},\n\n\t/*\n\t * Handle drag operations.\n\t */\n\t_dragHandler: function() {\n\t\t//we don't want map events to occur here\n\t\td3.event.preventDefault();\n\t\td3.event.stopPropagation();\n\n\t\tthis._gotDragged = true;\n\t\tthis._drawDragRectangle();\n\t},\n\n\t/*\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\n\t */\n\t_dragEndHandler: function() {\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\n\t\t\tthis._dragStartCoords = null;\n\t\t\tthis._gotDragged = false;\n\t\t\tif (this._draggingEnabled) this._resetDrag();\n\t\t\treturn;\n\t\t}\n\n\t\tlet item1 = this._findItemForX(this._dragStartCoords[0]);\n\t\tlet item2 = this._findItemForX(this._dragCurrentCoords[0]);\n\n\t\tif (item1 == item2) return;\n\n\t\tthis._hidePositionMarker();\n\n\t\tthis._fitSection(item1, item2);\n\n\t\tthis._dragStartCoords = null;\n\t\tthis._gotDragged = false;\n\n\t\tthis._fireEvt(\"elechart_dragged\", { data: { dragstart: this._data[item1], dragend: this._data[item2] } }, true);\n\t},\n\n\t/*\n\t * Handles start of drag operations.\n\t */\n\t_dragStartHandler: function() {\n\t\td3.event.preventDefault();\n\t\td3.event.stopPropagation();\n\n\t\tthis._gotDragged = false;\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\n\t},\n\n\t/*\n\t * Draws the currently dragged rectangle over the chart.\n\t */\n\t_drawDragRectangle: function() {\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet dragEndCoords = this._dragCurrentCoords = d3.mouse(this._focusRect.node());\n\n\t\tlet x1 = Math.min(this._dragStartCoords[0], dragEndCoords[0]);\n\t\tlet x2 = Math.max(this._dragStartCoords[0], dragEndCoords[0]);\n\n\t\tif (!this._dragRectangle && !this._dragRectangleG) {\n\t\t\tlet g = d3.select(this._container).select(\"svg\").select(\"g\");\n\n\t\t\tthis._dragRectangleG = g.insert(\"g\", \".mouse-focus-group\");\n\n\t\t\tthis._dragRectangle = this._dragRectangleG.append(\"rect\")\n\t\t\t\t.attr(\"width\", x2 - x1)\n\t\t\t\t.attr(\"height\", this._height())\n\t\t\t\t.attr(\"x\", x1)\n\t\t\t\t.attr('class', 'mouse-drag')\n\t\t\t\t.style(\"pointer-events\", \"none\");\n\t\t} else {\n\t\t\tthis._dragRectangle.attr(\"width\", x2 - x1)\n\t\t\t\t.attr(\"x\", x1);\n\t\t}\n\t},\n\n\t/*\n\t * Expand current chart control.\n\t */\n\t_expand: function() {\n\t\tif (this._container) {\n\t\t\tL.DomUtil.removeClass(this._container, 'elevation-collapsed');\n\t\t\tL.DomUtil.addClass(this._container, 'elevation-expanded');\n\t\t}\n\t},\n\n\t/*\n\t * Finds an item with the smallest delta in distance to the given latlng coords\n\t */\n\t_findItemForLatLng: function(latlng) {\n\t\tlet result = null;\n\t\tlet d = Infinity;\n\t\tthis._data.forEach(item => {\n\t\t\tlet dist = latlng.distanceTo(item.latlng);\n\t\t\tif (dist < d) {\n\t\t\t\td = dist;\n\t\t\t\tresult = item;\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/*\n\t * Finds a data entry for a given x-coordinate of the diagram\n\t */\n\t_findItemForX: function(x) {\n\t\tlet data = this._data ? this._data : [0, 1];\n\t\tlet bisect = d3.bisector(d => d.dist).left;\n\t\tlet xinvert = this._x.invert(x);\n\t\treturn bisect(data, xinvert);\n\t},\n\n\t/**\n\t * Fires an event of the specified type.\n\t */\n\t_fireEvt: function(type, data, propagate) {\n\t\tif (this.fire) {\n\t\t\tthis.fire(type, data, propagate);\n\t\t}\n\t\tif (this._map) {\n\t\t\tthis._map.fire(type, data, propagate);\n\t\t}\n\t},\n\n\t/**\n\t * Make the map fit the route section between given indexes.\n\t */\n\t_fitSection: function(index1, index2) {\n\t\tlet start = Math.min(index1, index2);\n\t\tlet end = Math.max(index1, index2);\n\t\tlet ext = this._calculateFullExtent(this._data.slice(start, end));\n\t\tthis.fitBounds(ext);\n\t},\n\n\t/*\n\t * Fromatting funciton using the given decimals and seperator\n\t */\n\t_formatter: function(num, dec, sep) {\n\t\tlet res = L.Util.formatNum(num, dec).toString();\n\t\tlet numbers = res.split(\".\");\n\t\tif (numbers[1]) {\n\t\t\tfor (let d = dec - numbers[1].length; d > 0; d--) {\n\t\t\t\tnumbers[1] += \"0\";\n\t\t\t}\n\t\t\tres = numbers.join(sep || \".\");\n\t\t}\n\t\treturn res;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\n\t},\n\n\t/*\n\t * Hides the position/height indicator marker drawn onto the map\n\t */\n\t_hidePositionMarker: function() {\n\t\tif (!this.options.autohideMarker) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._selectedItem = null;\n\n\t\tif (this._marker) {\n\t\t\tif (this._map) this._map.removeLayer(this._marker);\n\t\t\tthis._marker = null;\n\t\t}\n\t\tif (this._mouseHeightFocus) {\n\t\t\tthis._mouseHeightFocus.style(\"visibility\", \"hidden\");\n\t\t\tthis._mouseHeightFocusLabel.style(\"visibility\", \"hidden\");\n\t\t}\n\t\tif (this._pointG) {\n\t\t\tthis._pointG.style(\"visibility\", \"hidden\");\n\t\t}\n\t\tif (this._focusG) {\n\t\t\tthis._focusG.style(\"visibility\", \"hidden\");\n\t\t}\n\t},\n\n\t/**\n\t * Generate \"svg\" chart DOM element.\n\t */\n\t_initChart: function() {\n\t\tlet opts = this.options;\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\n\t\topts.hoverNumber.formatter = opts.hoverNumber.formatter || this._formatter;\n\n\t\tif (opts.responsive) {\n\t\t\tif (opts.detached) {\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\n\t\t\t} else {\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\n\t\t\t\tlet containerWidth = this._map._container.clientWidth;\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\n\t\t\t}\n\t\t}\n\n\t\tlet x = this._x = d3.scaleLinear().range([0, this._width()]);\n\t\tlet y = this._y = d3.scaleLinear().range([this._height(), 0]);\n\n\t\tlet interpolation = typeof opts.interpolation === 'function' ? opts.interpolation : d3[opts.interpolation];\n\n\t\tlet area = this._area = d3.area().curve(interpolation)\n\t\t\t.x(d => (d.xDiagCoord = x(d.dist)))\n\t\t\t.y0(this._height())\n\t\t\t.y1(d => y(d.z));\n\t\tlet line = this._line = d3.line()\n\t\t\t.x(d => d3.mouse(svg.select(\"g\"))[0])\n\t\t\t.y(d => this._height());\n\n\t\tlet container = d3.select(this._container);\n\n\t\tlet svg = container.append(\"svg\")\n\t\t\t.attr(\"class\", \"background\")\n\t\t\t.attr(\"width\", opts.width)\n\t\t\t.attr(\"height\", opts.height);\n\n\t\tlet summary = this.summaryDiv = container.append(\"div\")\n\t\t\t.attr(\"class\", \"elevation-summary \" + (this.options.summary ? this.options.summary + \"-summary\" : '')).node();\n\n\t\tthis._appendChart(svg);\n\t\tthis._updateSummary();\n\n\t\tthis._fireEvt(\"elechart_init\", null, true);\n\t},\n\n\t/**\n\t * Inspired by L.Control.Layers\n\t */\n\t_initToggle: function(container) {\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\n\t\tcontainer.setAttribute('aria-haspopup', true);\n\n\t\tif (!this.options.detached) {\n\t\t\tL.DomEvent\n\t\t\t\t.disableClickPropagation(container);\n\t\t\t//.disableScrollPropagation(container);\n\t\t}\n\n\t\tif (L.Browser.mobile) {\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\n\t\t}\n\n\t\tL.DomEvent.on(container, 'mousewheel', this._mousewheelHandler, this);\n\n\t\tif (!this.options.detached) {\n\t\t\tlet iconCssClass = \"elevation-toggle \" + this.options.controlButton.iconCssClass + (this.options.autohide ? \"\" : \" close-button\");\n\t\t\tlet link = this._button = L.DomUtil.create('a', iconCssClass, container);\n\t\t\tlink.href = '#';\n\t\t\tlink.title = this.options.controlButton.title;\n\n\t\t\tif (this.options.collapsed) {\n\t\t\t\tthis._collapse();\n\t\t\t\tif (this.options.autohide) {\n\t\t\t\t\tL.DomEvent\n\t\t\t\t\t\t.on(container, 'mouseover', this._expand, this)\n\t\t\t\t\t\t.on(container, 'mouseout', this._collapse, this);\n\t\t\t\t} else {\n\t\t\t\t\tL.DomEvent\n\t\t\t\t\t\t.on(link, 'click', L.DomEvent.stop)\n\t\t\t\t\t\t.on(link, 'click', this._toggle, this);\n\t\t\t\t}\n\n\t\t\t\tL.DomEvent.on(link, 'focus', this._toggle, this);\n\n\t\t\t\tthis._map.on('click', this._collapse, this);\n\t\t\t\t// TODO: keyboard accessibility\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO: handle autohide when detached=true\n\t\t}\n\t},\n\n\t/**\n\t * Check object type.\n\t */\n\t_isObject: function(item) {\n\t\treturn (item && typeof item === 'object' && !Array.isArray(item));\n\t},\n\n\t/**\n\t * Check JSON object type.\n\t */\n\t_isJSONDoc: function(doc, lazy) {\n\t\tlazy = typeof lazy === \"undefined\" ? true : lazy;\n\t\tif (typeof doc === \"string\" && lazy) {\n\t\t\tdoc = doc.trim();\n\t\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tJSON.parse(doc.toString());\n\t\t\t} catch (e) {\n\t\t\t\tif (typeof doc === \"object\" && lazy) return true;\n\t\t\t\tconsole.warn(e);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t},\n\n\t/**\n\t * Check XML object type.\n\t */\n\t_isXMLDoc: function(doc, lazy) {\n\t\tlazy = typeof lazy === \"undefined\" ? true : lazy;\n\t\tif (typeof doc === \"string\" && lazy) {\n\t\t\tdoc = doc.trim();\n\t\t\treturn doc.indexOf(\"<\") == 0;\n\t\t} else {\n\t\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\n\t\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n\t\t}\n\t},\n\n\t/**\n\t * Check DOM element visibility.\n\t */\n\t_isDomVisible: function(elem) {\n\t\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\n\t},\n\n\t/**\n\t * Check DOM element viewport visibility.\n\t */\n\t_isVisible: function(elem) {\n\t\tif (!elem) return false;\n\n\t\tlet styles = window.getComputedStyle(elem);\n\n\t\tfunction isVisibleByStyles(elem, styles) {\n\t\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\n\t\t}\n\n\t\tfunction isAboveOtherElements(elem, styles) {\n\t\t\tlet boundingRect = elem.getBoundingClientRect();\n\t\t\tlet left = boundingRect.left + 1;\n\t\t\tlet right = boundingRect.right - 1;\n\t\t\tlet top = boundingRect.top + 1;\n\t\t\tlet bottom = boundingRect.bottom - 1;\n\t\t\tlet above = true;\n\n\t\t\tlet pointerEvents = elem.style.pointerEvents;\n\n\t\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\n\n\t\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\n\t\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\n\n\t\t\t// Only for completely visible elements\n\t\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\n\t\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\n\n\t\t\telem.style.pointerEvents = pointerEvents;\n\n\t\t\treturn above;\n\t\t}\n\n\t\tif (!isVisibleByStyles(elem, styles)) return false;\n\t\tif (!isAboveOtherElements(elem, styles)) return false;\n\t\treturn true;\n\t},\n\n\t/**\n\t * Async JS script download.\n\t */\n\t_lazyLoadJS: function(url, skip, loader) {\n\t\tif (skip === false || !this.options.lazyLoadJS) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tif (loader instanceof Promise) {\n\t\t\treturn loader;\n\t\t}\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet tag = document.createElement(\"script\");\n\t\t\ttag.addEventListener('load', resolve, { once: true });\n\t\t\ttag.src = url;\n\t\t\tdocument.head.appendChild(tag);\n\t\t});\n\t},\n\n\t/*\n\t * Handles the moueseenter over the chart.\n\t */\n\t_mouseenterHandler: function() {\n\t\tthis._fireEvt(\"elechart_enter\", null, true);\n\t},\n\n\t/*\n\t * Handles the moueseover the chart and displays distance and altitude level.\n\t */\n\t_mousemoveHandler: function(d, i, ctx) {\n\t\tif (!this._data || this._data.length === 0 || !this._chartEnabled) {\n\t\t\treturn;\n\t\t}\n\t\tlet coords = d3.mouse(this._focusRect.node());\n\t\tlet xCoord = coords[0];\n\t\tlet item = this._data[this._findItemForX(xCoord)];\n\n\t\tthis._hidePositionMarker();\n\t\tthis._showDiagramIndicator(item, xCoord);\n\t\tthis._showPositionMarker(item);\n\t\tthis._setMapView(item);\n\n\t\tif (this._map && this._map._container) {\n\t\t\tL.DomUtil.addClass(this._map._container, 'elechart-hover');\n\t\t}\n\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord }, true);\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord }, true);\n\t},\n\n\t/*\n\t * Handles mouseover events of the data layers on the map.\n\t */\n\t_mousemoveLayerHandler: function(e) {\n\t\tif (!this._data || this._data.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet latlng = e.latlng;\n\t\tlet item = this._findItemForLatLng(latlng);\n\t\tif (item) {\n\t\t\tlet xCoord = item.xDiagCoord;\n\n\t\t\tthis._hidePositionMarker();\n\t\t\tthis._showDiagramIndicator(item, xCoord);\n\t\t\tthis._showPositionMarker(item);\n\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord }, true);\n\t\t}\n\t},\n\n\t/*\n\t * Handles the moueseout over the chart.\n\t */\n\t_mouseoutHandler: function() {\n\t\tif (!this.options.detached) {\n\t\t\tthis._hidePositionMarker();\n\t\t}\n\n\t\tif (this._map && this._map._container) {\n\t\t\tL.DomUtil.removeClass(this._map._container, 'elechart-hover');\n\t\t}\n\n\t\tthis._fireEvt(\"elechart_leave\", null, true);\n\t},\n\n\t/*\n\t * Handles the mouesewheel over the chart.\n\t */\n\t_mousewheelHandler: function(e) {\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\n\t\tlet ll = this._selectedItem ? this._selectedItem.latlng : this._map.getCenter();\n\t\tlet z = e.deltaY > 0 ? this._map.getZoom() - 1 : this._map.getZoom() + 1;\n\t\tthis._resetDrag();\n\t\tthis._map.flyTo(ll, z);\n\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag: function() {\n\t\tif (this._dragRectangleG) {\n\t\t\tthis._dragRectangleG.remove();\n\t\t\tthis._dragRectangleG = null;\n\t\t\tthis._dragRectangle = null;\n\t\t\tthis._hidePositionMarker();\n\t\t}\n\t},\n\n\t/**\n\t * Resets drag, marker and bounds.\n\t */\n\t_resetView: function() {\n\t\tif (this._map && this._map._isFullscreen) return;\n\t\tthis._resetDrag();\n\t\tthis._hidePositionMarker();\n\t\tthis.fitBounds(this._fullExtent);\n\t},\n\n\t/**\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\n\t */\n\t_resizeChart: function() {\n\t\t// prevent displaying chart if hidden\n\t\tif (this._container.style.display == \"none\") return;\n\n\t\tif (this.options.responsive) {\n\t\t\tif (this.options.detached) {\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\n\n\t\t\t\tif (newWidth <= 0) return;\n\n\t\t\t\tthis.options.width = newWidth;\n\t\t\t\tthis.eleDiv.innerHTML = \"\";\n\t\t\t\tthis.eleDiv.appendChild(this.onAdd(this._map));\n\t\t\t} else {\n\t\t\t\tthis._map.removeControl(this._container);\n\t\t\t\tthis.addTo(this._map);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Generate GPX / GeoJSON download event.\n\t */\n\t_saveFile: function(fileUrl) {\n\t\tlet d = document,\n\t\t\ta = d.createElement('a'),\n\t\t\tb = d.body;\n\t\ta.href = fileUrl;\n\t\ta.target = '_new';\n\t\ta.download = \"\"; // fileName\n\t\ta.style.display = 'none';\n\t\tb.appendChild(a);\n\t\ta.click();\n\t\tb.removeChild(a);\n\t},\n\n\t/**\n\t * Display distance and altitude level (\"focus-rect\").\n\t */\n\t_showDiagramIndicator: function(item, xCoordinate) {\n\t\tif (!this._chartEnabled) return;\n\n\t\tthis._focusG.style(\"visibility\", \"visible\");\n\n\t\tthis._mousefocus.attr('x1', xCoordinate)\n\t\t\t.attr('y1', 0)\n\t\t\t.attr('x2', xCoordinate)\n\t\t\t.attr('y2', this._height())\n\t\t\t.classed('hidden', false);\n\n\t\tlet hoverNumber = this.options.hoverNumber;\n\t\tlet yCoordinate = this._y(item.z);\n\n\t\tthis._focuslabelX.text(hoverNumber.formatter(item.dist, hoverNumber.decimalsX) + \" \" + this._xLabel);\n\t\tthis._focuslabelY.text(hoverNumber.formatter(item.z, hoverNumber.decimalsY) + \" \" + this._yLabel);\n\n\t\tlet focuslabeltext = this._focuslabeltext.node();\n\t\tlet bbox = focuslabeltext.getBBox();\n\t\tlet xAlign = xCoordinate + (xCoordinate < this._width() / 2 ? 10 : -bbox.width - 10);\n\t\tlet yAlign = Math.max(yCoordinate - bbox.height, L.Browser.webkit ? 0 : -Infinity);\n\n\t\tthis._focuslabeltext\n\t\t\t//.attr(\"x\", xCoordinate)\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr(\"y\", yAlign);\n\n\t\tthis._focuslabeltext.selectAll('tspan').each(function(d, i) {\n\t\t\td3.select(this).attr(\"x\", xAlign);\n\t\t});\n\n\t\tthis._focuslabelrect\n\t\t\t.attr(\"x\", xAlign - 5)\n\t\t\t.attr(\"y\", yAlign - 5)\n\t\t\t.attr(\"width\", bbox.width + 10)\n\t\t\t.attr(\"height\", bbox.height + 10);\n\n\t},\n\n\t/**\n\t * Collapse or Expand current chart control.\n\t */\n\t_toggle: function() {\n\t\tif (L.DomUtil.hasClass(this._container, \"elevation-expanded\"))\n\t\t\tthis._collapse();\n\t\telse\n\t\t\tthis._expand();\n\t},\n\n\t/**\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\n\t */\n\t_setMapView: function(item) {\n\t\tif (!this.options.followMarker || !this._map) return;\n\t\tlet zoom = this._map.getZoom();\n\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\n\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\n\t},\n\n\t/*\n\t * Shows the position/height indicator marker drawn onto the map\n\t */\n\t_showPositionMarker: function(item) {\n\t\tthis._selectedItem = item;\n\n\t\tif (this._map && !this._map.getPane('elevationPane')) {\n\t\t\tthis._map.createPane('elevationPane');\n\t\t\tthis._map.getPane('elevationPane').style.zIndex = 625; // This pane is above markers but below popups.\n\t\t\tthis._map.getPane('elevationPane').style.pointerEvents = 'none';\n\t\t}\n\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\tthis._updatePositionMarker(item);\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\tthis._updateLeafletMarker(item);\n\t\t}\n\t},\n\n\t/**\n\t * Update chart axis.\n\t */\n\t_updateAxis: function() {\n\t\tthis._grid.selectAll(\"g\").remove();\n\t\tthis._axis.selectAll(\"g\").remove();\n\t\tthis._appendXGrid(this._grid);\n\t\tthis._appendYGrid(this._grid);\n\t\tthis._appendXaxis(this._axis);\n\t\tthis._appendYaxis(this._axis);\n\t},\n\n\t/**\n\t * Update distance and altitude level (\"leaflet-marker\").\n\t */\n\t_updateHeightIndicator: function(item) {\n\t\tlet opts = this.options;\n\n\t\tlet numY = opts.hoverNumber.formatter(item.z, opts.hoverNumber.decimalsY);\n\t\tlet numX = opts.hoverNumber.formatter(item.dist, opts.hoverNumber.decimalsX);\n\n\t\tlet normalizedAlt = this._height() / this._maxElevation * item.z;\n\t\tlet normalizedY = item.y - normalizedAlt;\n\n\t\tthis._mouseHeightFocus\n\t\t\t.attr(\"x1\", item.x)\n\t\t\t.attr(\"x2\", item.x)\n\t\t\t.attr(\"y1\", item.y)\n\t\t\t.attr(\"y2\", normalizedY)\n\t\t\t.style(\"visibility\", \"visible\");\n\n\t\tthis._mouseHeightFocusLabel\n\t\t\t.attr(\"x\", item.x + 5)\n\t\t\t.attr(\"y\", normalizedY)\n\t\t\t.style(\"visibility\", \"visible\");\n\n\t\tthis._mouseHeightFocusLabel.selectAll('tspan').each(function(d, i) {\n\t\t\td3.select(this).attr(\"x\", item.x + 5);\n\t\t});\n\n\t\tthis._mouseHeightFocusLabelY\n\t\t\t.text(numY + \" \" + this._yLabel);\n\t},\n\n\t/**\n\t * Update position marker (\"leaflet-marker\").\n\t */\n\t_updateLeafletMarker: function(item) {\n\t\tlet ll = item.latlng;\n\n\t\tif (!this._marker) {\n\t\t\tthis._marker = new L.Marker(ll, {\n\t\t\t\ticon: this.options.markerIcon,\n\t\t\t\tzIndexOffset: 1000000,\n\t\t\t});\n\t\t\tthis._marker.addTo(this._map, {\n\t\t\t\tpane: 'elevationPane',\n\t\t\t});\n\t\t} else {\n\t\t\tthis._marker.setLatLng(ll);\n\t\t}\n\t},\n\n\t/**\n\t * Update focus point (\"leaflet-marker\").\n\t */\n\t_updatePointG: function(item) {\n\t\tthis._pointG\n\t\t\t.attr(\"transform\", \"translate(\" + item.x + \",\" + item.y + \")\")\n\t\t\t.style(\"visibility\", \"visible\");\n\t},\n\n\t/**\n\t * Update position marker (\"leaflet-marker\").\n\t */\n\t_updatePositionMarker: function(item) {\n\t\tlet point = this._map.latLngToLayerPoint(item.latlng);\n\t\tlet layerpoint = {\n\t\t\tdist: item.dist,\n\t\t\tx: point.x,\n\t\t\ty: point.y,\n\t\t\tz: item.z,\n\t\t};\n\n\t\tif (!this._mouseHeightFocus) {\n\t\t\tL.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\n\t\t\tlet layerpane = d3.select(this._map.getContainer()).select(\".leaflet-elevation-pane svg\");\n\t\t\tthis._appendPositionMarker(layerpane);\n\t\t}\n\n\t\tthis._updatePointG(layerpoint);\n\t\tthis._updateHeightIndicator(layerpoint);\n\t},\n\n\t/**\n\t * Update chart summary.\n\t */\n\t_updateSummary: function() {\n\t\tthis.summaryDiv.innerHTML = '';\n\t\tthis.track_info = this.track_info || {};\n\t\tthis.track_info.distance = this._distance || 0;\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\n\n\t\tif (this.options.summary) {\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"totlen\"><span class=\"summarylabel\">' + L._(\"Total Length: \") + '</span><span class=\"summaryvalue\">' + this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel + '</span></span>\\\n\t\t\t<span class=\"maxele\"><span class=\"summarylabel\">' + L._(\"Max Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>\\\n\t\t\t<span class=\"minele\"><span class=\"summarylabel\">' + L._(\"Min Elevation: \") + '</span><span class=\"summaryvalue\">' + this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel + '</span></span>';\n\t\t}\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\n\t\t\tthis.summaryDiv.querySelector('.download a').onclick = function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tlet evt = { confirm: this._saveFile.bind(this, this._downloadURL) };\n\t\t\t\tlet type = this.options.downloadLink;\n\t\t\t\tif (type == 'modal') {\n\t\t\t\t\tif (typeof CustomEvent === \"function\") document.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: evt }));\n\t\t\t\t\tthis._fireEvt('eletrack_download', evt);\n\t\t\t\t} else if (type == 'link' || type === true) {\n\t\t\t\t\tevt.confirm();\n\t\t\t\t}\n\t\t\t}.bind(this);\n\t\t}\n\t\tthis._fireEvt(\"elechart_summary\");\n\t},\n\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\n\t},\n\n});\n\nL.control.elevation = function(options) {\n\treturn new L.Control.Elevation(options);\n};"],"names":["factory","window","define","amd","exports","module","require","L","locales","locale","registerLocale","code","Util","extend","setLocale","i18n","_","string","data","template","err","Control","Elevation","includes","Evented","prototype","Mixin","Events","options","autohide","Browser","mobile","autohideMarker","collapsed","controlButton","iconCssClass","title","detached","distanceFactor","dragging","downloadLink","elevationDiv","followMarker","forceAxisBounds","gpxOptions","async","marker_options","startIconUrl","endIconUrl","shadowUrl","wptIcons","divIcon","className","html","iconSize","iconAnchor","height","heightFactor","hoverNumber","decimalsX","decimalsY","formatter","undefined","imperial","interpolation","lazyLoadJS","legend","loadData","defer","lazy","marker","markerIcon","placeholder","position","polyline","color","opacity","weight","lineCap","reverseCoords","skipNullZCoords","theme","margins","top","right","bottom","left","responsive","summary","width","xLabel","xTicks","yAxisMax","yAxisMin","yLabel","yTicks","zFollow","__mileFactor","__footFactor","addData","d","layer","_d3LazyLoader","this","_lazyLoadJS","d3","then","_addData","_container","_applyData","on","_path","DomUtil","addClass","_mousemoveLayerHandler","_mouseoutHandler","track_info","distance","_distance","elevation_max","_maxElevation","elevation_min","_minElevation","_layers","stamp","_fireEvt","bind","addTo","map","_appendElevationDiv","appendChild","onAdd","call","clear","_clearPath","_clearChart","_clearData","disableDragging","_draggingEnabled","_resetDrag","enableDragging","fitBounds","bounds","_fullExtent","_map","getZFollow","_zFollow","hide","style","display","initialize","_deepMerge","_distanceFactor","_heightFactor","_xLabel","_yLabel","_chartEnabled","_setMapView","throttle","e","point","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","load","opts","loadChart","loadDefer","loadLazy","_isXMLDoc","loadGPX","_isJSONDoc","loadGeoJSON","loadFile","document","readyState","addEventListener","once","url","_downloadURL","xhr","XMLHttpRequest","responseType","open","onload","status","response","send","console","warn","JSON","parse","geojson","geoJson","feature","pointToLayer","latlng","icon","desc","properties","name","bindPopup","length","openPopup","fire","point_type","element","onEachFeature","geometry","type","getBounds","_gpxLazyLoader","GPX","polyline_options","gpx","target","line","get_name","ticking","scrollFn","requestAnimFrame","_isVisible","removeEventListener","parentNode","removeChild","container","create","_data","src","alt","i","setAttribute","insertBefore","firstChild","_initToggle","_initChart","_hidePositionMarker","_resetView","_resizeChart","_updateSummary","DomEvent","onRemove","redraw","setZFollow","zoom","show","geom","feat","_latlngs","_addGeoJSONData","coordinates","forEach","coords","features","_addGPXdata","_addPoint","lat","lng","meta","ele","x","y","z","eleMax","Infinity","eleMin","dist","curr","LatLng","prev","delta","distanceTo","Math","round","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","push","index","_appendChart","svg","g","append","attr","_appendGrid","_appendAreaPath","_appendAxis","_appendFocusRect","_appendMouseFocusG","_appendLegend","eleDiv","querySelector","random","toString","substr","id","nextSibling","removeClass","_appendXaxis","axis","_height","axisBottom","scale","_x","ticks","_width","text","_appendXGrid","grid","tickSize","tickFormat","_appendYaxis","axisLeft","_y","_appendYGrid","_areapath","_axis","focusRect","_focusRect","_dragHandler","_dragStartHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_grid","focusG","_focusG","_mousefocus","_focuslabelrect","_focuslabeltext","_focuslabelY","_focuslabelX","_legend","altitude","_altitudeLegend","_appendPositionMarker","pane","heightG","select","_mouseHeightFocus","_pointG","_mouseHeightFocusLabel","_mouseHeightFocusLabelY","xdomain","extent","ydomain","domain","datum","_area","_updateAxis","_calculateFullExtent","Error","ext","latLngBounds","item","_collapse","sources","source","shift","_isObject","key","Object","assign","[object Object]","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","_dragCurrentCoords","item1","_findItemForX","item2","_fitSection","dragstart","dragend","mouse","node","dragEndCoords","x1","min","x2","max","_dragRectangle","_dragRectangleG","insert","_expand","_findItemForLatLng","result","bisect","bisector","invert","propagate","index1","index2","start","end","slice","_formatter","num","dec","sep","res","formatNum","numbers","split","join","_selectedItem","_marker","removeLayer","offWi","offsetWidth","offHe","offsetHeight","_maxWidth","containerWidth","clientWidth","scaleLinear","range","area","curve","xDiagCoord","y0","y1","_line","summaryDiv","disableClickPropagation","_mousewheelHandler","link","_button","href","stop","_toggle","Array","isArray","doc","trim","indexOf","documentElement","ownerDocument","nodeName","_isDomVisible","elem","getClientRects","styles","getComputedStyle","visibility","isVisibleByStyles","boundingRect","getBoundingClientRect","above","pointerEvents","elementFromPoint","isAboveOtherElements","skip","loader","Promise","resolve","reject","tag","createElement","head","ctx","xCoord","_showDiagramIndicator","_showPositionMarker","gestureHandling","_enabled","ll","getCenter","deltaY","getZoom","flyTo","remove","_isFullscreen","newWidth","innerHTML","removeControl","_saveFile","fileUrl","a","b","body","download","click","xCoordinate","classed","yCoordinate","bbox","getBBox","xAlign","yAlign","webkit","selectAll","each","hasClass","setView","animate","duration","getPane","createPane","zIndex","_updatePositionMarker","_updateLeafletMarker","_updateHeightIndicator","numY","normalizedAlt","normalizedY","setLatLng","Marker","zIndexOffset","_updatePointG","latLngToLayerPoint","layerpoint","layerpane","getContainer","toFixed","onclick","evt","confirm","CustomEvent","dispatchEvent","detail","control","elevation"],"mappings":"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"}