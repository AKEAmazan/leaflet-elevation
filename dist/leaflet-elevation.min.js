!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";!function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(e.L)}((function(t){return t.locales={},t.locale=null,t.registerLocale=function(e,i){t.locales[e]=t.Util.extend({},t.locales[e],i)},t.setLocale=function(e){t.locale=e},t.i18n=t._=function(e,i){t.locale&&t.locales[t.locale]&&t.locales[t.locale][e]&&(e=t.locales[t.locale][e]);try{e=t.Util.template(e,i)}catch(t){}return e}}),window),L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{autohide:!0,autohideMarker:!0,collapsed:!1,controlButton:{iconCssClass:"elevation-toggle-icon",title:"Elevation"},detached:!0,distanceFactor:1,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,gpxOptions:{async:!0,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})}}},height:200,heightFactor:1,hoverNumber:{decimalsX:2,decimalsY:0,formatter:void 0},imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},reverseCoords:!1,skipNullZCoords:!1,theme:"lightblue-theme",margins:{top:10,right:20,bottom:30,left:50},responsive:!0,summary:"inline",width:600,xLabel:"km",xTicks:void 0,yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:13},__mileFactor:.621371,__footFactor:3.28084,addData:function(t,e){L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3,L.Control.Elevation._d3LazyLoader).then(function(t,e){this._addData(t),this._container&&this._applyData(),null==e&&t.on&&(e=t),e&&(e._path&&L.DomUtil.addClass(e._path,this.options.polyline.className+" "+this.options.theme),e.on("mousemove",this._mousemoveLayerHandler,this).on("mouseout",this._mouseoutHandler,this)),this.track_info=L.extend({},this.track_info,{distance:this._distance,elevation_max:this._maxElevation,elevation_min:this._minElevation}),this._layers=this._layers||{},this._layers[L.Util.stamp(e)]=e,this._fireEvt("eledata_added",{data:t,layer:e,track_info:this.track_info},!0)}.bind(this,t,e))},addTo:function(t){return this.options.detached?this._appendElevationDiv(t._container).appendChild(this.onAdd(t)):L.Control.prototype.addTo.call(this,t),this},clear:function(){this._clearPath(),this._clearChart(),this._clearData(),this._fireEvt("eledata_clear")},disableDragging:function(){this._draggingEnabled=!1,this._resetDrag()},enableDragging:function(){this._draggingEnabled=!0},fitBounds:function(t){t=t||this._fullExtent,this._map&&t&&this._map.fitBounds(t)},getZFollow:function(){return this._zFollow},hide:function(){this._container.style.display="none"},initialize:function(t){this.options.autohide=void 0!==t.autohide?t.autohide:!L.Browser.mobile,this.options=this._deepMerge({},this.options,t),this._draggingEnabled=!L.Browser.mobile,this._chartEnabled=!0,t.imperial?(this._distanceFactor=this.__mileFactor,this._heightFactor=this.__footFactor,this._xLabel="mi",this._yLabel="ft"):(this._distanceFactor=this.options.distanceFactor,this._heightFactor=this.options.heightFactor,this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0),this.on("waypoint_added",(function(t){t.point._popup&&(t.point._popup.options.className="elevation-popup",t.point._popup._content=decodeURI(t.point._popup._content)),t.point._popup&&t.point._popup._content&&t.point.bindTooltip(t.point._popup._content,{direction:"top",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip()}))},load:function(t,e){this.loadData(t,e)},loadChart:function(t){this.addTo(t)},loadData:function(t,e){(e=L.extend({},this.options.loadData,e)).defer?this.loadDefer(t,e):e.lazy?this.loadLazy(t,e):this._isXMLDoc(t)?this.loadGPX(t):this._isJSONDoc(t)?this.loadGeoJSON(t):this.loadFile(t)},loadDefer:function(t,e){(e=L.extend({},this.options.loadData,e)).defer=!1,"complete"!==document.readyState?window.addEventListener("load",L.bind(this.loadData,this,t,e),{once:!0}):this.loadData(t,e)},loadFile:function(t){this._downloadURL=t;try{let e=new XMLHttpRequest;e.responseType="text",e.open("GET",t),e.onload=function(){if(200!==e.status)throw"Error "+e.status+" while fetching remote file: "+t;this.loadData(e.response,{lazy:!1,defer:!1})}.bind(this),e.send()}catch(t){console.warn(t)}},loadGeoJSON:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.layer=this.geojson=L.geoJson(t,{style:function(t){let e=L.extend({},this.options.polyline);return this.options.theme&&(e.className+=" "+this.options.theme),e}.bind(this),pointToLayer:function(t,e){let i=L.marker(e,{icon:this.options.gpxOptions.marker_options.wptIcons[""]}),s=t.properties.desc?t.properties.desc:"",a=t.properties.name?t.properties.name:"";return(a||s)&&i.bindPopup("<b>"+a+"</b>"+(s.length>0?"<br>"+s:"")).openPopup(),this.fire("waypoint_added",{point:i,point_type:"waypoint",element:e}),i}.bind(this),onEachFeature:function(e,i){"Point"!=e.geometry.type&&(this.addData(e,i),this.track_info=L.extend({},this.track_info,{type:"geojson",name:t.name}))}.bind(this)}),this._map?(this._map.once("layeradd",(function(e){this.fitBounds(this.layer.getBounds()),this._fireEvt("eledata_loaded",{data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info},!0)}),this),this.layer.addTo(this._map)):console.warn("Undefined elevation map object")},loadGPX:function(t){L.Control.Elevation._gpxLazyLoader=this._lazyLoadJS("https://unpkg.com/leaflet-gpx@1.5.0/gpx.js","function"!=typeof L.GPX,L.Control.Elevation._gpxLazyLoader).then(function(t){this.options.gpxOptions.polyline_options=L.extend({},this.options.polyline,this.options.gpxOptions.polyline_options),this.options.theme&&(this.options.gpxOptions.polyline_options.className+=" "+this.options.theme),this.layer=this.gpx=new L.GPX(t,this.options.gpxOptions),this.layer.on("loaded",(function(t){this.fitBounds(t.target.getBounds())}),this),this.layer.on("addpoint",(function(t){this.fire("waypoint_added",t,!0)}),this),this.layer.once("addline",(function(e){this.addData(e.line),this.track_info=L.extend({},this.track_info,{type:"gpx",name:this.layer.get_name()}),this._fireEvt("eledata_loaded",{data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info},!0)}),this),this._map?this.layer.addTo(this._map):console.warn("Undefined elevation map object")}.bind(this,t))},loadLazy:function(t,e){(e=L.extend({},this.options.loadData,e)).lazy=!1;let i=!1,s=L.bind((function(t){i||(L.Util.requestAnimFrame((function(){this._isVisible(this.placeholder)&&(window.removeEventListener("scroll",s),this.loadData(t,e),this.once("eledata_loaded",(function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)}),this)),i=!1}),this),i=!0)}),this,t);window.addEventListener("scroll",s),this.placeholder&&this.placeholder.addEventListener("mouseenter",s,{once:!0}),s()},onAdd:function(t){this._map=t;let e=this._container=L.DomUtil.create("div","elevation-control elevation");if(this.options.detached||L.DomUtil.addClass(e,"leaflet-control"),this.options.theme&&L.DomUtil.addClass(e,this.options.theme),this.options.placeholder&&!this._data){if(this.placeholder=L.DomUtil.create("img","elevation-placeholder"),"string"==typeof this.options.placeholder)this.placeholder.src=this.options.placeholder,this.placeholder.alt="";else for(let t in this.options.placeholder)this.placeholder.setAttribute(t,this.options.placeholder[t]);e.insertBefore(this.placeholder,e.firstChild)}return L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3,L.Control.Elevation._d3LazyLoader).then(function(t,e){this._initToggle(e),this._initChart(e),this._applyData(),this._map.on("zoom viewreset zoomanim",this._hidePositionMarker,this),this._map.on("resize",this._resetView,this),this._map.on("resize",this._resizeChart,this),this._map.on("mousedown",this._resetDrag,this),this._map.on("eledata_added",this._updateSummary,this),L.DomEvent.on(this._map._container,"mousewheel",this._resetDrag,this),L.DomEvent.on(this._map._container,"touchstart",this._resetDrag,this)}.bind(this,t,e)),e},onRemove:function(t){this._container=null},redraw:function(){this._resizeChart()},setZFollow:function(t){this._zFollow=t},show:function(){this._container.style.display="block"},_addData:function(t){let e=t&&t.geometry,i=t&&"FeatureCollection"===t.type,s=t&&t._latlngs;if(e)switch(e.type){case"LineString":this._addGeoJSONData(e.coordinates);break;case"MultiLineString":e.coordinates.forEach(t=>this._addGeoJSONData(t));break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+e.type)}i&&t.features.forEach(t=>this._addData(t)),s&&this._addGPXdata(t._latlngs)},_addGeoJSONData:function(t){t&&t.forEach(t=>this._addPoint(t[1],t[0],t[2]))},_addGPXdata:function(t){t&&t.forEach(t=>this._addPoint(t.lat,t.lng,t.meta.ele))},_addPoint:function(t,e,i){this.options.reverseCoords&&([t,e]=[e,t]);let s=this._data||[],a=this._maxElevation||-1/0,o=this._minElevation||1/0,n=this._distance||0,l=new L.LatLng(t,e),r=s.length?s[s.length-1].latlng:l,h=l.distanceTo(r)*this._distanceFactor;if(n+=Math.round(h/1e3*1e5)/1e5,!this.options.skipNullZCoords&&s.length>0){let t=s[s.length-1].z;if(isNaN(t)){let e=this._lastValidZ,a=i*this._heightFactor;isNaN(e)||isNaN(a)?isNaN(e)?isNaN(a)||(t=a):t=e:t=(e+a)/2,isNaN(t)?s.splice(s.length-1,1):s[s.length-1].z=t}}i*=this._heightFactor,isNaN(i)||(a=a<i?i:a,o=o>i?i:o,this._lastValidZ=i),s.push({dist:n,x:t,y:e,z:i,latlng:l}),this._data=s,this._distance=n,this._maxElevation=a,this._minElevation=o},_appendChart:function(t){let e=t.append("g").attr("transform","translate("+this.options.margins.left+","+this.options.margins.top+")");this._appendGrid(e),this._appendAreaPath(e),this._appendAxis(e),this._appendFocusRect(e),this._appendMouseFocusG(e),this._appendLegend(e)},_appendElevationDiv:function(t){let e=document.querySelector(this.options.elevationDiv);return e||(e=L.DomUtil.create("div","leaflet-control elevation elevation-div"),this.options.elevationDiv="#elevation-div_"+Math.random().toString(36).substr(2,9),e.id=this.options.elevationDiv.substr(1),t.parentNode.insertBefore(e,t.nextSibling)),this.options.detached&&(L.DomUtil.addClass(e,"elevation-detached"),L.DomUtil.removeClass(e,"leaflet-control")),this.eleDiv=e,this.eleDiv},_appendXaxis:function(t){t.append("g").attr("class","x axis").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks)).append("text").attr("x",this._width()+6).attr("y",30).text(this._xLabel)},_appendXGrid:function(t){t.append("g").attr("class","x grid").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks).tickSize(-this._height()).tickFormat(""))},_appendYaxis:function(t){t.append("g").attr("class","y axis").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks)).append("text").attr("x",-30).attr("y",3).text(this._yLabel)},_appendYGrid:function(t){t.append("g").attr("class","y grid").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks).tickSize(-this._width()).tickFormat(""))},_appendAreaPath:function(t){this._areapath=t.append("path").attr("class","area")},_appendAxis:function(t){this._axis=t.append("g").attr("class","axis"),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_appendFocusRect:function(t){let e=this._focusRect=t.append("rect").attr("width",this._width()).attr("height",this._height()).style("fill","none").style("stroke","none").style("pointer-events","all");L.Browser.mobile&&(e.on("touchmove.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focus",this._mousemoveHandler.bind(this)).on("touchmove.focus",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)),e.on("mousemove.drag",this._dragHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mouseenter.focus",this._mouseenterHandler.bind(this)).on("mousemove.focus",this._mousemoveHandler.bind(this)).on("mouseout.focus",this._mouseoutHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this)},_appendGrid:function(t){this._grid=t.append("g").attr("class","grid"),this._appendXGrid(this._grid),this._appendYGrid(this._grid)},_appendMouseFocusG:function(t){let e=this._focusG=t.append("g").attr("class","mouse-focus-group");this._mousefocus=e.append("svg:line").attr("class","mouse-focus-line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._focuslabelrect=e.append("rect").attr("class","mouse-focus-label").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",3).attr("ry",3),this._focuslabeltext=e.append("svg:text").attr("class","mouse-focus-label-text"),this._focuslabelY=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-y").attr("dy","-1em"),this._focuslabelX=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-x").attr("dy","2em")},_appendLegend:function(t){if(!this.options.legend)return;let e=this._legend=t.append("g").attr("class","legend"),i=this._altitudeLegend=this._legend.append("g").attr("class","legend-altitude");i.append("rect").attr("class","area").attr("x",this._width()/2-50).attr("y",this._height()+this.options.margins.bottom-17).attr("width",50).attr("height",5).attr("opacity",.75),i.append("text").text("Altitude").attr("x",this._width()/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",this._height()+this.options.margins.bottom-11),e.on("click",function(){if(this._chartEnabled)this._clearChart(),this._clearPath(),this._chartEnabled=!1;else{this._resizeChart();for(let t in this._layers)L.DomUtil.addClass(this._layers[t]._path,this.options.polyline.className+" "+this.options.theme);this._chartEnabled=!0}}.bind(this))},_appendPositionMarker:function(t){let e=this.options.theme,i=t.select("g");this._mouseHeightFocus=i.append("svg:line").attr("class",e+" height-focus line").attr("x2",0).attr("y2",0).attr("x1",0).attr("y1",0),this._pointG=i.append("g"),this._pointG.append("svg:circle").attr("class",e+" height-focus circle-lower").attr("r",6).attr("cx",0).attr("cy",0),this._mouseHeightFocusLabel=i.append("svg:text").attr("class",e+" height-focus-label").style("pointer-events","none")},_applyData:function(){if(!this._data)return;let t=d3.extent(this._data,t=>t.dist),e=d3.extent(this._data,t=>t.z),i=this.options;void 0!==i.yAxisMin&&(i.yAxisMin<e[0]||i.forceAxisBounds)&&(e[0]=i.yAxisMin),void 0!==i.yAxisMax&&(i.yAxisMax>e[1]||i.forceAxisBounds)&&(e[1]=i.yAxisMax),this._x.domain(t),this._y.domain(e),this._areapath.datum(this._data).attr("d",this._area),this._updateAxis(),this._fullExtent=this._calculateFullExtent(this._data)},_calculateFullExtent:function(t){if(!t||t.length<1)throw new Error("no data in parameters");let e=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach(t=>e.extend(t.latlng)),e},_clearChart:function(){this._resetDrag(),this._areapath&&(this._areapath.attr("d","M0 0"),this._x.domain([0,1]),this._y.domain([0,1]),this._updateAxis()),this._altitudeLegend&&this._altitudeLegend.select("text").style("text-decoration-line","line-through")},_clearData:function(){this._data=null,this._distance=null,this._maxElevation=null,this._minElevation=null,this.track_info=null,this._layers=null},_clearPath:function(){this._hidePositionMarker();for(let t in this._layers)L.DomUtil.removeClass(this._layers[t]._path,this.options.polyline.className),L.DomUtil.removeClass(this._layers[t]._path,this.options.theme)},_collapse:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-expanded"),L.DomUtil.addClass(this._container,"elevation-collapsed"))},_deepMerge:function(t,...e){if(!e.length)return t;const i=e.shift();if(this._isObject(t)&&this._isObject(i))for(const e in i)this._isObject(i[e])?(t[e]||Object.assign(t,{[e]:{}}),this._deepMerge(t[e],i[e])):Object.assign(t,{[e]:i[e]});return this._deepMerge(t,...e)},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_dragEndHandler:function(){if(!this._dragStartCoords||!this._dragCurrentCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void(this._draggingEnabled&&this._resetDrag());let t=this._findItemForX(this._dragStartCoords[0]),e=this._findItemForX(this._dragCurrentCoords[0]);t!=e&&(this._hidePositionMarker(),this._fitSection(t,e),this._dragStartCoords=null,this._gotDragged=!1,this._fireEvt("elechart_dragged",{data:{dragstart:this._data[t],dragend:this._data[e]}},!0))},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._focusRect.node())},_drawDragRectangle:function(){if(!this._dragStartCoords||!this._draggingEnabled)return;let t=this._dragCurrentCoords=d3.mouse(this._focusRect.node()),e=Math.min(this._dragStartCoords[0],t[0]),i=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",i-e).attr("x",e);else{let t=d3.select(this._container).select("svg").select("g");this._dragRectangleG=t.insert("g",".mouse-focus-group"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",i-e).attr("height",this._height()).attr("x",e).attr("class","mouse-drag").style("pointer-events","none")}},_expand:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-collapsed"),L.DomUtil.addClass(this._container,"elevation-expanded"))},_findItemForLatLng:function(t){let e=null,i=1/0;return this._data.forEach(s=>{let a=t.distanceTo(s.latlng);a<i&&(i=a,e=s)}),e},_findItemForX:function(t){let e=this._data?this._data:[0,1];return(0,d3.bisector(t=>t.dist).left)(e,this._x.invert(t))},_fireEvt:function(t,e,i){this.fire&&this.fire(t,e,i),this._map&&this._map.fire(t,e,i)},_fitSection:function(t,e){let i=Math.min(t,e),s=Math.max(t,e),a=this._calculateFullExtent(this._data.slice(i,s));this.fitBounds(a)},_formatter:function(t,e,i){let s=L.Util.formatNum(t,e).toString(),a=s.split(".");if(a[1]){for(let t=e-a[1].length;t>0;t--)a[1]+="0";s=a.join(i||".")}return s},_height:function(){let t=this.options;return t.height-t.margins.top-t.margins.bottom},_hidePositionMarker:function(){this.options.autohideMarker&&(this._selectedItem=null,this._marker&&(this._map&&this._map.removeLayer(this._marker),this._marker=null),this._mouseHeightFocus&&(this._mouseHeightFocus.style("visibility","hidden"),this._mouseHeightFocusLabel.style("visibility","hidden")),this._pointG&&this._pointG.style("visibility","hidden"),this._focusG&&this._focusG.style("visibility","hidden"))},_initChart:function(){let t=this.options;if(t.xTicks=t.xTicks||Math.round(this._width()/75),t.yTicks=t.yTicks||Math.round(this._height()/30),t.hoverNumber.formatter=t.hoverNumber.formatter||this._formatter,t.responsive)if(t.detached){let e=this.eleDiv.offsetWidth,i=this.eleDiv.offsetHeight;t.width=e>0?e:t.width,t.height=i-20>0?i-20:t.height}else{t._maxWidth=t._maxWidth>t.width?t._maxWidth:t.width;let e=this._map._container.clientWidth;t.width=t._maxWidth>e?e-30:t.width}let e=this._x=d3.scaleLinear().range([0,this._width()]),i=this._y=d3.scaleLinear().range([this._height(),0]),s="function"==typeof t.interpolation?t.interpolation:d3[t.interpolation],a=(this._area=d3.area().curve(s).x(t=>t.xDiagCoord=e(t.dist)).y0(this._height()).y1(t=>i(t.z)),this._line=d3.line().x(t=>d3.mouse(o.select("g"))[0]).y(t=>this._height()),d3.select(this._container)),o=a.append("svg").attr("class","background").attr("width",t.width).attr("height",t.height);this.summaryDiv=a.append("div").attr("class","elevation-summary "+this.options.summary+"-summary").node();this._appendChart(o),this._updateSummary()},_initToggle:function(t){if(t.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(t),L.Browser.mobile&&L.DomEvent.on(t,"click",L.DomEvent.stopPropagation),L.DomEvent.on(t,"mousewheel",this._mousewheelHandler,this),!this.options.detached){let e="elevation-toggle "+this.options.controlButton.iconCssClass+(this.options.autohide?"":" close-button"),i=this._button=L.DomUtil.create("a",e,t);i.href="#",i.title=this.options.controlButton.title,this.options.collapsed&&(this._collapse(),this.options.autohide?L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this):L.DomEvent.on(i,"click",L.DomEvent.stop).on(i,"click",this._toggle,this),L.DomEvent.on(i,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_isObject:function(t){return t&&"object"==typeof t&&!Array.isArray(t)},_isJSONDoc:function(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("{")||0==t.indexOf("[");try{JSON.parse(t.toString())}catch(i){return!("object"!=typeof t||!e)||(console.warn(i),!1)}return!0},_isXMLDoc:function(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("<");{let e=(t?t.ownerDocument||t:0).documentElement;return!!e&&"HTML"!==e.nodeName}},_isDomVisible:function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},_isVisible:function(t){if(!t)return!1;let e=window.getComputedStyle(t);return!!function(t,e){return"hidden"!==e.visibility&&"none"!==e.display}(0,e)&&!!function(t,e){let i=t.getBoundingClientRect(),s=i.left+1,a=i.right-1,o=i.top+1,n=(i.bottom,!0),l=t.style.pointerEvents;return"none"==e["pointer-events"]&&(t.style.pointerEvents="auto"),document.elementFromPoint(s,o)!==t&&(n=!1),document.elementFromPoint(a,o)!==t&&(n=!1),t.style.pointerEvents=l,n}(t,e)},_lazyLoadJS:function(t,e,i){return!1!==e&&this.options.lazyLoadJS?i instanceof Promise?i:new Promise((e,i)=>{let s=document.createElement("script");s.addEventListener("load",e,{once:!0}),s.src=t,document.head.appendChild(s)}):Promise.resolve()},_mouseenterHandler:function(){this._fireEvt("elechart_enter",null,!0)},_mousemoveHandler:function(t,e,i){if(!this._data||0===this._data.length||!this._chartEnabled)return;let s=d3.mouse(this._focusRect.node())[0],a=this._data[this._findItemForX(s)];this._hidePositionMarker(),this._showDiagramIndicator(a,s),this._showPositionMarker(a),this._setMapView(a),this._map&&this._map._container&&L.DomUtil.addClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_change",{data:a},!0),this._fireEvt("elechart_hover",{data:a},!0)},_mousemoveLayerHandler:function(t){if(!this._data||0===this._data.length)return;let e=t.latlng,i=this._findItemForLatLng(e);if(i){let t=i.xDiagCoord;this._hidePositionMarker(),this._showDiagramIndicator(i,t),this._showPositionMarker(i)}},_mouseoutHandler:function(){this.options.detached||this._hidePositionMarker(),this._map&&this._map._container&&L.DomUtil.removeClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_leave",null,!0)},_mousewheelHandler:function(t){if(this._map.gestureHandling&&this._map.gestureHandling._enabled)return;let e=this._selectedItem?this._selectedItem.latlng:this._map.getCenter(),i=t.deltaY>0?this._map.getZoom()-1:this._map.getZoom()+1;this._resetDrag(),this._map.flyTo(e,i)},_resetDrag:function(){this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null,this._hidePositionMarker())},_resetView:function(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hidePositionMarker(),this.fitBounds(this._fullExtent))},_resizeChart:function(){if(this.options.responsive)if(this.options.detached){let t=this.eleDiv.offsetWidth;if(t<=0)return;this.options.width=t,this.eleDiv.innerHTML="",this.eleDiv.appendChild(this.onAdd(this._map))}else this._map.removeControl(this._container),this.addTo(this._map)},_saveFile:function(t){let e=document,i=e.createElement("a"),s=e.body;i.href=t,i.target="_new",i.download="",i.style.display="none",s.appendChild(i),i.click(),s.removeChild(i)},_showDiagramIndicator:function(t,e){if(!this._chartEnabled)return;let i=this.options;this._focusG.style("visibility","visible"),this._mousefocus.attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",this._height()).classed("hidden",!1);let s=t.z,a=t.dist,o=(t.latlng,i.hoverNumber.formatter(s,i.hoverNumber.decimalsY)),n=i.hoverNumber.formatter(a,i.hoverNumber.decimalsX);this._focuslabeltext.attr("y",this._y(t.z)).style("font-weight","700"),this._focuslabelX.text(n+" "+this._xLabel).attr("x",e+10),this._focuslabelY.text(o+" "+this._yLabel).attr("x",e+10);let l=this._focuslabeltext.node();if(this._isDomVisible(l)){let t=l.getBBox(),i=2;this._focuslabelrect.attr("x",t.x-i).attr("y",t.y-i).attr("width",t.width+2*i).attr("height",t.height+2*i),e>=this._width()/2&&(this._focuslabelrect.attr("x",this._focuslabelrect.attr("x")-this._focuslabelrect.attr("width")-2*i-10),this._focuslabelX.attr("x",this._focuslabelX.attr("x")-this._focuslabelrect.attr("width")-2*i-10),this._focuslabelY.attr("x",this._focuslabelY.attr("x")-this._focuslabelrect.attr("width")-2*i-10))}},_toggle:function(){L.DomUtil.hasClass(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function(t){if(!this.options.followMarker||!this._map)return;let e=this._map.getZoom();e=e<this._zFollow?this._zFollow:e,this._map.setView(t.latlng,e,{animate:!0,duration:.25})},_showPositionMarker:function(t){this._selectedItem=t,this._map&&!this._map.getPane("elevationPane")&&(this._map.createPane("elevationPane"),this._map.getPane("elevationPane").style.zIndex=625,this._map.getPane("elevationPane").style.pointerEvents="none"),"elevation-line"==this.options.marker?this._updatePositionMarker(t):"position-marker"==this.options.marker&&this._updateLeafletMarker(t)},_updateAxis:function(){this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove(),this._appendXGrid(this._grid),this._appendYGrid(this._grid),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_updateHeightIndicator:function(t){let e=this.options,i=e.hoverNumber.formatter(t.z,e.hoverNumber.decimalsY),s=(e.hoverNumber.formatter(t.dist,e.hoverNumber.decimalsX),this._height()/this._maxElevation*t.z),a=t.y-s;this._mouseHeightFocus.attr("x1",t.x).attr("x2",t.x).attr("y1",t.y).attr("y2",a).style("visibility","visible"),this._mouseHeightFocusLabel.attr("x",t.x).attr("y",a).text(i+" "+this._yLabel).style("visibility","visible")},_updateLeafletMarker:function(t){let e=t.latlng;this._marker?this._marker.setLatLng(e):(this._marker=new L.Marker(e,{icon:this.options.markerIcon,zIndexOffset:1e6}),this._marker.addTo(this._map,{pane:"elevationPane"}))},_updatePointG:function(t){this._pointG.attr("transform","translate("+t.x+","+t.y+")").style("visibility","visible")},_updatePositionMarker:function(t){let e=this._map.latLngToLayerPoint(t.latlng),i={dist:t.dist,x:e.x,y:e.y,z:t.z};if(!this._mouseHeightFocus){L.svg({pane:"elevationPane"}).addTo(this._map);let t=d3.select(this._map.getContainer()).select(".leaflet-elevation-pane svg");this._appendPositionMarker(t)}this._updatePointG(i),this._updateHeightIndicator(i)},_updateSummary:function(){if(this.options.summary&&this.summaryDiv&&(this.track_info=this.track_info||{},this.track_info.distance=this._distance||0,this.track_info.elevation_max=this._maxElevation||0,this.track_info.elevation_min=this._minElevation||0,d3.select(this.summaryDiv).html('<span class="totlen"><span class="summarylabel">'+L._("Total Length: ")+'</span><span class="summaryvalue">'+this.track_info.distance.toFixed(2)+" "+this._xLabel+'</span></span><span class="maxele"><span class="summarylabel">'+L._("Max Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_max.toFixed(2)+" "+this._yLabel+'</span></span><span class="minele"><span class="summarylabel">'+L._("Min Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_min.toFixed(2)+" "+this._yLabel+"</span></span>")),this.options.downloadLink&&this._downloadURL){let t=document.createElement("span");t.className="download";let e=document.createElement("a");e.innerHTML="Download",e.href="#",e.onclick=function(t){t.preventDefault();let e={confirm:this._saveFile.bind(this,this._downloadURL)},i=this.options.downloadLink;"modal"==i?("function"==typeof CustomEvent&&document.dispatchEvent(new CustomEvent("eletrack_download",{detail:e})),this._fireEvt("eletrack_download",e)):"link"!=i&&!0!==i||e.confirm()}.bind(this),this.summaryDiv.appendChild(t).appendChild(e)}},_width:function(){let t=this.options;return t.width-t.margins.left-t.margins.right}}),L.control.elevation=function(t){return new L.Control.Elevation(t)}}));
//# sourceMappingURL=leaflet-elevation.min.js.map
