!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(e,...i){if(!i.length)return e;const a=i.shift();if(s(e)&&s(a))for(const i in a)s(a[i])?(e[i]||Object.assign(e,{[i]:{}}),t(e[i],a[i])):Object.assign(e,{[i]:a[i]});return t(e,...i)}function e(t){"complete"!==document.readyState?window.addEventListener("load",t,{once:!0}):t()}function i(t,e,i){let a=L.Util.formatNum(t,e).toString(),o=a.split(".");if(o[1]){for(let t=e-o[1].length;t>0;t--)o[1]+="0";a=o.join(i||".")}return a}function a(t,e){"string"==typeof t&&(t=JSON.parse(t)),e=e||this;let i=L.geoJson(t,{style:t=>{let i=L.extend({},e.options.polyline);return e.options.theme&&(i.className+=" "+e.options.theme),i},pointToLayer:(t,i)=>{let a=L.marker(i,{icon:e.options.gpxOptions.marker_options.wptIcons[""]}),o=t.properties.desc?t.properties.desc:"",s=t.properties.name?t.properties.name:"";return(s||o)&&a.bindPopup("<b>"+s+"</b>"+(o.length>0?"<br>"+o:"")).openPopup(),e.fire("waypoint_added",{point:a,point_type:"waypoint",element:i}),a},onEachFeature:(i,a)=>{"Point"!=i.geometry.type&&(e.addData(i,a),e.track_info=L.extend({},e.track_info,{type:"geojson",name:t.name}))}});return e._fireEvt("eledata_loaded",{data:t,layer:i,name:e.track_info.name,track_info:e.track_info},!0),i}function o(t,e){(e=e||this).options.gpxOptions.polyline_options=L.extend({},e.options.polyline,e.options.gpxOptions.polyline_options),e.options.theme&&(e.options.gpxOptions.polyline_options.className+=" "+e.options.theme);let i=new L.GPX(t,e.options.gpxOptions);return i.on("addpoint",t=>{e.fire("waypoint_added",t,!0)}),i.once("addline",t=>{e.addData(t.line),e.track_info=L.extend({},e.track_info,{type:"gpx",name:i.get_name()})}),i.once("loaded",a=>{e._fireEvt("eledata_loaded",{data:t,layer:i,name:e.track_info.name,track_info:e.track_info},!0)}),i}function s(t){return t&&"object"==typeof t&&!Array.isArray(t)}function n(t){if(!t)return!1;let e=window.getComputedStyle(t);return!!function(t,e){return"hidden"!==e.visibility&&"none"!==e.display}(0,e)&&!!function(t,e){let i=t.getBoundingClientRect(),a=i.left+1,o=i.right-1,s=i.top+1,n=(i.bottom,!0),r=t.style.pointerEvents;return"none"==e["pointer-events"]&&(t.style.pointerEvents="auto"),document.elementFromPoint(a,s)!==t&&(n=!1),document.elementFromPoint(o,s)!==t&&(n=!1),t.style.pointerEvents=r,n}(t,e)}function r(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("{")||0==t.indexOf("[");try{JSON.parse(t.toString())}catch(i){return!("object"!=typeof t||!e)||(console.warn(i),!1)}return!0}function l(t,e){if(e=void 0===e||e,"string"==typeof t&&e)return 0==(t=t.trim()).indexOf("<");{let e=(t?t.ownerDocument||t:0).documentElement;return!!e&&"HTML"!==e.nodeName}}function h(t,e,i){return!1===e?Promise.resolve():i instanceof Promise?i:new Promise((e,i)=>{let a=document.createElement("script");a.addEventListener("load",e,{once:!0}),a.src=t,document.head.appendChild(a)})}function d(t,e){return new Promise((e,i)=>{let a=new XMLHttpRequest;a.responseType="text",a.open("GET",t),a.onload=()=>e(a.response),a.onerror=()=>i("Error "+a.status+" while fetching remote file: "+t),a.send()})}function c(t,e){let i=document,a=i.createElement("a"),o=i.body;a.href=t,a.target="_new",a.download=e||"",a.style.display="none",o.appendChild(a),a.click(),o.removeChild(a)}function _(t){return new Promise((e,i)=>{let a=!1,o=()=>{a||(L.Util.requestAnimFrame(()=>{n(t)&&(window.removeEventListener("scroll",o),e()),a=!1}),a=!0)};window.addEventListener("scroll",o),t&&t.addEventListener("mouseenter",o,{once:!0}),o()})}!function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==e&&e.L&&t(e.L)}((function(t){return t.locales={},t.locale=null,t.registerLocale=function(e,i){t.locales[e]=t.Util.extend({},t.locales[e],i)},t.setLocale=function(e){t.locale=e},t.i18n=t._=function(e,i){t.locale&&t.locales[t.locale]&&t.locales[t.locale][e]&&(e=t.locales[t.locale][e]);try{e=t.Util.template(e,i)}catch(t){}return e}}),window);var p=Object.freeze({__proto__:null,deepMerge:t,deferFunc:e,formatter:i,GeoJSONLoader:a,GPXLoader:o,isDomVisible:function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},isObject:s,isVisible:n,isJSONDoc:r,isXMLDoc:l,lazyLoader:h,loadFile:d,saveFile:c,waitHolder:_});const u=t=>e=>{let i=t.interpolation||"curveLinear";"function"!=typeof t.interpolation&&(i=d3[t.interpolation]);let a=d3.area().curve(i).x(e=>e.xDiagCoord=t.scaleX(e[t.xAttr])).y0(t.height).y1(e=>t.scaleY(e[t.yAttr]));return t.data&&e.datum(t.data).attr("d",a),t.name&&e.attr("data-name",t.name),a},m=t=>e=>{t=L.extend({type:"axis",tickSize:6,tickPadding:3},t);let[i,a]=[0,0];"x"==t.axis&&"top"==t.position?[i,a]=[0,0]:"x"==t.axis&&"bottom"==t.position?[i,a]=[0,t.height]:"y"==t.axis&&"left"==t.position?[i,a]=[0,0]:"y"==t.axis&&"right"==t.position&&([i,a]=[t.width,0]),"x"==t.axis&&"grid"==t.type?t.tickSize=-t.height:"y"==t.axis&&"grid"==t.type&&(t.tickSize=-t.width);let o=d3["axis"+t.position.replace(/\b\w/g,t=>t.toUpperCase())]().scale(t.scale).ticks(t.ticks).tickPadding(t.tickPadding).tickSize(t.tickSize).tickFormat(t.tickFormat),s=e.append("g").attr("class",[t.axis,t.type,t.position].join(" ")).attr("transform","translate("+i+","+a+")").call(o);return t.label&&s.append("text").attr("x",t.labelX).attr("y",t.labelY).text(t.label),s},g=t=>e=>{let i=Math.min(t.dragStartCoords[0],t.dragEndCoords[0]),a=Math.max(t.dragStartCoords[0],t.dragEndCoords[0]);return e.attr("width",a-i).attr("height",t.height).attr("x",i)},f=t=>e=>e.attr("width",t.width).attr("height",t.height).style("fill","none").style("stroke","none").style("pointer-events","all"),y=t=>(t.type="grid",m(t)),v=t=>e=>e.attr("class",t.theme+" height-focus line").attr("x1",t.xCoord||0).attr("x2",t.xCoord||0).attr("y1",t.yCoord||0).attr("y2",t.length||0),x=t=>e=>{e.attr("class",t.theme+" height-focus-label").style("pointer-events","none").attr("x",t.xCoord+5||0).attr("y",t.yCoord||0);let i=e.select(".height-focus-y");return i.node()||(i=e.append("svg:tspan")),i.attr("class","height-focus-y").text(t.label),e.selectAll("tspan").attr("x",t.xCoord+5||0),e},w=t=>e=>e.attr("class",t.theme+" height-focus circle-lower").attr("transform","translate("+(t.xCoord||0)+","+(t.yCoord||0)+")").attr("r",6).attr("cx",0).attr("cy",0),b=t=>e=>(e.attr("class","legend-item legend-"+t.name.toLowerCase()).attr("data-name",t.name),e.append("rect").attr("class","area").attr("x",t.width/2-50).attr("y",t.height+t.margins.bottom/2).attr("width",50).attr("height",10).attr("opacity",.75),e.append("text").text(L._(t.name)).attr("x",t.width/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",t.height+t.margins.bottom/2).attr("dy","0.75em"),e),k=t=>e=>e.attr("class","mouse-focus-line").attr("x2",t.xCoord).attr("y2",0).attr("x1",t.xCoord).attr("y1",t.height),C=t=>e=>{e.attr("class","mouse-focus-label");let i=e.select(".mouse-focus-label-rect"),a=e.select(".mouse-focus-label-text"),o=a.select(".mouse-focus-label-y"),s=a.select(".mouse-focus-label-x");i.node()||(i=e.append("rect")),a.node()||(a=e.append("svg:text")),o.node()||(o=a.append("svg:tspan")),s.node()||(s=a.append("svg:tspan")),t.labelY&&o.text(t.labelY),t.labelX&&s.text(t.labelX);let n=a.node().getBBox(),r=0,l=0;return t.xCoord&&(r=t.xCoord+(t.xCoord<t.width/2?10:-n.width-10)),t.yCoord&&(l=Math.max(t.yCoord-n.height,L.Browser.webkit?0:-1/0)),i.attr("class","mouse-focus-label-rect").attr("x",r-5).attr("y",l-5).attr("width",n.width+10).attr("height",n.height+10).attr("rx",3).attr("ry",3),a.attr("class","mouse-focus-label-text").style("font-weight","700").attr("y",l),o.attr("class","mouse-focus-label-y").attr("dy","1em"),s.attr("class","mouse-focus-label-x").attr("dy","2em"),a.selectAll("tspan").attr("x",r),e},D=t=>{let e=t.data?d3.extent(t.data,e=>e[t.attr]):[0,1];return t.hasOwnProperty("min")&&(t.min<e[0]||t.forceBounds)&&(e[0]=t.min),t.hasOwnProperty("max")&&(t.max>e[1]||t.forceBounds)&&(e[1]=t.max),d3.scaleLinear().range(t.range).domain(e)};var E=Object.freeze({__proto__:null,Area:u,AreaPath:t=>d3.create("svg:path").attr("class","area").call(u(t)),Axis:m,DragRectangle:g,FocusRect:f,Grid:y,HeightFocusLine:v,HeightFocusLabel:x,HeightFocusPoint:w,LegendItem:b,MouseFocusLine:k,MouseFocusLabel:C,Scale:D}),F=L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{autohide:!L.Browser.mobile,autohideMarker:!0,collapsed:!1,controlButton:{iconCssClass:"elevation-toggle-icon",title:"Elevation"},detached:!0,distanceFactor:1,dragging:!L.Browser.mobile,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,gpxOptions:{async:!0,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})}}},height:200,heightFactor:1,hoverNumber:{decimalsX:2,decimalsY:0,formatter:i},imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},reverseCoords:!1,skipNullZCoords:!1,theme:"lightblue-theme",margins:{top:10,right:20,bottom:30,left:50},responsive:!0,summary:"inline",width:600,xAttr:"dist",xLabel:"km",xTicks:void 0,yAttr:"z",yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:13},__mileFactor:.621371,__footFactor:3.28084,addData:function(t,e){null==e&&t.on&&(e=t),F._d3LazyLoader=h("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3||!this.options.lazyLoadJS,F._d3LazyLoader).then(()=>{this._addData(t),this._addLayer(e),this._fireEvt("eledata_added",{data:t,layer:e,track_info:this.track_info},!0)})},addTo:function(t){return this.options.detached?this._appendElevationDiv(t._container).appendChild(this.onAdd(t)):L.Control.prototype.addTo.call(this,t),this},clear:function(){this._clearPath(),this._clearChart(),this._clearData(),this._fireEvt("eledata_clear")},disableDragging:function(){this._draggingEnabled=!1,this._resetDrag()},enableDragging:function(){this._draggingEnabled=!0},fitBounds:function(t){t=t||this._fullExtent,this._map&&t&&this._map.fitBounds(t)},getZFollow:function(){return this._zFollow},hide:function(){this._container.style.display="none"},initialize:function(e){this.options=t({},this.options,e),this.options.imperial?(this._distanceFactor=this.__mileFactor,this._heightFactor=this.__footFactor,this._xLabel="mi",this._yLabel="ft"):(this._distanceFactor=this.options.distanceFactor,this._heightFactor=this.options.heightFactor,this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),this._chartEnabled=!0,this._draggingEnabled=this.options.dragging,this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0),this.options.legend&&(this.options.margins.bottom+=30)},load:function(t,e){this.loadData(t,e)},loadChart:function(t){this.addTo(t)},loadData:function(t,e){(e=L.extend({},this.options.loadData,e)).defer?this.loadDefer(t,e):e.lazy?this.loadLazy(t,e):l(t)?this.loadGPX(t):r(t)?this.loadGeoJSON(t):this.loadFile(t)},loadDefer:function(t,i){(i=L.extend({},this.options.loadData,i)).defer=!1,e(L.bind(this.loadData,this,t,i))},loadFile:function(t){d(t).then(e=>{this._downloadURL=t,this.loadData(e,{lazy:!1,defer:!1})}).catch(t=>console.warn(t))},loadGeoJSON:function(t){a(t,this)},loadGPX:function(t){F._gpxLazyLoader=h("https://unpkg.com/leaflet-gpx@1.5.0/gpx.js","function"!=typeof L.GPX||!this.options.lazyLoadJS,F._gpxLazyLoader).then(()=>{o(t,this)})},loadLazy:function(t,e){let i=(e=L.extend({},this.options.loadData,e)).lazy.parentNode?e.lazy:this.placeholder;_(e.lazy).then(()=>{e.lazy=!1,this.loadData(t,e),this.once("eledata_loaded",()=>e.lazy.parentNode.removeChild(i))})},onAdd:function(t){this._map=t;let e=this._container=L.DomUtil.create("div","elevation-control elevation");if(this.options.detached||L.DomUtil.addClass(e,"leaflet-control"),this.options.theme&&L.DomUtil.addClass(e,this.options.theme),this.options.placeholder&&!this._data){if(this.placeholder=L.DomUtil.create("img","elevation-placeholder"),"string"==typeof this.options.placeholder)this.placeholder.src=this.options.placeholder,this.placeholder.alt="";else for(let t in this.options.placeholder)this.placeholder.setAttribute(t,this.options.placeholder[t]);e.insertBefore(this.placeholder,e.firstChild)}if(!t.getPane("elevationPane")){let e=t.createPane("elevationPane");e.style.zIndex=625,e.style.pointerEvents="none"}return F._d3LazyLoader=h("https://unpkg.com/d3@5.15.0/dist/d3.min.js","object"!=typeof d3||!this.options.lazyLoadJS,F._d3LazyLoader).then(()=>{this._initToggle(e),this._initChart(e),this._map.on("zoom viewreset zoomanim",this._hidePositionMarker,this),this._map.on("resize",this._resetView,this),this._map.on("resize",this._resizeChart,this),this._map.on("mousedown",this._resetDrag,this),L.DomEvent.on(this._map._container,"mousewheel",this._resetDrag,this),L.DomEvent.on(this._map._container,"touchstart",this._resetDrag,this),this.on("eledata_added",this._updateChart,this),this.on("eledata_added",this._updateSummary,this),this._updateChart(),this._updateSummary()}),e},onRemove:function(t){this._container=null,this._map.off("zoom viewreset zoomanim",this._hidePositionMarker,this),this._map.off("resize",this._resetView,this),this._map.off("resize",this._resizeChart,this),this._map.off("mousedown",this._resetDrag,this),L.DomEvent.off(this._map._container,"mousewheel",this._resetDrag,this),L.DomEvent.off(this._map._container,"touchstart",this._resetDrag,this),this.off("eledata_added",this._updateChart,this),this.off("eledata_added",this._updateSummary,this)},redraw:function(){this._resizeChart()},setZFollow:function(t){this._zFollow=t},show:function(){this._container.style.display="block"},_addData:function(t){let e=t&&t.geometry,i=t&&"FeatureCollection"===t.type,a=t&&t._latlngs;if(e)switch(e.type){case"LineString":this._addGeoJSONData(e.coordinates);break;case"MultiLineString":e.coordinates.forEach(t=>this._addGeoJSONData(t));break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+e.type)}i&&t.features.forEach(t=>this._addData(t)),a&&this._addGPXdata(t._latlngs)},_addGeoJSONData:function(t){t&&t.forEach(t=>this._addPoint(t[1],t[0],t[2]))},_addGPXdata:function(t){t&&t.forEach(t=>this._addPoint(t.lat,t.lng,t.meta.ele))},_addPoint:function(t,e,i){this.options.reverseCoords&&([t,e]=[e,t]);let a=this._data||[],o=this._maxElevation||-1/0,s=this._minElevation||1/0,n=this._distance||0,r=new L.LatLng(t,e),l=a.length?a[a.length-1].latlng:r,h=r.distanceTo(l)*this._distanceFactor;if(n+=Math.round(h/1e3*1e5)/1e5,!this.options.skipNullZCoords&&a.length>0){let t=a[a.length-1].z;if(isNaN(t)){let e=this._lastValidZ,o=i*this._heightFactor;isNaN(e)||isNaN(o)?isNaN(e)?isNaN(o)||(t=o):t=e:t=(e+o)/2,isNaN(t)?a.splice(a.length-1,1):a[a.length-1].z=t}}i*=this._heightFactor,isNaN(i)||(o=o<i?i:o,s=s>i?i:s,this._lastValidZ=i),a.push({dist:n,x:t,y:e,z:i,latlng:r}),this._data=a,this.track_info=this.track_info||{},this.track_info.distance=this._distance=n,this.track_info.elevation_max=this._maxElevation=o,this.track_info.elevation_min=this._minElevation=s,this._fireEvt("eledata_updated",{index:a.length-1},!0)},_addLayer:function(t){t&&(t._path&&L.DomUtil.addClass(t._path,this.options.polyline.className+" "+this.options.theme),t.on("mousemove",this._mousemoveLayerHandler,this).on("mouseout",this._mouseoutHandler,this),this._layers=this._layers||{},this._layers[L.Util.stamp(t)]=t)},_appendChart:function(){let t=this.options;return e=>{let i=e.append("svg").attr("class","background").attr("width",t.width).attr("height",t.height);i.append("g").attr("transform","translate("+t.margins.left+","+t.margins.top+")").call(this._appendGrid()).call(this._appendAxis()).call(this._appendAreaPath()).call(this._appendFocusable()).call(this._appendLegend());return i}},_appendElevationDiv:function(t){let e=document.querySelector(this.options.elevationDiv);return e||(e=L.DomUtil.create("div","leaflet-control elevation elevation-div"),this.options.elevationDiv="#elevation-div_"+Math.random().toString(36).substr(2,9),e.id=this.options.elevationDiv.substr(1),t.parentNode.insertBefore(e,t.nextSibling)),this.options.detached&&(L.DomUtil.addClass(e,"elevation-detached"),L.DomUtil.removeClass(e,"leaflet-control")),this.eleDiv=e,this.eleDiv},_appendSummary:function(){return t=>{let e=this.summaryDiv=t.append("div").attr("class","elevation-summary "+(this.options.summary?this.options.summary+"-summary":"")).node();return this._updateSummary(),e}},_appendXaxis:function(){return m({axis:"x",position:"bottom",width:this._width(),height:this._height(),scale:this._x,ticks:this._xTicks,label:this._xLabel,labelY:25,labelX:this._width()+6})},_appendXGrid:function(){return y({axis:"x",position:"bottom",width:this._width(),height:this._height(),scale:this._x,ticks:this._xTicks,tickFormat:""})},_appendYaxis:function(){return m({axis:"y",position:"left",width:this._width(),height:this._height(),scale:this._y,ticks:this.options.yTicks,label:this._yLabel,labelX:-25,labelY:3})},_appendYGrid:function(){return y({axis:"y",position:"left",width:this._width(),height:this._height(),scale:this._y,ticks:this.options.yTicks,tickFormat:""})},_appendAreaPath:function(){return t=>t.append("g").attr("class","area").append("path")},_appendAxis:function(){return t=>t.append("g").attr("class","axis").call(this._appendXaxis()).call(this._appendYaxis())},_appendFocusable:function(){return t=>t.append("g").attr("class","focus").call(this._appendFocusRect()).call(this._appendMouseFocusG())},_appendFocusRect:function(){return t=>{let e=t.append("rect").call(f({width:this._width(),height:this._height()}));return L.Browser.mobile&&(e.on("touchmove.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focus",this._mousemoveHandler.bind(this)).on("touchmove.focus",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)),e.on("mousemove.drag",this._dragHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mouseenter.focus",this._mouseenterHandler.bind(this)).on("mousemove.focus",this._mousemoveHandler.bind(this)).on("mouseout.focus",this._mouseoutHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this),e}},_appendGrid:function(){return t=>t.append("g").attr("class","grid").call(this._appendXGrid()).call(this._appendYGrid())},_appendMouseFocusG:function(){return t=>{let e=this._focusG=t.append("g").attr("class","mouse-focus-group hidden");return this._focusline=e.append("svg:line").call(k({xCoord:0,height:this._height()})),this._focuslabel=e.append("g").call(C({xCoord:0,yCoord:0,height:this._height(),width:this._width(),labelX:"",labelY:""})),e}},_appendLegend:function(){return t=>{if(!this.options.legend)return;let e=this._legend=t.append("g").attr("class","legend");this._fireEvt("elechart_legend");let i=e.selectAll(".legend-item").on("click",(t,e)=>{let a=i.nodes()[e],o=a.getAttribute("data-name"),s=this._area.select('path[data-name="'+o+'"]').node();this._fireEvt("elepath_toggle",{path:s,name:o,legend:a})});return e}},_calculateFullExtent:function(t){if(!t||t.length<1)throw new Error("no data in parameters");let e=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach(t=>e.extend(t.latlng)),e},_clearChart:function(){this._resetDrag()},_clearData:function(){this._data=null,this._distance=null,this._maxElevation=null,this._minElevation=null,this.track_info=null,this._layers=null},_clearPath:function(){this._hidePositionMarker();for(let t in this._layers)this._layers[t]._path&&(L.DomUtil.removeClass(this._layers[t]._path,this.options.polyline.className),L.DomUtil.removeClass(this._layers[t]._path,this.options.theme))},_collapse:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-expanded"),L.DomUtil.addClass(this._container,"elevation-collapsed"))},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_dragEndHandler:function(){if(!this._dragStartCoords||!this._dragCurrentCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void(this._draggingEnabled&&this._resetDrag());let t=this._findItemForX(this._dragStartCoords[0]),e=this._findItemForX(this._dragCurrentCoords[0]);t!=e&&(this._hidePositionMarker(),this._fitSection(t,e),this._dragStartCoords=null,this._gotDragged=!1,this._fireEvt("elechart_dragged",{data:{dragstart:this._data[t],dragend:this._data[e]}},!0))},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._focusRect.node())},_drawDragRectangle:function(){this._dragStartCoords&&this._draggingEnabled&&(this._dragRectangle||(this._dragRectangle=this._focus.insert("rect",".mouse-focus-group").attr("class","mouse-drag").style("pointer-events","none")),this._dragRectangle.call(g({dragStartCoords:this._dragStartCoords,dragEndCoords:this._dragCurrentCoords=d3.mouse(this._focusRect.node()),height:this._height()})))},_expand:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-collapsed"),L.DomUtil.addClass(this._container,"elevation-expanded"))},_findItemForLatLng:function(t){let e=null,i=1/0;return this._data.forEach(a=>{let o=t.distanceTo(a.latlng);o<i&&(i=o,e=a)}),e},_findItemForX:function(t){let e=this.options,i=this._data?this._data:[0,1];return(0,d3.bisector(t=>t[e.xAttr]).left)(i,this._x.invert(t))},_fireEvt:function(t,e,i){this.fire&&this.fire(t,e,i),this._map&&this._map.fire(t,e,i)},_fitSection:function(t,e){let i=Math.min(t,e),a=Math.max(t,e),o=this._calculateFullExtent(this._data.slice(i,a));this.fitBounds(o)},_height:function(){let t=this.options;return t.height-t.margins.top-t.margins.bottom},_hidePositionMarker:function(){this.options.autohideMarker&&(this._selectedItem=null,this._marker&&this._marker.remove(),this._heightG&&this._heightG.classed("hidden",!0),this._pointG&&this._pointG.classed("hidden",!0),this._focusG&&this._focusG.classed("hidden",!0))},_initChart:function(){let t=this.options;if(t.xTicks=t.xTicks||Math.round(this._width()/75),t.yTicks=t.yTicks||Math.round(this._height()/30),t.responsive)if(t.detached){let e=this.eleDiv.offsetWidth,i=this.eleDiv.offsetHeight;t.width=e>0?e:t.width,t.height=i-20>0?i-20:t.height}else{t._maxWidth=t._maxWidth>t.width?t._maxWidth:t.width;let e=this._map._container.clientWidth;t.width=t._maxWidth>e?e-30:t.width}let e=this._updateScale(),i=d3.select(this._container).call(this._appendChart()).call(this._appendSummary()),a=this._svg=i.select("svg");this._grid=a.select(".grid"),this._area=a.select(".area"),this._path=a.select(".area path"),this._axis=a.select(".axis"),this._focus=a.select(".focus"),this._focusRect=a.select("rect"),this._x=e.x,this._y=e.y,this._fireEvt("elechart_init",null,!0)},_initToggle:function(t){if(t.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(t),L.Browser.mobile&&L.DomEvent.on(t,"click",L.DomEvent.stopPropagation),L.DomEvent.on(t,"mousewheel",this._mousewheelHandler,this),!this.options.detached){let e="elevation-toggle "+this.options.controlButton.iconCssClass+(this.options.autohide?"":" close-button"),i=this._button=L.DomUtil.create("a",e,t);i.href="#",i.title=this.options.controlButton.title,this.options.collapsed&&(this._collapse(),this.options.autohide?L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this):L.DomEvent.on(i,"click",L.DomEvent.stop).on(i,"click",this._toggle,this),L.DomEvent.on(i,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_mouseenterHandler:function(){this._fireEvt("elechart_enter",null,!0)},_mousemoveHandler:function(t,e,i){if(!this._data||0===this._data.length||!this._chartEnabled)return;let a=d3.mouse(this._focusRect.node())[0],o=this._data[this._findItemForX(a)];this._hidePositionMarker(),this._showDiagramIndicator(o,a),this._showPositionMarker(o),this._setMapView(o),this._map&&this._map._container&&L.DomUtil.addClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_change",{data:o,xCoord:a},!0),this._fireEvt("elechart_hover",{data:o,xCoord:a},!0)},_mousemoveLayerHandler:function(t){if(!this._data||0===this._data.length)return;let e=t.latlng,i=this._findItemForLatLng(e);if(i){let t=i.xDiagCoord;this._hidePositionMarker(),this._showDiagramIndicator(i,t),this._showPositionMarker(i),this._fireEvt("elechart_change",{data:i,xCoord:t},!0)}},_mouseoutHandler:function(){this.options.detached||this._hidePositionMarker(),this._map&&this._map._container&&L.DomUtil.removeClass(this._map._container,"elechart-hover"),this._fireEvt("elechart_leave",null,!0)},_mousewheelHandler:function(t){if(this._map.gestureHandling&&this._map.gestureHandling._enabled)return;let e=this._selectedItem?this._selectedItem.latlng:this._map.getCenter(),i=t.deltaY>0?this._map.getZoom()-1:this._map.getZoom()+1;this._resetDrag(),this._map.flyTo(e,i)},_resetDrag:function(){this._dragRectangle&&(this._dragRectangle.remove(),this._dragRectangle=null,this._hidePositionMarker())},_resetView:function(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hidePositionMarker(),this.fitBounds(this._fullExtent))},_resizeChart:function(){if("none"!=this._container.style.display&&this.options.responsive)if(this.options.detached){let t=this.eleDiv.offsetWidth;if(t<=0)return;this.options.width=t,this.eleDiv.innerHTML="",this.eleDiv.appendChild(this.onAdd(this._map))}else this._map.removeControl(this._container),this.addTo(this._map)},_showDiagramIndicator:function(t,e){if(!this._chartEnabled)return;let i=this.options,a=i.hoverNumber.formatter,[o,s]=[i.hoverNumber.decimalsX,i.hoverNumber.decimalsY],n=this._y(t[i.yAttr]);this._focusG.classed("hidden",!1),this._focusline.call(k({xCoord:e,height:this._height()})),this._focuslabel.call(C({xCoord:e,yCoord:n,height:this._height(),width:this._width(),labelX:a(t[i.xAttr],o)+" "+this._xLabel,labelY:a(t[i.yAttr],s)+" "+this._yLabel}))},_toggle:function(){L.DomUtil.hasClass(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function(t){if(!this.options.followMarker||!this._map)return;let e=this._map.getZoom();e=e<this._zFollow?this._zFollow:e,this._map.setView(t.latlng,e,{animate:!0,duration:.25})},_showPositionMarker:function(t){this._selectedItem=t,"elevation-line"==this.options.marker?this._updatePositionMarker(t):"position-marker"==this.options.marker&&this._updateLeafletMarker(t)},_updateAxis:function(){this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove(),this._grid.call(this._appendXGrid()).call(this._appendYGrid()),this._axis.call(this._appendXaxis()).call(this._appendYaxis()),this._fireEvt("elechart_axis")},_updateChart:function(){this._data&&this._container&&(this._updateScale(),this._updateAxis(),this._updateAreaPath(),this._fullExtent=this._calculateFullExtent(this._data),this._fireEvt("elechart_updated"))},_updateAreaPath:function(){let t=this.options;this._path.call(u({interpolation:t.interpolation,data:this._data,name:"Altitude",xAttr:t.xAttr,yAttr:t.yAttr,width:this._width(),height:this._height(),scaleX:this._x,scaleY:this._y}))},_updateLeafletMarker:function(t){this._marker?this._marker.setLatLng(t.latlng):this._marker=L.marker(t.latlng,{icon:this.options.markerIcon,zIndexOffset:1e6}).addTo(this._map,{pane:"elevationPane"})},_updatePositionMarker:function(t){let e=this.options,i=L.extend({},t,this._map.latLngToLayerPoint(t.latlng)),a=e.hoverNumber.formatter,o=e.hoverNumber.decimalsY,s=this._height()/this._maxElevation*i.z,n=i.y-s;if(!this._heightG){let t=L.svg({pane:"elevationPane"}).addTo(this._map),e=d3.select(t.getPane()).select("svg"),i=this._heightG=e.select("g").attr("class","height-focus-group");this._mouseHeightFocus=i.append("svg:line"),this._pointG=i.append("svg:circle"),this._mouseHeightFocusLabel=i.append("svg:text")}this._heightG.classed("hidden",!1),this._pointG.classed("hidden",!1),this._pointG.call(w({theme:this.options.theme,xCoord:i.x,yCoord:i.y})),this._mouseHeightFocus.call(v({theme:this.options.theme,xCoord:i.x,yCoord:i.y,length:n})),this._mouseHeightFocusLabel.call(x({theme:this.options.theme,xCoord:i.x,yCoord:n,label:a(i[e.yAttr],o)+" "+this._yLabel}))},_updateScale:function(){let t=this.options;return this._x=D({data:this._data,range:[0,this._width()],attr:t.xAttr,min:t.xAxisMin,max:t.xAxisMax,forceBounds:t.forceAxisBounds}),this._y=D({data:this._data,range:[this._height(),0],attr:t.yAttr,min:t.yAxisMin,max:t.yAxisMax,forceBounds:t.forceAxisBounds}),{x:this._x,y:this._y}},_updateSummary:function(){this.summaryDiv.innerHTML="",this.track_info=this.track_info||{},this.track_info.distance=this._distance||0,this.track_info.elevation_max=this._maxElevation||0,this.track_info.elevation_min=this._minElevation||0,this.options.summary&&this._fireEvt("elechart_summary"),this.options.downloadLink&&this._downloadURL&&(this.summaryDiv.innerHTML+='<span class="download"><a href="#">'+L._("Download")+"</a></span>",this.summaryDiv.querySelector(".download a").onclick=t=>{t.preventDefault(),this._fireEvt("eletrack_download",{downloadLink:this.options.downloadLink,confirm:c.bind(this._downloadURL)})})},_width:function(){let t=this.options;return t.width-t.margins.left-t.margins.right}});L.control.elevation=t=>new F(t),F.Utils=p,F.Components=E,F.addInitHook((function(){this.on("waypoint_added",(function(t){let e=t.point,i=e._popup;i&&(i.options.className="elevation-popup"),i._content&&(i._content=decodeURI(i._content),e.bindTooltip(i._content,{direction:"top",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip())})),this.on("elepath_toggle",(function(t){let e=t.path,i=L.DomUtil.hasClass(e,"hidden"),a=d3.select(t.legend).select("text");if(i?(L.DomUtil.removeClass(e,"hidden"),a.style("text-decoration-line","")):(L.DomUtil.setClass(e,"hidden"),a.style("text-decoration-line","line-through")),this._chartEnabled=0!=this._area.selectAll("path:not(.hidden)").nodes().length,this._chartEnabled)for(let t in this._layers)this._layers[t]._path&&L.DomUtil.addClass(this._layers[t]._path,this.options.polyline.className+" "+this.options.theme);else this._resetDrag(),this._clearPath()})),this.on("elechart_legend",(function(){this._altitudeLegend=this._legend.append("g").call(b({name:"Altitude",width:this._width(),height:this._height(),margins:this.options.margins}))})),this.on("elechart_summary",(function(){this.summaryDiv.innerHTML+='<span class="totlen"><span class="summarylabel">'+L._("Total Length: ")+'</span><span class="summaryvalue">'+this.track_info.distance.toFixed(2)+"&nbsp;"+this._xLabel+'</span></span><span class="maxele"><span class="summarylabel">'+L._("Max Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_max.toFixed(2)+"&nbsp;"+this._yLabel+'</span></span><span class="minele"><span class="summarylabel">'+L._("Min Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_min.toFixed(2)+"&nbsp;"+this._yLabel+"</span></span>"})),this.on("eletrack_download",(function(t){"modal"==t.downloadLink&&"function"==typeof CustomEvent?document.dispatchEvent(new CustomEvent("eletrack_download",{detail:t})):"link"!=t.downloadLink&&!0!==t.downloadLink||t.confirm()})),this.on("eledata_loaded",(function(t){let e=t.layer;this._map?(this._map.once("layeradd",(function(t){this.fitBounds(e.getBounds())}),this),e.addTo(this._map)):console.warn("Undefined elevation map object")})),this.on("eledata_clear",(function(){this._area.selectAll("path").attr("d","M0 0"),this._path}))}))}));
//# sourceMappingURL=leaflet-elevation.min.js.map
